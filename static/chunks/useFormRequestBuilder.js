import{u as w,A as E}from"../main.js";import{C as i}from"./vendor.js";function P(){const{store:s}=w(),u=i(!1),c=i(!1),h=i(!1),p=i(!1),b=i(!1),D=i([]),l=i(null);return{d:u,d2:c,dpc:h,dr:p,dw:b,images:D,data:l,useToggle:(m,_=null)=>{s.SET_PAYLOAD(m),u.value=!u.value,l.value=_}}}function z(){const{payload:s,onload:u,content:c}=w(),{get:h,save:p}=E();function b(e){return new Date(e).toISOString().substring(0,10)}function D(e,n){return e==="start_date"||e==="end_date"||e==="remove_date"?b(n):n}const l=e=>{u.value="\u30ED\u30FC\u30C7\u30A3\u30F3\u30B0...",e.forEach((n,a)=>{a>0&&h(n,s.value.state).then(()=>{a===s.value.endpoints.length&&(c.value=!1,u.value="")})})},f=e=>new Promise((n,a)=>{p(s.value.endpoints[0],e,s.value.method).then(d=>{u.value="\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u4E2D",l(s.value.endpoints),n(d)})}),m=(e,n)=>(u.value="\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u4E2D",new Promise((a,d)=>{n&&n.forEach(t=>{t.forEach(g=>{g.elements.forEach(r=>{r.name==="FileInput"&&typeof r.model=="string"?e[r.db_column_name]=null:e[r.db_column_name]=D(r.db_column_name,r.model)})})});const o=new FormData,v=Object.keys(e);v.forEach(t=>{if(e[t]||typeof e[t]=="boolean")if(o.append(t,e[t]),t==="image"){const g=new Date().toISOString()+"."+e[t].type.split("/")[1],r=new File([e[t]],g,{type:e[t].type});o.append("thumbnail",r),v.includes("building_floor")||o.append("type",e[t].type)}else t==="file"?(o.append("type",e[t].type.split("/")[1]),o.append("size",e[t].size)):t==="video"?o.append("size",e[t].size):t==="pdf"&&o.append("pdf_size",e[t].size)}),p(s.value.endpoints[0],o,s.value.method).then(t=>{l(s.value.endpoints),a(t)})}));return{submitAsFormObject:f,submitAsFormData:m,submitRowReorder:(e,n)=>(c.value=!0,new Promise((a,d)=>{s.value=n,e.value.forEach((v,t)=>{v.order_id=t+1});const o={reordered:e.value};f(o).then(()=>{l(s.value.endpoints),c.value=!1,a(!0)})})),submit:(e,n,a="formData")=>new Promise(d=>{a==="formData"&&n?m(e,n).then(o=>{d(o)}):f(e).then(o=>{d(o)})}),remove:e=>new Promise(n=>{p(e,{},"delete").then(()=>{n(!0)})})}}export{z as a,P as u};
