import{D as B}from"./vuedraggable.umd.js";import{d as V,A,u as D,r as f,w as k,c as q,b as u,f as l,z as c,q as d,e as a,a2 as R,o as $,M as S,t as I}from"../main.js";import{s as N}from"./menu.esm.js";import{_ as P}from"./Dialog.js";import{S as M}from"./Spinner.js";import{_ as U}from"./BarTool.js";import{u as G,a as H}from"./useFormRequestBuilder.js";import{u as O}from"./useRightClickHandler.js";import{_ as z}from"./FormQuery.js";import{c as T,d as J}from"./rules.js";import"./_commonjsHelpers.js";import"./portal.esm.js";import"./plugin-vue_export-helper.js";const K=[[{classes:["flex"],elements:[{component:null,name:"FileInput",db_column_name:"image",type:"text",model:null,label:"\u753B\u50CF",hint:".jpeg, .png \u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u3059",required:!0,id:"gallery_image_input",preview_text:"\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u306E\u305F\u3081\u3001\u30AF\u30EA\u30C3\u30AF\u3084\u753B\u50CF\u30C9\u30ED\u30C3\u30D7\u3057\u3066\u304F\u3060\u3055\u3044",limit:"1MB\u4EE5\u4E0B",accept:"image/*",rules:[T],rule:J,disabled:!1,props:["placeholder","required","disabled","accept","hint","model","image_path","preview_text","limit","rule"],classes:["flex-column","column-1"]}]}]];const L={id:"project_gallery",class:"panel-board relative"},Q={class:"part-wrap"},W={class:"spreadsheet-wrapper overflow-x"},X=R('<div class="sh-container ss-container"><div class="sheet-row sheet-row-header flex align-center"><div class="sheet-cell handle flex align-center"></div><div class="sheet-cell num flex align-center">\u9806\u756A</div><div class="sheet-cell value sheet-cell-long flex align-center">\u753B\u50CF\u540D</div></div></div>',1),Y=["onContextmenu"],Z=a("div",{class:"sheet-cell handle flex align-center handle grab"},[a("i",{class:"pi pi-bars"})],-1),ee={class:"sheet-cell num flex align-center"},te={class:"text block"},le={class:"sheet-cell value sheet-cell-long flex align-center"},se=["src"],ye=V({__name:"ProjectGallery",setup(ae){var _;const{get:g,save:oe}=A(),{submit:v,submitRowReorder:h,remove:C}=G(),{d:r,dr:ue,data:p,useToggle:m}=H(),{rcm:b,rcmOpened:re,isRCOn:x}=O(p),{payload:ie,content:i,progress:y,project:o}=D(),n=f(((_=o.value)==null?void 0:_.gallery)||[]);function F(){var e;m({method:"post",endpoints:["app/galleries","project_details/"+((e=o.value)==null?void 0:e.id)],state:"project"})}const j=f([{label:"\u65B0\u898F\u753B\u50CF",command:()=>{var e;m({method:"post",endpoints:["app/galleries","project_details/"+((e=o.value)==null?void 0:e.id)],state:"project"})}},{label:"\u884C\u3092\u524A\u9664\u3059\u308B",command:()=>{var e;console.log("ok"),i.value=!0,C("app/galleries/"+((e=p.value)==null?void 0:e.id)).then(()=>{var t;g("project_details/"+((t=o.value)==null?void 0:t.id),"project").then(()=>{i.value=!1})})}}]);return k(()=>o.value,e=>{n.value=(e==null?void 0:e.gallery)||[]}),(e,t)=>($(),q("div",L,[u(M,{modelValue:l(i),"onUpdate:modelValue":t[0]||(t[0]=s=>c(i)?i.value=s:null)},null,8,["modelValue"]),u(U,{class:"justify-space-between"},{default:d(()=>[a("div",Q,[u(l(S),{type:"button",class:"submit-button",icon:"pi pi-plus","icon-pos":"left",label:"\u753B\u50CF\u3092\u8FFD\u52A0",onClick:t[1]||(t[1]=s=>F())})])]),_:1}),a("div",W,[X,u(l(B),{tag:"div",onEnd:t[2]||(t[2]=s=>l(h)({value:n.value},{method:"post",endpoints:["app/galleries","project_details/"+l(o).id],state:"project"})),list:n.value,class:"sb-container ss-container",handle:".handle","item-key":"id"},{item:d(({element:s,index:E})=>[a("div",{onContextmenu:w=>l(x)(w,s),style:{cursor:"default"},"aria-haspopup":"true","aria-controls":"plan_rc_menu",class:"sheet-row flex align-center list-group-item relative pointer"},[u(l(N),{id:"rc_menu",ref_key:"rcm",ref:b,class:"rc has-final-action",model:j.value,popup:!0},null,8,["model"]),Z,a("div",ee,[a("span",te,I(E+1),1)]),a("div",le,[a("img",{style:{width:"100px",height:"auto"},src:s.thumbnail_url,alt:""},null,8,se)])],40,Y)]),_:1},8,["list"])]),u(P,{modelValue:l(r),"onUpdate:modelValue":t[4]||(t[4]=s=>c(r)?r.value=s:null),title:"\u30AE\u30E3\u30E9\u30EA\u30FC\u30D5\u30A9\u30FC\u30E0"},{default:d(()=>[u(z,{modelValue:l(r),"onUpdate:modelValue":t[3]||(t[3]=s=>c(r)?r.value=s:null),"close-after":"",topProgress:"",progress:l(y),form:l(K),query:{project:l(o).id},submit:l(v)},null,8,["modelValue","progress","form","query","submit"])]),_:1},8,["modelValue"])]))}});export{ye as default};
