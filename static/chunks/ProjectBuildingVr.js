import{K as Q,d as W,A as X,u as Y,l as m,m as Z,D as E,c as w,g as i,b as u,p as _,w as r,h as a,F as ee,q as le,P as te,o as x,s as q,e as ue,f as ae,t as ie,a1 as oe,bO as ne}from"../main.js";import{s as se}from"./dropdown.esm.js";import{s as re}from"./menu.esm.js";import{s as de,a as I}from"./column.esm.js";import{_ as pe}from"./BarTool.js";import{S as ce}from"./Spinner.js";import{_ as O}from"./Dialog.js";import{a as me,u as ve}from"./useFormRequestBuilder.js";import{u as _e}from"./useRightClickHandler.js";import{_ as fe}from"./Icon.js";import{_ as ge}from"./FormQuery.js";import{_ as be}from"./ContextImagesThumbnailContainer.js";import{u as he}from"./useUtils.js";import{_ as xe}from"./DialogDelete.js";import{_ as Ce}from"./FormNested.js";import"./index.esm.js";import"./virtualscroller.esm.js";import"./portal.esm.js";import"./index.esm2.js";import"./index.esm3.js";import"./plugin-vue_export-helper.js";const C=[[{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputNumber",db_column_name:"name",type:"text",model:null,label:"\u753B\u50CF\u756A\u53F7",hint:"\u4E26\u3073\u9806\u3067\u4F7F\u308F\u308C\u308B\u306E\u3067\u6570\u5B57\u3067\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044",placeholder:"\u30FC",required:!0,id:"name_input",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-2-space","relative"]},{component:null,name:"Dropdown",db_column_name:"building_vr_direction",type:"text",model:!1,label:"\u65B9\u5411",hint:null,required:!0,rules:[],id:"direction_input",disabled:!1,options:Q().project.building_vr.building_vr_directions,optionLabel:"name",optionValue:"id",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-2-space","relative"]}]},{classes:["flex"],elements:[{component:null,name:"FileInput",db_column_name:"image",type:"text",model:null,label:"\u753B\u50CF",hint:".jpeg, .png \u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u3059",required:!1,id:"image_input",preview_text:"\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u306E\u305F\u3081\u3001\u30AF\u30EA\u30C3\u30AF\u3084\u753B\u50CF\u30C9\u30ED\u30C3\u30D7\u3057\u3066\u304F\u3060\u3055\u3044",limit:"1MB\u4EE5\u4E0B",accept:"image/*",rules:[],rule:null,disabled:!1,props:["placeholder","required","disabled","accept","hint","model","image_path","preview_text","limit","rule"],classes:["flex-column","column-1"]}]}]];const Be={id:"project_building_vr",class:"panel-board"},Fe={class:"part-wrap"},Ve={class:"part-wrap part-end"},je={class:"spreadsheet-wrapper overflow-x"},ye=te('<div class="sh-container ss-container"><div class="sheet-row sheet-row-header flex align-center"><div class="sheet-cell handle flex align-center"></div><div class="sheet-cell img flex align-center"><i class="pi pi-file"></i></div><div class="sheet-cell value sheet-cell-long flex align-center">\u753B\u50CF\u756A\u53F7</div></div></div>',1),Ee={class:"sb-container ss-container"},we=["onClick","onContextmenu"],$e=a("div",{class:"sheet-cell handle flex align-center handle grab"},null,-1),ke={class:"sheet-cell img flex align-center"},De={class:"sheet-cell num flex align-center"},Ae={class:"text block"},Ue={class:"button-wrapper flex justify-end"},qe=["onUpdate:modelValue"],Ie=["onClick"],Oe=a("i",{class:"pi pi-times"},null,-1),Se=[Oe],Re={class:"action-wrapper flex align-center"},dl=W({__name:"ProjectBuildingVr",setup(Le){const{get:$,save:Ne}=X(),{submit:B,submitRowReorder:Me,remove:k}=me(),{d:v,d2:n,dr:d,data:g,images:F,useToggle:V}=ve(),{rcm:S,rcmOpened:Pe,isRCOn:R}=_e(g),{sortByAsc:L}=he(),{payload:D,content:b,progress:N,project:o}=Y(),f=m(0),h=m([]),j=m([]),p=m(!1),y=m(!1),c=m([]),A=m([]);Z(()=>{var t,e;c.value=((t=o.value)==null?void 0:t.building_vr.building_vr_directions)||[],(e=o.value)==null||e.building_vr.building_vr_directions.forEach((l,s)=>{s===0&&(f.value=l.id),h.value.push({name:l.name,id:l.id})})});function M(){var t;y.value=!1,C[0][0].elements[1].disabled=!1,C[0][0].elements[1].model=f.value,V({method:"post",endpoints:["app/building_vr_direction_images","project_details/"+((t=o.value)==null?void 0:t.id)],state:"project"})}function P(t){var e;y.value=!0,C[0][0].elements[1].disabled=!0,F.value=t.image?[{image:t.image}]:[],V({method:"patch",endpoints:["app/building_vr_direction_images","project_details/"+((e=o.value)==null?void 0:e.id)],state:"project"},t)}function T(){p.value=!0,B({create:c.value,remove:A.value},null,"object").then(()=>{p.value=!1,n.value=!1})}function H(){var t;p.value=!0,k("app/building_vr_direction_images/"+((t=g.value)==null?void 0:t.id)).then(()=>{var e;d.value=!1,$("project_details/"+((e=o.value)==null?void 0:e.id),"project").then(()=>{v.value=!1,p.value=!1})})}function K(t){var e;p.value=!0,D.value={method:"patch",endpoints:["app/building_vr_direction_images/"+g.value.id,"project_details/"+((e=o.value)==null?void 0:e.id)],state:"project"},B({image:null,thumbnail:null},null,"object").then(()=>{p.value=!1,F.value=[]})}const z=()=>{var e;const t={id:null,building_vr:((e=o.value)==null?void 0:e.building_vr.id)||null,order_id:null,name:"\u65B9\u5411"+(c.value.length+1)};c.value.push(t)},G=t=>{const e=c.value.filter((l,s)=>s!==t);c.value.forEach((l,s)=>{t===s&&l.id&&A.value.push(l)}),c.value=e},J=m([{label:"\u65B0\u898F\u753B\u50CF",command:()=>{var t;V({method:"post",endpoints:["app/building_vr_direction_images","project_details/"+((t=o.value)==null?void 0:t.id)],state:"project"})}},{label:"\u884C\u3092\u524A\u9664\u3059\u308B",command:()=>{var t;b.value=!0,k("app/building_vr_direction_images/"+((t=g.value)==null?void 0:t.id)).then(()=>{var e;$("project_details/"+((e=o.value)==null?void 0:e.id),"project").then(()=>{b.value=!1})})}}]);return E(()=>n.value,t=>{var e;t&&(D.value={method:"post",endpoints:["app/building_vr_directions","project_details/"+((e=o.value)==null?void 0:e.id)],state:"project"})}),E(()=>f.value,t=>{var e;(e=o.value)==null||e.building_vr.building_vr_directions.forEach(l=>{l.id===t&&(j.value=l.building_vr_direction_images||[])})}),E(()=>o.value,t=>{h.value=[],t==null||t.building_vr.building_vr_directions.forEach(e=>{e.id===f.value&&(j.value=e.building_vr_direction_images||[]),h.value.push({name:e.name,id:e.id})})}),(t,e)=>(x(),w("div",Be,[i(ce,{modelValue:u(b),"onUpdate:modelValue":e[0]||(e[0]=l=>_(b)?b.value=l:null)},null,8,["modelValue"]),i(pe,{class:"justify-space-between"},{default:r(()=>[a("div",Fe,[i(u(q),{type:"button",class:"submit-button",icon:"pi pi-plus","icon-pos":"left",label:"\u753B\u50CF\u3092\u8FFD\u52A0",onClick:e[1]||(e[1]=l=>M())})]),a("div",Ve,[i(u(se),{style:{"margin-left":"0",width:"120px"},class:"dropdown",modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=l=>f.value=l),options:h.value,optionLabel:"name",optionValue:"id",placeholder:"\u65B9\u5411\u9078\u629E"},null,8,["modelValue","options"]),i(u(q),{type:"button",class:"submit-button icon-button",icon:"pi pi-cog","icon-pos":"left",onClick:e[3]||(e[3]=l=>n.value=!0)})])]),_:1}),a("div",je,[ye,a("div",Ee,[(x(!0),w(ee,null,le(u(L)(j.value,"name"),(l,s)=>(x(),w("div",{key:s,onClick:U=>P(l),onContextmenu:U=>u(R)(U,l),"aria-haspopup":"true","aria-controls":"plan_rc_menu",class:"sheet-row flex align-center list-group-item relative pointer"},[i(u(re),{id:"rc_menu",ref_for:!0,ref_key:"rcm",ref:S,class:"rc has-final-action",model:J.value,popup:!0},null,8,["model"]),$e,a("div",ke,[l.image?(x(),ue(fe,{key:0,svg:"image"})):ae("",!0)]),a("div",De,[a("span",Ae,ie(l.name),1)])],40,we))),128))])]),i(O,{modelValue:u(v),"onUpdate:modelValue":e[9]||(e[9]=l=>_(v)?v.value=l:null),title:"\u5916\u89B3\u753B\u50CF\u30D5\u30A9\u30FC\u30E0"},{default:r(()=>[i(ge,{modelValue:u(v),"onUpdate:modelValue":e[4]||(e[4]=l=>_(v)?v.value=l:null),dr:u(d),"onUpdate:dr":e[5]||(e[5]=l=>_(d)?d.value=l:null),"close-after":"",topProgress:"",progress:u(N),form:u(C),data:u(g),loading:p.value,remove:y.value,query:{project:u(o).id},submit:u(B)},{default:r(()=>[i(be,{containerId:"image_input",images:u(F),remove:K},null,8,["images"])]),_:1},8,["modelValue","dr","progress","form","data","loading","remove","query","submit"]),i(xe,{modelValue:u(d),"onUpdate:modelValue":e[8]||(e[8]=l=>_(d)?d.value=l:null)},{default:r(()=>[a("div",Ue,[a("button",{onClick:e[6]||(e[6]=l=>d.value=!1),class:"cancel"},"\u3044\u3044\u3048"),a("button",{onClick:e[7]||(e[7]=l=>H()),class:"delete"},"\u306F\u3044")])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),i(O,{modelValue:u(n),"onUpdate:modelValue":e[14]||(e[14]=l=>_(n)?n.value=l:null),title:"\u65B9\u5411\u30D5\u30A9\u30FC\u30E0"},{default:r(()=>[i(Ce,{modelValue:u(n),"onUpdate:modelValue":e[13]||(e[13]=l=>_(n)?n.value=l:null),form:[[]],loading:p.value},{actions:r(()=>[a("div",Re,[a("button",{onClick:e[11]||(e[11]=l=>n.value=!1),class:"flex align-center justify-center cancel"},"\u4E2D\u6B62"),a("button",{onClick:e[12]||(e[12]=l=>T()),class:"flex align-center justify-center submit-or-next"},"\u767B\u9332")])]),default:r(()=>[i(u(de),{value:c.value,rowindex:"index",responsiveLayout:"scroll",class:"option-datatable"},{default:r(()=>[i(u(I),{field:"name",header:"\u9805\u76EE\u540D"},{body:r(l=>[oe(a("input",{class:"option-input",type:"text","onUpdate:modelValue":s=>l.data.name=s,placeholder:"\u9078\u629E\u9805\u76EE"},null,8,qe),[[ne,l.data.name]])]),_:1}),i(u(I),{style:{width:"40px","text-align":"right","margin-left":"auto"},body:"index"},{body:r(l=>[a("span",{onClick:s=>G(l.index),class:"remove pointer"},Se,8,Ie)]),_:1})]),_:1},8,["value"]),a("button",{onClick:e[10]||(e[10]=l=>z()),class:"add-option"},"\u65B9\u5411\u3092\u8FFD\u52A0\u3059\u308B")]),_:1},8,["modelValue","loading"])]),_:1},8,["modelValue"])]))}});export{dl as default};
