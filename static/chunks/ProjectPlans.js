import{E as ie,A as fe,u as ve,L as re,l as v,d as _e,D as Z,c as R,g as c,b as e,p as g,w as h,h as o,o as A,s as be,t as ee,F as he,q as xe,n as ge,e as de,f as le,a1 as ye,bO as je}from"../main.js";import{D as pe}from"./vuedraggable.umd.js";import{s as Ce}from"./menu.esm.js";import{a as ne,s as Ee}from"./column.esm.js";import{_ as ce}from"./Dialog.js";import{S as we}from"./Spinner.js";import{_ as De}from"./BarTool.js";import{_ as Fe}from"./Icon.js";import{u as ke,a as Ve}from"./useFormRequestBuilder.js";import{u as qe}from"./useRightClickHandler.js";import{_ as Ae}from"./FormQuery.js";import{_ as $e}from"./FormNested.js";import{_ as Ie}from"./DialogDelete.js";import"./_commonjsHelpers.js";import"./portal.esm.js";import"./dropdown.esm.js";import"./index.esm.js";import"./virtualscroller.esm.js";import"./index.esm2.js";import"./index.esm3.js";import"./plugin-vue_export-helper.js";const te=[[{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputText",db_column_name:"name",type:"text",model:null,label:"\u30D5\u30A1\u30A4\u30EB\u540D",hint:null,placeholder:"\u9593\u53D6\u308A",required:!0,id:"name_input",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-2-space"]},{component:null,name:"InputText",db_column_name:"class_name",type:"text",model:null,label:"CSS\u30AF\u30E9\u30B9",hint:null,placeholder:"class-name",required:!1,id:"class_name_input",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-2-space"]}]},{classes:["flex"],elements:[{component:null,name:"Dropdown",db_column_name:"type",type:"text",model:"InputText",label:"\u30BF\u30A4\u30D7",hint:null,required:!1,rules:[],id:"type_input",disabled:!1,options:[{name:"\u30C6\u30AD\u30B9\u30C8\u5217",value:"InputText"},{name:"\u6570\u5B57\u5217",value:"InputNumber"},{name:"\u9078\u629E\u5217",value:"Dropdown"},{name:"\u753B\u50CF\u5217",value:"FileInput"}],optionLabel:"name",optionValue:"value",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-1","relative"]}]}]],Be=[{classes:["flex"],elements:[{component:null,name:"Dropdown",db_column_name:"name",type:"text",model:null,label:"",hint:null,required:!1,rules:[],id:"",disabled:!1,options:[],optionLabel:"name",optionValue:"id",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-1","relative"]}]},{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputText",db_column_name:"name",type:"text",model:null,label:"",hint:null,placeholder:"\u30FC",required:!1,id:"",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-1"]}]},{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputNumber",db_column_name:"name",type:"text",model:0,label:"",hint:null,placeholder:"\u30FC",required:!1,id:"",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-1"]}]},{classes:["flex"],elements:[{component:null,name:"FileInput",db_column_name:"value",type:"text",model:null,label:"PIN",hint:".jpeg, .png \u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u3059",required:!1,id:"pin_input",preview_text:"\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u306E\u305F\u3081\u3001\u30AF\u30EA\u30C3\u30AF\u3084\u753B\u50CF\u30C9\u30ED\u30C3\u30D7\u3057\u3066\u304F\u3060\u3055\u3044",limit:"1MB\u4EE5\u4E0B",accept:"image/*",rules:[],rule:null,disabled:!1,props:["placeholder","required","disabled","accept","hint","model","preview_text"],classes:["flex-column","column-1"]}]}];function Oe(N){const y=ie({id:null,order_id:null,project:N.value.id,name:null,type:null,class_name:null,plan_field_options:[]}),$=ie({id:null,order_id:null,plan_field:null,plan_content:null,value:null,field:null,image:null,thumbnail:null});return{q1:y,q2:$}}function Re(){const{get:N,save:y}=fe(),{d:$,dr:I,images:D,data:d,useToggle:x}=ke(),{submit:F,submitRowReorder:Q,submitAsFormObject:k,remove:L}=Ve(),{rcm:oe,rcmOpened:se,isRCOn:P}=qe(d),{payload:j,project:r,progress:M,onload:Y,content:_}=ve(),{q1:m,q2:G}=Oe(r),V=re(()=>{var l;return(l=r.value)==null?void 0:l.plan_fields}),H=re(()=>{var l;return(l=r.value)==null?void 0:l.plan_contents}),b=v(te),K=v(!1),C=v(),S=v(!1),W=v("image_input"),X=v(null),z=v(!1),U=v([]),T=v([]),J=v([]),B=v(!1),E=v([{label:"\u884C\u3092\u8907\u88FD\u3059\u308B",command:()=>{var l;_.value=!0,y("app/plan_contents",{duplicate:!0,project:(l=r.value)==null?void 0:l.id},"post").then(a=>{var s;const u=d.value.plan_contexts.map(i=>(i.plan_content=a.id,i.id=null,i));j.value={method:"post",endpoints:["app/plan_contexts","project_details/"+((s=r.value)==null?void 0:s.id)],state:"project"},F({duplicate:u},null,"object").then(()=>{_.value=!1})})}},{label:"\u884C\u3092\u524A\u9664\u3059\u308B",command:()=>{_.value=!0,L("app/plan_contents/"+d.value.id).then(()=>{var l;N("project_details/"+((l=r.value)==null?void 0:l.id),"project").then(()=>{_.value=!1})})}}]);return{reform:b,query:C,dropdown:z,d:$,d2:B,dr:I,rm:S,data:d,response:X,q1:m,containerId:W,loading:K,content:_,project:r,progress:M,fields:V,contents:H,rightClickMenu:E,rcm:oe,isRCOn:P,submit:F,submitRowReorder:Q,reorderOptions:l=>{m.plan_field_options=l.value},saveRow:()=>{var u;j.value={method:"post",endpoints:["app/plan_contexts","project_details/"+((u=r.value)==null?void 0:u.id)],state:"project"};let l={update:[]},a=[];d.value.plan_contexts.forEach((s,i)=>{if(s.value=b.value[0][i].elements[0].model,l.update.push({id:s.id,value:s.value}),s.field==="FileInput"){const w=new FormData;b.value[0][i].elements[0].model&&(w.append("image",b.value[0][i].elements[0].model),w.append("thumbnail",b.value[0][i].elements[0].model),a.push({id:s.id,data:w}))}}),F(l,null,"object").then(()=>{a.length?a.forEach((s,i)=>{var w;j.value={method:"patch",endpoints:["app/plan_contexts/"+s.id,"project_details/"+((w=r.value)==null?void 0:w.id)],state:"project"},F(s.data,null).then(()=>{a.length===i+1&&(B.value=!1)})}):B.value=!1})},removeItem:l=>{_.value=!0,L(l+d.value.id).then(()=>{var a;$.value=!1,I.value=!1,N("project_details/"+((a=r.value)==null?void 0:a.id),"project").then(()=>{S.value=!1,_.value=!1})})},cr:()=>{var a,u,s;j.value={method:"post",endpoints:["app/plan_contents","project_details/"+((a=r.value)==null?void 0:a.id)],state:"project"},_.value=!0;const l=[];(u=V.value)==null||u.forEach(i=>{const w={id:null,order_id:null,plan_field:i,plan_content:null,value:"",field:i.type,image:null,thumbnail:null};l.push(w)}),F({create:l,project:(s=r.value)==null?void 0:s.id},null,"object").then(()=>{_.value=!1})},cf:()=>{var l;m.plan_field_options=[],C.value=m,C.value.order_id=V.value&&V.value.length?V.value.length+1:1,b.value=JSON.parse(JSON.stringify(te)),x({method:"post",endpoints:["app/plan_fields","project_details/"+((l=r.value)==null?void 0:l.id)],state:"project"})},ef:l=>{var a;S.value=!0,C.value=m,C.value.order_id=l.order_id,C.value.plan_field_options=l.plan_field_options,b.value=JSON.parse(JSON.stringify(te)),b.value.forEach(u=>{u.forEach(s=>{s.elements.forEach(i=>{i.db_column_name==="type"&&(i.disabled=!0)})})}),x({method:"patch",endpoints:["app/plan_fields/"+l.id,"project_details/"+((a=r.value)==null?void 0:a.id)],state:"project"},l)},ec:l=>{var u,s;C.value=G,d.value=l,j.value={method:"post",endpoints:["app/plan_contents/"+l.id,"project_details/"+((u=r.value)==null?void 0:u.id)],state:"project"};let a=[[]];(s=V.value)==null||s.forEach((i,w)=>{Be.forEach(ue=>{if(ue.elements[0].name===i.type){let p=JSON.parse(JSON.stringify(ue.elements[0]));p.db_column_name="value",p.label=i.name,l.plan_contexts.forEach(q=>{q.plan_field.id===i.id&&(["\u91D1\u984D","\u4FA1\u683C"].includes(i.name)&&(p.mode="currency",p.props.push("mode"),p.locale="jp-JP",p.props.push("locale"),p.currency="JPY",p.props.push("currency")),q.field==="InputNumber"?q.value&&q.value!==""?p.model=parseInt(q.value):p.model=null:(q.field==="Dropdown"&&(p.options=i.plan_field_options,p.optionValue="name"),p.model=q.value))});const me={classes:["flex"],elements:[p]};a[0].push(me)}})}),b.value=a,B.value=!0},co:()=>{const l={id:null,order_id:null,name:"\u9078\u629E\u9805\u76EE "+(m.plan_field_options.length+1),plan_field:null};m.plan_field_options.push(l),U.value.push(l)},ro:l=>{m.plan_field_options.forEach((u,s)=>{s===l&&u.id&&J.value.push(u.id)}),m.plan_field_options=m.plan_field_options.filter((u,s)=>s!==l)},so:l=>{var a;j.value={method:"post",endpoints:["app/plan_field_options","project_details/"+((a=r.value)==null?void 0:a.id)],state:"project"},l.hasOwnProperty("type")&&l.type==="Dropdown"&&(m.plan_field_options.forEach((u,s)=>{u.order_id=s+1,u.plan_field=l.id,u.id&&T.value.push(u)}),F({create:U.value,update:T.value,remove:J.value},null,"object").then(()=>{J.value=[],U.value=[],T.value=[]}))},sd:l=>{l.forEach(a=>{a.forEach(u=>{u.elements.forEach(s=>{z.value=s.name==="Dropdown"&&s.model==="Dropdown"})})})}}}const Ne={id:"project_plans",class:"panel-board relative"},Pe={class:"part-wrap"},Se={class:"cm-spreadsheet-wrapper overflow-x"},Ue={class:"sh-container ss-container flex"},Te=o("div",{class:"sheet-cell handle bfd sheet-cell flex align-center"},null,-1),Je=o("div",{class:"sheet-cell num bfd flex align-center"},"\u9806\u756A",-1),Le={class:"list-cell flex align-center relative pointer"},Me={class:"sheet-cell column-1 edit-cell value flex align-center"},He=o("span",{class:"flex align-center justify-center handle grab"},[o("i",{class:"pi pi-bars"})],-1),ze={class:"context th-context block"},Qe=["onClick"],Ye=o("i",{class:"pi pi-pencil"},null,-1),Ge=[Ye],Ke=o("span",{class:"text flex align-center justify-center"},[o("i",{class:"pi pi-plus"})],-1),We=[Ke],Xe=["onClick","onContextmenu"],Ze=o("div",{class:"sheet-cell handle bfd flex align-center justify-center grab"},[o("i",{class:"pi pi-bars"})],-1),el={class:"sheet-cell num bfd flex align-center"},ll={class:"sheet-cell value flex align-center"},nl={key:1,class:"context block"},tl=["onUpdate:modelValue"],ol=["onClick"],sl=o("i",{class:"pi pi-times"},null,-1),al=[sl],ul={class:"button-wrapper flex justify-end"},il={class:"action-wrapper flex align-center"},Nl=_e({__name:"ProjectPlans",setup(N){const{reform:y,query:$,dropdown:I,d:D,d2:d,dr:x,rm:F,data:Q,response:k,q1:L,containerId:oe,loading:se,content:P,project:j,progress:r,fields:M,contents:Y,rightClickMenu:_,rcm:m,isRCOn:G,submit:V,submitRowReorder:H,reorderOptions:b,saveRow:K,removeItem:C,cr:S,cf:W,ef:X,ec:z,co:U,ro:T,so:J,sd:B}=Re();return Z(()=>D.value,E=>{E||(I.value=E)}),Z(()=>k.value,E=>{J(E)}),Z(()=>y.value,E=>{B(E)},{deep:!0}),(E,t)=>(A(),R("div",Ne,[c(we,{modelValue:e(P),"onUpdate:modelValue":t[0]||(t[0]=n=>g(P)?P.value=n:null)},null,8,["modelValue"]),c(De,{class:"justify-space-between"},{default:h(()=>[o("div",Pe,[c(e(be),{type:"button",class:"submit-button",icon:"pi pi-plus","icon-pos":"left",label:"\u884C\u3092\u8FFD\u52A0",onClick:t[1]||(t[1]=n=>e(S)())})])]),_:1}),o("div",Se,[o("div",Ue,[Te,Je,c(e(pe),{tag:"div",onEnd:t[2]||(t[2]=n=>e(H)({value:e(M)},{method:"post",endpoints:["app/plan_fields","project_details/"+e(j).id],state:"project"})),list:e(M),class:"sheet-row sheet-row-header flex align-center",handle:".handle","item-key":"id"},{item:h(({element:n,index:O})=>[o("div",Le,[o("div",Me,[He,o("span",ze,ee(n.name),1),o("span",{onClick:f=>e(X)(n),class:"edit flex align-center justify-center pointer"},Ge,8,Qe)])])]),_:1},8,["list"]),o("div",{onClick:t[3]||(t[3]=n=>e(W)()),class:"sheet-cell add bfd flex align-center pointer"},We)]),c(e(pe),{tag:"div",onEnd:t[4]||(t[4]=n=>e(H)({value:e(Y)},{method:"post",endpoints:["app/plan_contents","project_details/"+e(j).id],state:"project"})),list:e(Y),class:"cm-ss-body",handle:".handle","item-key":"id"},{item:h(({element:n,index:O})=>[o("div",{onClick:f=>e(z)(n),onContextmenu:f=>e(G)(f,n),"aria-haspopup":"true","aria-controls":"plan_rc_menu",class:"sb-container ss-container flex"},[c(e(Ce),{id:"rc_menu",ref_key:"rcm",ref:m,class:"rc has-final-action",model:e(_),popup:!0},null,8,["model"]),Ze,o("div",el,ee(O+1),1),(A(!0),R(he,null,xe(n.plan_contexts,(f,ae)=>(A(),R("div",{key:ae,class:"ss-contents flex"},[o("div",ll,[f.value||!f.image?(A(),R("span",{key:0,class:ge([{"number-price":["\u91D1\u984D","\u4FA1\u683C"].includes(f.plan_field.name)&&f.field==="InputNumber","number-text":!["\u91D1\u984D","\u4FA1\u683C"].includes(f.plan_field.name)&&f.field==="InputNumber"},"context block"])},ee(f.value),3)):(A(),R("span",nl,[f.image?(A(),de(Fe,{key:0,svg:"image"})):le("",!0)]))])]))),128))],40,Xe)]),_:1},8,["list"])]),c(ce,{modelValue:e(D),"onUpdate:modelValue":t[12]||(t[12]=n=>g(D)?D.value=n:null),title:"\u30D5\u30A3\u30FC\u30EB\u30C9\u30D5\u30A9\u30FC\u30E0",overflow:""},{default:h(()=>[c(Ae,{modelValue:e(D),"onUpdate:modelValue":t[6]||(t[6]=n=>g(D)?D.value=n:null),dr:e(x),"onUpdate:dr":t[7]||(t[7]=n=>g(x)?x.value=n:null),response:e(k),"onUpdate:response":t[8]||(t[8]=n=>g(k)?k.value=n:null),topProgress:"",closeAfter:"",progress:e(r),form:e(y),data:e(Q),loading:e(se),query:e($),remove:e(F),submit:e(V)},{default:h(()=>[e(I)?(A(),de(e(Ee),{key:0,value:e(L).plan_field_options,rowindex:"index",onRowReorder:e(b),responsiveLayout:"scroll",class:"option-datatable"},{default:h(()=>[c(e(ne),{rowReorder:!0,headerStyle:"width: 3rem",reorderableColumn:!1}),c(e(ne),{field:"name",header:"\u9805\u76EE\u540D"},{body:h(n=>[ye(o("input",{class:"option-input",type:"text","onUpdate:modelValue":O=>n.data.name=O,placeholder:"\u9078\u629E\u9805\u76EE"},null,8,tl),[[je,n.data.name]])]),_:1}),c(e(ne),{style:{width:"40px","text-align":"right","margin-left":"auto"},body:"index"},{body:h(n=>[o("span",{onClick:O=>e(T)(n.index),class:"remove pointer"},al,8,ol)]),_:1})]),_:1},8,["value","onRowReorder"])):le("",!0),e(I)?(A(),R("button",{key:1,onClick:t[5]||(t[5]=n=>e(U)()),class:"add-option"},"\u9078\u629E\u9805\u76EE\u3092\u8FFD\u52A0")):le("",!0)]),_:1},8,["modelValue","dr","response","progress","form","data","loading","query","remove","submit"]),c(Ie,{modelValue:e(x),"onUpdate:modelValue":t[11]||(t[11]=n=>g(x)?x.value=n:null)},{default:h(()=>[o("div",ul,[o("button",{onClick:t[9]||(t[9]=n=>x.value=!1),class:"cancel"},"\u3044\u3044\u3048"),o("button",{onClick:t[10]||(t[10]=n=>e(C)("app/plan_fields/")),class:"delete"},"\u306F\u3044")])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),c(ce,{modelValue:e(d),"onUpdate:modelValue":t[18]||(t[18]=n=>g(d)?d.value=n:null),title:"\u9593\u53D6\u308A\u30D5\u30A9\u30FC\u30E0",overflow:""},{default:h(()=>[c($e,{modelValue:e(d),"onUpdate:modelValue":t[15]||(t[15]=n=>g(d)?d.value=n:null),form:e(y),"onUpdate:form":t[16]||(t[16]=n=>g(y)?y.value=n:null),response:e(k),"onUpdate:response":t[17]||(t[17]=n=>g(k)?k.value=n:null),"close-after":"",topProgress:"",progress:e(r)},{actions:h(()=>[o("div",il,[o("button",{onClick:t[13]||(t[13]=n=>d.value=!1),class:"flex align-center justify-center cancel"},"\u4E2D\u6B62"),o("button",{onClick:t[14]||(t[14]=n=>e(K)()),class:"flex align-center justify-center submit-or-next"},"\u767B\u9332")])]),_:1},8,["modelValue","form","response","progress"])]),_:1},8,["modelValue"])]))}});export{Nl as default};
