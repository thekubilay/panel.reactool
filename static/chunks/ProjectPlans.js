import{q as re,c as ie,p as v,a as fe,t as Z,v as O,f as c,z as e,H as j,w as h,x as s,b as A,S as ve,K as ee,I as _e,J as be,y as he,e as de,A as le,F as xe,G as je}from"./vendor.js";import{D as pe}from"./vuedraggable.umd.js";import{s as ge}from"./menu.esm.js";import{a as ne,s as ye}from"./column.esm.js";import{a as Ce,u as Ee,_ as ce}from"./useFormRequestBuilder.js";import{S as we}from"./Spinner.js";import{_ as De}from"./BarTool.js";import{_ as Fe}from"./Icon.js";import{u as ke}from"./useRightClickHandler.js";import{A as Ve,u as qe}from"../main.js";import{_ as Ae}from"./FormQuery.js";import{_ as Ie}from"./FormNested.js";import{_ as Be}from"./DialogDelete.js";import"./overlayeventbus.esm.js";import"./dropdown.esm.js";import"./virtualscroller.esm.js";import"./plugin-vue_export-helper.js";const te=[[{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputText",db_column_name:"name",type:"text",model:null,label:"\u30D5\u30A1\u30A4\u30EB\u540D",hint:null,placeholder:"\u9593\u53D6\u308A",required:!0,id:"name_input",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-2-space"]},{component:null,name:"InputText",db_column_name:"class_name",type:"text",model:null,label:"CSS\u30AF\u30E9\u30B9",hint:null,placeholder:"class-name",required:!1,id:"class_name_input",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-2-space"]}]},{classes:["flex"],elements:[{component:null,name:"Dropdown",db_column_name:"type",type:"text",model:"InputText",label:"\u30BF\u30A4\u30D7",hint:null,required:!1,rules:[],id:"type_input",disabled:!1,options:[{name:"\u30C6\u30AD\u30B9\u30C8\u5217",value:"InputText"},{name:"\u6570\u5B57\u5217",value:"InputNumber"},{name:"\u9078\u629E\u5217",value:"Dropdown"},{name:"\u753B\u50CF\u5217",value:"FileInput"}],optionLabel:"name",optionValue:"value",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-1","relative"]}]}]],$e=[{classes:["flex"],elements:[{component:null,name:"Dropdown",db_column_name:"name",type:"text",model:null,label:"",hint:null,required:!1,rules:[],id:"",disabled:!1,options:[],optionLabel:"name",optionValue:"id",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-1","relative"]}]},{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputText",db_column_name:"name",type:"text",model:null,label:"",hint:null,placeholder:"\u30FC",required:!1,id:"",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-1"]}]},{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputNumber",db_column_name:"name",type:"text",model:0,label:"",hint:null,placeholder:"\u30FC",required:!1,id:"",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-1"]}]},{classes:["flex"],elements:[{component:null,name:"FileInput",db_column_name:"value",type:"text",model:null,label:"PIN",hint:".jpeg, .png \u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u3059",required:!1,id:"pin_input",preview_text:"\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u306E\u305F\u3081\u3001\u30AF\u30EA\u30C3\u30AF\u3084\u753B\u50CF\u30C9\u30ED\u30C3\u30D7\u3057\u3066\u304F\u3060\u3055\u3044",limit:"1MB\u4EE5\u4E0B",accept:"image/*",rules:[],rule:null,disabled:!1,props:["placeholder","required","disabled","accept","hint","model","preview_text"],classes:["flex-column","column-1"]}]}];function Re(N){const g=re({id:null,order_id:null,project:N.value.id,name:null,type:null,class_name:null,plan_field_options:[]}),I=re({id:null,order_id:null,plan_field:null,plan_content:null,value:null,field:null,image:null,thumbnail:null});return{q1:g,q2:I}}function Oe(){const{get:N,save:g}=Ve(),{d:I,dr:B,images:D,data:d,useToggle:x}=Ce(),{submit:F,submitRowReorder:Q,submitAsFormObject:k,remove:L}=Ee(),{rcm:se,rcmOpened:oe,isRCOn:S}=ke(d),{payload:y,project:i,progress:H,onload:G,content:_}=qe(),{q1:m,q2:K}=Re(i),V=ie(()=>{var l;return(l=i.value)==null?void 0:l.plan_fields}),M=ie(()=>{var l;return(l=i.value)==null?void 0:l.plan_contents}),b=v(te),Y=v(!1),C=v(),P=v(!1),W=v("image_input"),X=v(null),z=v(!1),T=v([]),U=v([]),J=v([]),$=v(!1),E=v([{label:"\u884C\u3092\u8907\u88FD\u3059\u308B",command:()=>{var l;_.value=!0,g("app/plan_contents",{duplicate:!0,project:(l=i.value)==null?void 0:l.id},"post").then(a=>{var o;const u=d.value.plan_contexts.map(r=>(r.plan_content=a.id,r.id=null,r));y.value={method:"post",endpoints:["app/plan_contexts","project_details/"+((o=i.value)==null?void 0:o.id)],state:"project"},F({duplicate:u},null,"object").then(()=>{_.value=!1})})}},{label:"\u884C\u3092\u524A\u9664\u3059\u308B",command:()=>{_.value=!0,L("app/plan_contents/"+d.value.id).then(()=>{var l;N("project_details/"+((l=i.value)==null?void 0:l.id),"project").then(()=>{_.value=!1})})}}]);return{reform:b,query:C,dropdown:z,d:I,d2:$,dr:B,rm:P,data:d,response:X,q1:m,containerId:W,loading:Y,content:_,project:i,progress:H,fields:V,contents:M,rightClickMenu:E,rcm:se,isRCOn:S,submit:F,submitRowReorder:Q,reorderOptions:l=>{m.plan_field_options=l.value},saveRow:()=>{var u;y.value={method:"post",endpoints:["app/plan_contexts","project_details/"+((u=i.value)==null?void 0:u.id)],state:"project"};let l={update:[]},a=[];d.value.plan_contexts.forEach((o,r)=>{if(o.value=b.value[0][r].elements[0].model,l.update.push({id:o.id,value:o.value}),o.field==="FileInput"){const w=new FormData;b.value[0][r].elements[0].model&&(w.append("image",b.value[0][r].elements[0].model),w.append("thumbnail",b.value[0][r].elements[0].model),a.push({id:o.id,data:w}))}}),F(l,null,"object").then(()=>{a.length?a.forEach((o,r)=>{var w;y.value={method:"patch",endpoints:["app/plan_contexts/"+o.id,"project_details/"+((w=i.value)==null?void 0:w.id)],state:"project"},F(o.data,null).then(()=>{a.length===r+1&&($.value=!1)})}):$.value=!1})},removeItem:l=>{_.value=!0,L(l+d.value.id).then(()=>{var a;I.value=!1,B.value=!1,N("project_details/"+((a=i.value)==null?void 0:a.id),"project").then(()=>{P.value=!1,_.value=!1})})},cr:()=>{var a,u,o;y.value={method:"post",endpoints:["app/plan_contents","project_details/"+((a=i.value)==null?void 0:a.id)],state:"project"},_.value=!0;const l=[];(u=V.value)==null||u.forEach(r=>{const w={id:null,order_id:null,plan_field:r,plan_content:null,value:"",field:r.type,image:null,thumbnail:null};l.push(w)}),F({create:l,project:(o=i.value)==null?void 0:o.id},null,"object").then(()=>{_.value=!1})},cf:()=>{var l;m.plan_field_options=[],C.value=m,C.value.order_id=V.value&&V.value.length?V.value.length+1:1,b.value=JSON.parse(JSON.stringify(te)),x({method:"post",endpoints:["app/plan_fields","project_details/"+((l=i.value)==null?void 0:l.id)],state:"project"})},ef:l=>{var a;P.value=!0,C.value=m,C.value.order_id=l.order_id,C.value.plan_field_options=l.plan_field_options,b.value=JSON.parse(JSON.stringify(te)),b.value.forEach(u=>{u.forEach(o=>{o.elements.forEach(r=>{r.db_column_name==="type"&&(r.disabled=!0)})})}),x({method:"patch",endpoints:["app/plan_fields/"+l.id,"project_details/"+((a=i.value)==null?void 0:a.id)],state:"project"},l)},ec:l=>{var u,o;C.value=K,d.value=l,y.value={method:"post",endpoints:["app/plan_contents/"+l.id,"project_details/"+((u=i.value)==null?void 0:u.id)],state:"project"};let a=[[]];(o=V.value)==null||o.forEach((r,w)=>{$e.forEach(ue=>{if(ue.elements[0].name===r.type){let p=JSON.parse(JSON.stringify(ue.elements[0]));p.db_column_name="value",p.label=r.name,l.plan_contexts.forEach(q=>{q.plan_field.id===r.id&&(["\u91D1\u984D","\u4FA1\u683C"].includes(r.name)&&(p.mode="currency",p.props.push("mode"),p.locale="jp-JP",p.props.push("locale"),p.currency="JPY",p.props.push("currency")),q.field==="InputNumber"?q.value&&q.value!==""?p.model=parseInt(q.value):p.model=null:(q.field==="Dropdown"&&(p.options=r.plan_field_options,p.optionValue="name"),p.model=q.value))});const me={classes:["flex"],elements:[p]};a[0].push(me)}})}),b.value=a,$.value=!0},co:()=>{const l={id:null,order_id:null,name:"\u9078\u629E\u9805\u76EE "+(m.plan_field_options.length+1),plan_field:null};m.plan_field_options.push(l),T.value.push(l)},ro:l=>{m.plan_field_options.forEach((u,o)=>{o===l&&u.id&&J.value.push(u.id)}),m.plan_field_options=m.plan_field_options.filter((u,o)=>o!==l)},so:l=>{var a;y.value={method:"post",endpoints:["app/plan_field_options","project_details/"+((a=i.value)==null?void 0:a.id)],state:"project"},l.hasOwnProperty("type")&&l.type==="Dropdown"&&(m.plan_field_options.forEach((u,o)=>{u.order_id=o+1,u.plan_field=l.id,u.id&&U.value.push(u)}),F({create:T.value,update:U.value,remove:J.value},null,"object").then(()=>{J.value=[],T.value=[],U.value=[]}))},sd:l=>{l.forEach(a=>{a.forEach(u=>{u.elements.forEach(o=>{z.value=o.name==="Dropdown"&&o.model==="Dropdown"})})})}}}const Ne={id:"project_plans",class:"panel-board relative"},Se={class:"part-wrap"},Pe={class:"cm-spreadsheet-wrapper overflow-x"},Te={class:"sh-container ss-container flex"},Ue=s("div",{class:"sheet-cell handle bfd sheet-cell flex align-center"},null,-1),Je=s("div",{class:"sheet-cell num bfd flex align-center"},"\u9806\u756A",-1),Le={class:"list-cell flex align-center relative pointer"},He={class:"sheet-cell column-1 edit-cell value flex align-center"},Me=s("span",{class:"flex align-center justify-center handle grab"},[s("i",{class:"pi pi-bars"})],-1),ze={class:"context th-context block"},Qe=["onClick"],Ge=s("i",{class:"pi pi-pencil"},null,-1),Ke=[Ge],Ye=s("span",{class:"text flex align-center justify-center"},[s("i",{class:"pi pi-plus"})],-1),We=[Ye],Xe=["onClick","onContextmenu"],Ze=s("div",{class:"sheet-cell handle bfd flex align-center justify-center grab"},[s("i",{class:"pi pi-bars"})],-1),el={class:"sheet-cell num bfd flex align-center"},ll={class:"sheet-cell value flex align-center"},nl={key:1,class:"context block"},tl=["onUpdate:modelValue"],sl=["onClick"],ol=s("i",{class:"pi pi-times"},null,-1),al=[ol],ul={class:"button-wrapper flex justify-end"},rl={class:"action-wrapper flex align-center"},Bl=fe({setup(N){const{reform:g,query:I,dropdown:B,d:D,d2:d,dr:x,rm:F,data:Q,response:k,q1:L,containerId:se,loading:oe,content:S,project:y,progress:i,fields:H,contents:G,rightClickMenu:_,rcm:m,isRCOn:K,submit:V,submitRowReorder:M,reorderOptions:b,saveRow:Y,removeItem:C,cr:P,cf:W,ef:X,ec:z,co:T,ro:U,so:J,sd:$}=Oe();return Z(()=>D.value,E=>{E||(B.value=E)}),Z(()=>k.value,E=>{J(E)}),Z(()=>g.value,E=>{$(E)},{deep:!0}),(E,t)=>(A(),O("div",Ne,[c(we,{modelValue:e(S),"onUpdate:modelValue":t[0]||(t[0]=n=>j(S)?S.value=n:null)},null,8,["modelValue"]),c(De,{class:"justify-space-between"},{default:h(()=>[s("div",Se,[c(e(ve),{type:"button",class:"submit-button",icon:"pi pi-plus","icon-pos":"left",label:"\u884C\u3092\u8FFD\u52A0",onClick:t[1]||(t[1]=n=>e(P)())})])]),_:1}),s("div",Pe,[s("div",Te,[Ue,Je,c(e(pe),{tag:"div",onEnd:t[2]||(t[2]=n=>e(M)({value:e(H)},{method:"post",endpoints:["app/plan_fields","project_details/"+e(y).id],state:"project"})),list:e(H),class:"sheet-row sheet-row-header flex align-center",handle:".handle","item-key":"id"},{item:h(({element:n,index:R})=>[s("div",Le,[s("div",He,[Me,s("span",ze,ee(n.name),1),s("span",{onClick:f=>e(X)(n),class:"edit flex align-center justify-center pointer"},Ke,8,Qe)])])]),_:1},8,["list"]),s("div",{onClick:t[3]||(t[3]=n=>e(W)()),class:"sheet-cell add bfd flex align-center pointer"},We)]),c(e(pe),{tag:"div",onEnd:t[4]||(t[4]=n=>e(M)({value:e(G)},{method:"post",endpoints:["app/plan_contents","project_details/"+e(y).id],state:"project"})),list:e(G),class:"cm-ss-body",handle:".handle","item-key":"id"},{item:h(({element:n,index:R})=>[s("div",{onClick:f=>e(z)(n),onContextmenu:f=>e(K)(f,n),"aria-haspopup":"true","aria-controls":"plan_rc_menu",class:"sb-container ss-container flex"},[c(e(ge),{id:"rc_menu",ref_key:"rcm",ref:m,class:"rc has-final-action",model:e(_),popup:!0},null,8,["model"]),Ze,s("div",el,ee(R+1),1),(A(!0),O(_e,null,be(n.plan_contexts,(f,ae)=>(A(),O("div",{key:ae,class:"ss-contents flex"},[s("div",ll,[f.value||!f.image?(A(),O("span",{key:0,class:he([{"number-price":["\u91D1\u984D","\u4FA1\u683C"].includes(f.plan_field.name)&&f.field==="InputNumber","number-text":!["\u91D1\u984D","\u4FA1\u683C"].includes(f.plan_field.name)&&f.field==="InputNumber"},"context block"])},ee(f.value),3)):(A(),O("span",nl,[f.image?(A(),de(Fe,{key:0,svg:"image"})):le("",!0)]))])]))),128))],40,Xe)]),_:1},8,["list"])]),c(ce,{modelValue:e(D),"onUpdate:modelValue":t[12]||(t[12]=n=>j(D)?D.value=n:null),title:"\u30D5\u30A3\u30FC\u30EB\u30C9\u30D5\u30A9\u30FC\u30E0",overflow:""},{default:h(()=>[c(Ae,{modelValue:e(D),"onUpdate:modelValue":t[6]||(t[6]=n=>j(D)?D.value=n:null),dr:e(x),"onUpdate:dr":t[7]||(t[7]=n=>j(x)?x.value=n:null),response:e(k),"onUpdate:response":t[8]||(t[8]=n=>j(k)?k.value=n:null),topProgress:"",closeAfter:"",progress:e(i),form:e(g),data:e(Q),loading:e(oe),query:e(I),remove:e(F),submit:e(V)},{default:h(()=>[e(B)?(A(),de(e(ye),{key:0,value:e(L).plan_field_options,rowindex:"index",onRowReorder:e(b),responsiveLayout:"scroll",class:"option-datatable"},{default:h(()=>[c(e(ne),{rowReorder:!0,headerStyle:"width: 3rem",reorderableColumn:!1}),c(e(ne),{field:"name",header:"\u9805\u76EE\u540D"},{body:h(n=>[xe(s("input",{class:"option-input",type:"text","onUpdate:modelValue":R=>n.data.name=R,placeholder:"\u9078\u629E\u9805\u76EE"},null,8,tl),[[je,n.data.name]])]),_:1}),c(e(ne),{style:{width:"40px","text-align":"right","margin-left":"auto"},body:"index"},{body:h(n=>[s("span",{onClick:R=>e(U)(n.index),class:"remove pointer"},al,8,sl)]),_:1})]),_:1},8,["value","onRowReorder"])):le("",!0),e(B)?(A(),O("button",{key:1,onClick:t[5]||(t[5]=n=>e(T)()),class:"add-option"},"\u9078\u629E\u9805\u76EE\u3092\u8FFD\u52A0")):le("",!0)]),_:1},8,["modelValue","dr","response","progress","form","data","loading","query","remove","submit"]),c(Be,{modelValue:e(x),"onUpdate:modelValue":t[11]||(t[11]=n=>j(x)?x.value=n:null)},{default:h(()=>[s("div",ul,[s("button",{onClick:t[9]||(t[9]=n=>x.value=!1),class:"cancel"},"\u3044\u3044\u3048"),s("button",{onClick:t[10]||(t[10]=n=>e(C)("app/plan_fields/")),class:"delete"},"\u306F\u3044")])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),c(ce,{modelValue:e(d),"onUpdate:modelValue":t[18]||(t[18]=n=>j(d)?d.value=n:null),title:"\u9593\u53D6\u308A\u30D5\u30A9\u30FC\u30E0",overflow:""},{default:h(()=>[c(Ie,{modelValue:e(d),"onUpdate:modelValue":t[15]||(t[15]=n=>j(d)?d.value=n:null),form:e(g),"onUpdate:form":t[16]||(t[16]=n=>j(g)?g.value=n:null),response:e(k),"onUpdate:response":t[17]||(t[17]=n=>j(k)?k.value=n:null),"close-after":"",topProgress:"",progress:e(i)},{actions:h(()=>[s("div",rl,[s("button",{onClick:t[13]||(t[13]=n=>d.value=!1),class:"flex align-center justify-center cancel"},"\u4E2D\u6B62"),s("button",{onClick:t[14]||(t[14]=n=>e(Y)()),class:"flex align-center justify-center submit-or-next"},"\u767B\u9332")])]),_:1},8,["modelValue","form","response","progress"])]),_:1},8,["modelValue"])]))}});export{Bl as default};
