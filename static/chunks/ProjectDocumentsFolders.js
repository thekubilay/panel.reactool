import{D as N}from"./vuedraggable.umd.js";import{J as H,d as M,j as O,k as T,A as z,u as J,r as m,l as L,w as G,c as K,b as u,f as s,z as p,q as v,e as o,a1 as Q,o as W,L as D,t as b}from"../main.js";import{s as X}from"./menu.esm.js";import{S as Y}from"./Spinner.js";import{_ as Z}from"./BarTool.js";import{_ as ee}from"./Dialog.js";import{_ as te}from"./FormQuery.js";import{_ as le}from"./DialogDelete.js";import{a as se,u as oe}from"./useFormRequestBuilder.js";import{u as ae}from"./useRightClickHandler.js";import"./_commonjsHelpers.js";import"./portal.esm.js";import"./plugin-vue_export-helper.js";const ue=[[{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputText",db_column_name:"name",type:"text",model:null,label:"\u30D5\u30A9\u30EB\u30C0\u30FC\u540D",hint:null,placeholder:"\u9593\u53D6\u308A\u56F3PDF\u30D5\u30A9\u30EB\u30C0\u30FC",required:!0,id:"name_input",rules:[],disabled:!H().user.is_staff,props:["placeholder","required"],classes:["flex-column","column-1"]}]}]];const ne={id:"project_folders",class:"panel-board relative"},re={class:"part-wrap"},ie={class:"part-wrap part-end"},de={class:"spreadsheet-wrapper overflow-x"},ce=Q('<div class="sh-container ss-container"><div class="sheet-row sheet-row-header flex align-center"><div class="sheet-cell handle flex align-center"></div><div class="sheet-cell num flex align-center">\u9806\u756A</div><div class="sheet-cell value flex align-center">\u30D5\u30A9\u30EB\u30C0\u30FC\u540D</div><div class="sheet-cell value flex align-center">\u66F8\u985E\u6570</div></div></div>',1),pe=["onClick","onContextmenu"],me=o("div",{class:"sheet-cell handle flex align-center justify-center grab"},[o("i",{class:"pi pi-bars"})],-1),ve={class:"sheet-cell num flex align-center"},fe={class:"sheet-cell value flex align-center"},_e={class:"context block"},he={class:"sheet-cell num flex align-center"},ge={class:"context block"},be={class:"button-wrapper flex justify-end"},Se=M({__name:"ProjectDocumentsFolders",setup(Ce){const F=O(),C=T(),{get:f,save:y}=z(),{d:r,dr:n,images:k,data:d,useToggle:_}=se(),{submit:V,submitRowReorder:w,remove:j}=oe(),{rcm:A,rcmOpened:B,isRCOn:E}=ae(d),{payload:je,project:a,progress:$,onload:xe,content:i}=J(),c=m([]),h=m(!1),g=m(!1);L(()=>{var t;c.value=(t=a.value)==null?void 0:t.document_folders});function R(){F.push({name:"ProjectDocuments",params:{cid:C.params.cid,dynid:C.params.dynid}})}function q(){var t;h.value=!1,_({method:"post",endpoints:["app/document_folders","project_details/"+((t=a.value)==null?void 0:t.id)],state:"project"})}function P(t){var e;h.value=!0,B.value||(k.value=t.pin?[{image:t.pin}]:[],_({method:"patch",endpoints:["app/document_folders/"+t.id,"project_details/"+((e=a.value)==null?void 0:e.id)],state:"project"},t))}function S(){var t;g.value=!0,j("app/document_folders/"+((t=d.value)==null?void 0:t.id)).then(()=>{var e;f("project_details/"+((e=a.value)==null?void 0:e.id),"project").then(()=>{g.value=!1,n.value=!1,r.value=!1})})}const U=m([{label:"\u65B0\u898F\u30D5\u30A9\u30EB\u30C0\u30FC",command:()=>{var t;_({method:"post",endpoints:["app/document_folders","project_details/"+((t=a.value)==null?void 0:t.id)],state:"project"})}},{label:"\u884C\u3092\u8907\u88FD\u3059\u308B",command:()=>{var e;i.value=!0;const t={id:null,order_id:c.value?c.value.length+1:1,project:a.value?(e=a.value)==null?void 0:e.id:null,name:d.value.name,color:d.value.color,pin:null};y("app/document_folders",t).then(()=>{var l;f("project_details/"+((l=a.value)==null?void 0:l.id),"project").then(()=>{i.value=!1})})}},{label:"\u884C\u3092\u524A\u9664\u3059\u308B",command:()=>{var t;i.value=!0,j("app/document_folders/"+((t=d.value)==null?void 0:t.id)).then(()=>{var e;f("project_details/"+((e=a.value)==null?void 0:e.id),"project").then(()=>{i.value=!1})})}}]);return G(()=>a.value,t=>{c.value=t==null?void 0:t.document_folders}),(t,e)=>(W(),K("div",ne,[u(Y,{modelValue:s(i),"onUpdate:modelValue":e[0]||(e[0]=l=>p(i)?i.value=l:null)},null,8,["modelValue"]),u(Z,{class:"justify-space-between"},{default:v(()=>[o("div",re,[u(s(D),{type:"button",class:"submit-button",icon:"pi pi-plus","icon-pos":"left",label:"\u30D5\u30A9\u30EB\u30C0\u30FC\u3092\u8FFD\u52A0",onClick:e[1]||(e[1]=l=>q())})]),o("div",ie,[u(s(D),{onClick:e[2]||(e[2]=l=>R()),type:"button",class:"tool-button",label:"\u66F8\u985E\u4E00\u89A7\u3078"})])]),_:1}),o("div",de,[ce,u(s(N),{tag:"div",onEnd:e[3]||(e[3]=l=>s(w)({value:c.value},{method:"post",endpoints:["app/document_folders","project_details/"+s(a).id],state:"project"})),list:c.value,class:"sb-container ss-container",handle:".handle","item-key":"id"},{item:v(({element:l,index:I})=>[o("div",{onClick:x=>P(l),onContextmenu:x=>s(E)(x,l),class:"sheet-row flex align-center list-group-item relative pointer","aria-haspopup":"true","aria-controls":"plan_rc_menu"},[u(s(X),{id:"rc_menu",ref_key:"rcm",ref:A,class:"rc has-final-action",model:U.value,popup:!0},null,8,["model"]),me,o("div",ve,b(I+1),1),o("div",fe,[o("span",_e,b(l.name),1)]),o("div",he,[o("span",ge,b(l.documents.length)+"\u500B",1)])],40,pe)]),_:1},8,["list"])]),u(ee,{modelValue:s(r),"onUpdate:modelValue":e[9]||(e[9]=l=>p(r)?r.value=l:null),title:"\u30D5\u30A9\u30EB\u30C0\u30FC\u30D5\u30A9\u30FC\u30E0"},{default:v(()=>[u(te,{modelValue:s(r),"onUpdate:modelValue":e[4]||(e[4]=l=>p(r)?r.value=l:null),dr:s(n),"onUpdate:dr":e[5]||(e[5]=l=>p(n)?n.value=l:null),"close-after":"",topProgress:"",progress:s($),form:s(ue),data:s(d),loading:g.value,query:{project:s(a).id},remove:h.value,submit:s(V)},null,8,["modelValue","dr","progress","form","data","loading","query","remove","submit"]),u(le,{modelValue:s(n),"onUpdate:modelValue":e[8]||(e[8]=l=>p(n)?n.value=l:null)},{default:v(()=>[o("div",be,[o("button",{onClick:e[6]||(e[6]=l=>n.value=!1),class:"cancel"},"\u3044\u3044\u3048"),o("button",{onClick:e[7]||(e[7]=l=>S()),class:"delete"},"\u306F\u3044")])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]))}});export{Se as default};
