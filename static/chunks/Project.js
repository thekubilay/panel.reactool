import{a as je,p as i,o as ke,t as B,v as q,f as s,w as p,E as De,r as _e,b as C,x as o,z as t,I as Ee,J as Te,e as N,C as U,K as Ve,H as D,A as fe,F as Pe,G as Ie,T as qe,g as Ne,L as $}from"./vendor.js";import{s as Ue,a as E}from"./column.esm.js";import{_ as $e}from"./BarTool.js";import{u as Se,a as Le,_ as Fe}from"./useFormRequestBuilder.js";import{_ as Re}from"./ButtonDropdown.js";import{_ as Oe}from"./FormQuery.js";import{_ as He}from"./ContextImagesThumbnailContainer.js";import{_ as Je}from"./FormNested.js";import{A as Me,u as ze}from"../main.js";import{u as ge}from"./FormProject.js";import{u as be}from"./useUtils.js";import"./dropdown.esm.js";import"./overlayeventbus.esm.js";import"./virtualscroller.esm.js";import"./menu.esm.js";import"./Spinner.js";import"./plugin-vue_export-helper.js";import"./Icon.js";import"./rules.js";const Ge=[[{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputText",db_column_name:"name",type:"text",model:null,label:"\u30C8\u30FC\u30AF\u30F3\u540D",hint:null,placeholder:"AAA\u304A\u5BA2\u69D8",required:!0,id:"token_input",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-2-space"]},{component:null,name:"Dropdown",db_column_name:"permanent",type:"text",model:!1,label:"\u6052\u4E45\u7684",hint:"\u300C\u306F\u3044\u300D\u306B\u3059\u308B\u3068\u3001\u671F\u9593\u30EA\u30DF\u30C3\u30C8\u306A\u3057\u306B\u306A\u308A\u307E\u3059",required:!1,rules:[],id:"master_token_input",disabled:!1,options:[{name:"\u306F\u3044",value:!0},{name:"\u3044\u3044\u3048",value:!1}],optionLabel:"name",optionValue:"value",placeholder:"\u6A29\u9650\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-2-space","relative"]}]},{classes:["flex","justify-space-between"],elements:[{component:null,name:"CalendarInput",db_column_name:"start_date",type:"text",model:new Date,label:"\u898B\u308B\u671F\u9593\u7D42\u958B\u59CB\u65E5",hint:null,placeholder:"null",required:!0,id:"start_date_input",rules:[],dateFormat:"yy\u5E74mm\u6708dd\u65E5",disabled:!1,appendTo:"self",props:["placeholder","required","disabled","dateFormat","appendTo"],classes:["flex-column","column-2-space"]},{component:null,name:"CalendarInput",db_column_name:"end_date",type:"text",model:new Date,label:"\u898B\u308B\u671F\u9593\u7D42\u4E86\u65E5",hint:null,placeholder:"null",required:!0,id:"end_date_input",rules:[],dateFormat:"yy\u5E74mm\u6708dd\u65E5",appendTo:"self",disabled:!1,props:["placeholder","required","disabled","dateFormat","appendTo"],classes:["flex-column","column-2-space"]}]}]];const Ke={id:"project"},Qe={class:"part-wrap flex align-center relative"},We=["innerHTML"],Xe=["href"],Ye=o("span",{class:"divider"},null,-1),Ze={class:"part-wrap flex align-center"},eu={key:0,class:"token-dialog"},uu={class:"window"},lu=o("h4",{class:"title"},"\u65B0\u898F\u30C8\u30FC\u30AF\u30F3",-1),au={class:"copy-container relative"},tu=o("p",{class:"warning-text"},[U(" *\u4F5C\u6210\u3055\u308C\u305F\u30C8\u30FC\u30AF\u30F3\u306F\u3001\u30C8\u30FC\u30AF\u30F3\u540D\u3068\u65E5\u4ED8\u542B\u3081\u3066API\u30C8\u30FC\u30AF\u30F3\u4E00\u89A7\u306B\u767B\u9332\u3055\u308C\u3066\u3044\u307E\u3059\u3002"),o("br"),U(" **\u3053\u3061\u3089\u306E\u30C8\u30FC\u30AF\u30F3\u304B\u3089\u6A29\u9650\u3092\u5916\u3057\u305F\u3044\u5834\u5408\u3001\u4E00\u89A7\u304B\u3089\u6D88\u3057\u3066\u304F\u3060\u3055\u3044\u3002")],-1),ou={class:"action-wrapper flex justify-end"},nu=["onClick"],su=o("i",{class:"pi pi-times"},null,-1),iu=[su],Eu=je({setup(ru){var M;const{get:Ce}=Me(),{submit:T,remove:he}=Se(),{payload:ye,user:h,project:e,progress:du,onload:j}=ze(),{checkPermission:S,findAndUpdateFormElement:L}=be(),{d:F,d2:g,dpc:y,data:R,images:m,useToggle:O}=Le(),{copyText:Ae}=be(),H=i("https://test.reactool.jp/"+((M=e.value)==null?void 0:M.id)),we=De(),A=i(null),w=i(""),V=i(""),c=i(ge),_=i(!1),r=i(0),P=i("pin_input"),b=i([]),k=i(["\u8A73\u7D30","\u8A2D\u5B9A","\u5730\u56F3\u306E\u30D4\u30F3","\u30ED\u30B4\u753B\u50CF"]),f=i({}),I=i([{label:"\u7DE8\u96C6",icon:"pi pi-pencil",command:()=>{var u,l,n;j.value="",V.value=((u=e.value)==null?void 0:u.name)||"",k.value=["\u8A73\u7D30","\u8A2D\u5B9A","\u5730\u56F3\u306E\u30D4\u30F3","\u30ED\u30B4\u753B\u50CF"],c.value=ge,!S((l=e.value)==null?void 0:l.permissions,"is_token")&&!((n=h.value)==null?void 0:n.is_superuser)?c.value=L(c.value,"token_on","disabled",!0,1):c.value=L(c.value,"token_on","disabled",!1,1),f.value={id:null,name:null,company:null},$(()=>{var v,a;O({method:"patch",endpoints:["projects/"+((v=e.value)==null?void 0:v.id),"project_details/"+((a=e.value)==null?void 0:a.id)],state:"project"},e.value)})}},{label:"API\u30C8\u30FC\u30AF\u30F3\u4F5C\u6210",icon:"pi pi-unlock",command:()=>{var u;j.value="\u30C8\u30FC\u30AF\u30F3\u4F5C\u6210\u4E2D",V.value="\u30C8\u30FC\u30AF\u30F3",k.value=[],f.value={project:(u=e.value)==null?void 0:u.id},c.value=Ge,c.value[0][1].elements[0].model=new Date,c.value[0][1].elements[1].model=new Date,$(()=>{var l;O({method:"post",endpoints:["project_api_tokens","project_details/"+((l=e.value)==null?void 0:l.id)],state:"project"})})}},{label:"API\u30C8\u30FC\u30AF\u30F3\u4E00\u89A7",icon:"pi pi-list",command:()=>{g.value=!0}},{label:"JSON \u30A8\u30AF\u30B9\u30DD\u30FC\u30C8",icon:"pi pi-database",command:()=>{var u;window.open("https://test-panel.reactool.jp/api/project_details/"+((u=e.value)==null?void 0:u.id)+"/?format=json","_blank")}}]);ke(()=>{var u;S((u=e.value)==null?void 0:u.permissions,"is_token")||(I.value=I.value.filter(l=>!["API\u30C8\u30FC\u30AF\u30F3\u4F5C\u6210","API\u30C8\u30FC\u30AF\u30F3\u4E00\u89A7"].includes(l.label))),J()});function J(){var u,l,n,v,a;b.value=JSON.parse(JSON.stringify(((u=e.value)==null?void 0:u.routes)||[])).filter(d=>d.active).filter(d=>!["Frame1","Frame2"].includes(d.component)),(((l=h.value)==null?void 0:l.is_staff)||((n=h.value)==null?void 0:n.is_superuser))&&(b.value.unshift({panel_name:"ProjectRoutes",title:"\u30EB\u30FC\u30C8"}),b.value.unshift({panel_name:"ProjectScopePermissions",title:"\u30D1\u30FC\u30DF\u30C3\u30B7\u30E7\u30F3"})),!((v=h.value)==null?void 0:v.company_owner)&&((a=h.value)==null?void 0:a.company)===29499988&&(b.value=b.value.filter(d=>!["ColorSimulator","Plans","VistaSimulator"].includes(d.name)))}function xe(){var u;_.value=!0,ye.value={method:"patch",endpoints:["projects/"+R.value.id,"project_details/"+((u=e.value)==null?void 0:u.id)],state:"project"},r.value===2?T({pin:null},null,"object").then(()=>{_.value=!1,m.value=[]}):r.value===3&&T({logo:null},null,"object").then(()=>{_.value=!1,m.value=[]})}function Be(u){_.value=!0,he("project_api_tokens/"+u).then(()=>{var l;Ce("project_details/"+((l=e.value)==null?void 0:l.id),"project").then(()=>{setTimeout(()=>{_.value=!1},500)})})}return B(()=>e.value,u=>{J(),H.value="https://test.reactool.jp/"+(u==null?void 0:u.id),r.value===2?m.value=(u==null?void 0:u.pin)?[{image:u.pin}]:[]:r.value===3&&(m.value=(u==null?void 0:u.logo)?[{image:u.logo}]:[])}),B(()=>A.value,u=>{u&&f.value.hasOwnProperty("project")&&(j.value="encryption \u30B9\u30BF\u30FC\u30C8",_.value=!0,setTimeout(()=>{var n;const l="https://test.reactool.jp/";w.value=l+((n=e.value)==null?void 0:n.id)+"/?token="+u.token_id,_.value=!1,$(()=>{y.value=!0})},2e3))}),B(()=>F.value,u=>{u||(y.value=!1,r.value=0,w.value="",A.value=null)}),B(()=>y.value,u=>{u||(w.value="",A.value=null)}),B(()=>r.value,u=>{var l,n,v,a,d,x,z,G,K,Q,W,X,Y,Z,ee,ue,le,ae,te,oe,ne,se,ie,re,de,ve,pe,me,ce;u===0?(m.value=[],f.value={id:null,order_id:null,name:(l=e.value)==null?void 0:l.name,context:(n=e.value)==null?void 0:n.context,address:(v=e.value)==null?void 0:v.address,archive:(a=e.value)==null?void 0:a.archive,token_on:(d=e.value)==null?void 0:d.token_on,salon_view:(x=e.value)==null?void 0:x.salon_view,legacy:(z=e.value)==null?void 0:z.legacy,tab_logo_view:(G=e.value)==null?void 0:G.tab_logo_view,tab_logo_text:(K=e.value)==null?void 0:K.tab_logo_text}):u===1?(m.value=[],f.value={salon:(Q=e.value)==null?void 0:Q.salon,salon_view:(W=e.value)==null?void 0:W.salon_view,archive:(X=e.value)==null?void 0:X.archive,token_on:(Y=e.value)==null?void 0:Y.token_on,tab_logo_view:(Z=e.value)==null?void 0:Z.tab_logo_view,tab_logo_text:(ee=e.value)==null?void 0:ee.tab_logo_text}):u===2?(f.value={logo:null,logo_width:null,logo_height:null,logo_place:3,archive:(ue=e.value)==null?void 0:ue.archive,token_on:(le=e.value)==null?void 0:le.token_on,salon_view:(ae=e.value)==null?void 0:ae.salon_view,legacy:(te=e.value)==null?void 0:te.legacy,tab_logo_view:(oe=e.value)==null?void 0:oe.tab_logo_view,tab_logo_text:(ne=e.value)==null?void 0:ne.tab_logo_text},m.value=((se=e.value)==null?void 0:se.pin)?[{image:e.value.pin}]:[],P.value="pin_input"):u===3&&(f.value={pin:null,pin_width:(ie=e.value)==null?void 0:ie.pin_width,pin_height:(re=e.value)==null?void 0:re.pin_height,archive:(de=e.value)==null?void 0:de.archive,token_on:(ve=e.value)==null?void 0:ve.token_on,salon_view:(pe=e.value)==null?void 0:pe.salon_view,legacy:(me=e.value)==null?void 0:me.legacy},m.value=((ce=e.value)==null?void 0:ce.logo)?[{image:e.value.logo}]:[],P.value="logo_input")}),(u,l)=>{const n=_e("router-link"),v=_e("router-view");return C(),q("div",Ke,[s($e,null,{default:p(()=>[o("div",Qe,[o("h3",{class:"title",innerHTML:t(e).name},null,8,We),s(Re,{id:"project_setting",items:I.value},null,8,["items"]),o("a",{style:{"margin-left":"5px",color:"#2ecc71"},target:"_blank",href:H.value},"APP\u3078",8,Xe)]),Ye,o("div",Ze,[(C(!0),q(Ee,null,Te(b.value,(a,d)=>{var x;return C(),N(n,{key:d,class:"pn-item flex align-center justify-center","active-class":"active",to:{name:a==null?void 0:a.panel_name,params:{dynid:(x=t(we))==null?void 0:x.params.dynid}}},{default:p(()=>[U(Ve(a==null?void 0:a.title.replace("<br>","")),1)]),_:2},1032,["to"])}),128))]),s(Fe,{modelValue:t(F),"onUpdate:modelValue":l[6]||(l[6]=a=>D(F)?F.value=a:null),title:V.value.replaceAll("<br>",""),overflow:k.value.length>0&&r.value===3},{default:p(()=>[s(Oe,{modelValue:t(F),"onUpdate:modelValue":l[0]||(l[0]=a=>D(F)?F.value=a:null),response:A.value,"onUpdate:response":l[1]||(l[1]=a=>A.value=a),activeTab:r.value,"onUpdate:activeTab":l[2]||(l[2]=a=>r.value=a),onload:t(j),tabs:k.value,form:c.value,data:t(R),loading:_.value,query:f.value,submit:t(T)},{default:p(()=>[r.value===2||r.value===3?(C(),N(He,{key:0,containerId:P.value,images:t(m),remove:xe},null,8,["containerId","images"])):fe("",!0)]),_:1},8,["modelValue","response","activeTab","onload","tabs","form","data","loading","query","submit"]),t(y)?(C(),q("div",eu,[o("div",uu,[lu,o("div",au,[Pe(o("input",{id:"token_text",type:"text",disabled:"","onUpdate:modelValue":l[3]||(l[3]=a=>w.value=a)},null,512),[[Ie,w.value]]),o("i",{onClick:l[4]||(l[4]=a=>t(Ae)("token_text")),class:"pi pi-copy flex align-center justify-center"})]),tu,o("div",ou,[o("button",{onClick:l[5]||(l[5]=a=>y.value=!1)},"\u9589\u3058\u308B")])])])):fe("",!0)]),_:1},8,["modelValue","title","overflow"]),s(Fe,{modelValue:t(g),"onUpdate:modelValue":l[8]||(l[8]=a=>D(g)?g.value=a:null),title:"API\u30C8\u30FC\u30AF\u30F3\u4E00\u89A7",overflow:""},{default:p(()=>[s(Je,{modelValue:t(g),"onUpdate:modelValue":l[7]||(l[7]=a=>D(g)?g.value=a:null),form:[[]],loading:_.value},{default:p(()=>[s(t(Ue),{value:t(e).api_tokens,rowindex:"index",style:{"padding-bottom":"14px"},responsiveLayout:"scroll",class:"option-datatable"},{default:p(()=>[s(t(E),{field:"name",header:"\u30C8\u30FC\u30AF\u30F3\u540D"}),s(t(E),{field:"start_date",header:"\u958B\u59CB\u65E5"}),s(t(E),{field:"end_date",header:"\u7D42\u4E86\u65E5"}),s(t(E),{style:{width:"40px","text-align":"right","margin-left":"auto"},body:"index"},{body:p(a=>[o("span",{onClick:d=>Be(a.data.id),class:"remove pointer"},iu,8,nu)]),_:1})]),_:1},8,["value"])]),_:1},8,["modelValue","loading"])]),_:1},8,["modelValue"])]),_:1}),s(v,null,{default:p(({Component:a})=>[s(qe,{name:"fade",mode:"out-in"},{default:p(()=>[(C(),N(Ne(a)))]),_:2},1024)]),_:1})])}}});export{Eu as default};
