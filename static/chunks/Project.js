import{a as be,p as i,o as ye,t as B,v as q,f as s,w as v,E as Ae,r as re,b as g,x as o,z as t,I as we,J as xe,e as N,C as U,K as Be,H as D,A as de,F as je,G as ke,T as De,g as Ee,ae as $}from"./vendor.js";import{s as Te,a as E}from"./column.esm.js";import{_ as Ve}from"./BarTool.js";import{u as Pe,a as Ie,_ as pe}from"./useFormRequestBuilder.js";import{_ as qe}from"./ButtonDropdown.js";import{_ as Ne}from"./FormQuery.js";import{_ as Ue}from"./ContextImagesThumbnailContainer.js";import{_ as $e}from"./FormNested.js";import{A as Se,u as Le}from"../main.js";import{u as ve}from"./FormProject.js";import{u as me}from"./useUtils.js";import"./dropdown.esm.js";import"./overlayeventbus.esm.js";import"./virtualscroller.esm.js";import"./plugin-vue_export-helper.js";import"./menu.esm.js";import"./Icon.js";import"./rules.js";const Re=[[{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputText",db_column_name:"name",type:"text",model:null,label:"\u30C8\u30FC\u30AF\u30F3\u540D",hint:null,placeholder:"AAA\u304A\u5BA2\u69D8",required:!0,id:"token_input",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-2-space"]},{component:null,name:"Dropdown",db_column_name:"permanent",type:"text",model:!1,label:"\u6052\u4E45\u7684",hint:"\u300C\u306F\u3044\u300D\u306B\u3059\u308B\u3068\u3001\u671F\u9593\u30EA\u30DF\u30C3\u30C8\u306A\u3057\u306B\u306A\u308A\u307E\u3059",required:!1,rules:[],id:"master_token_input",disabled:!1,options:[{name:"\u306F\u3044",value:!0},{name:"\u3044\u3044\u3048",value:!1}],optionLabel:"name",optionValue:"value",placeholder:"\u6A29\u9650\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-2-space","relative"]}]},{classes:["flex","justify-space-between"],elements:[{component:null,name:"CalendarInput",db_column_name:"start_date",type:"text",model:new Date,label:"\u898B\u308B\u671F\u9593\u7D42\u958B\u59CB\u65E5",hint:null,placeholder:"null",required:!0,id:"start_date_input",rules:[],dateFormat:"yy\u5E74mm\u6708dd\u65E5",disabled:!1,appendTo:"self",props:["placeholder","required","disabled","dateFormat","appendTo"],classes:["flex-column","column-2-space"]},{component:null,name:"CalendarInput",db_column_name:"end_date",type:"text",model:new Date,label:"\u898B\u308B\u671F\u9593\u7D42\u4E86\u65E5",hint:null,placeholder:"null",required:!0,id:"end_date_input",rules:[],dateFormat:"yy\u5E74mm\u6708dd\u65E5",appendTo:"self",disabled:!1,props:["placeholder","required","disabled","dateFormat","appendTo"],classes:["flex-column","column-2-space"]}]}]];const Oe={id:"project"},He={class:"part-wrap flex align-center relative"},Je=["innerHTML"],Me=["href"],ze=o("span",{class:"divider"},null,-1),Ge={class:"part-wrap flex align-center"},Ke={key:0,class:"token-dialog"},Qe={class:"window"},We=o("h4",{class:"title"},"\u65B0\u898F\u30C8\u30FC\u30AF\u30F3",-1),Xe={class:"copy-container relative"},Ye=o("p",{class:"warning-text"},[U(" *\u4F5C\u6210\u3055\u308C\u305F\u30C8\u30FC\u30AF\u30F3\u306F\u3001\u30C8\u30FC\u30AF\u30F3\u540D\u3068\u65E5\u4ED8\u542B\u3081\u3066API\u30C8\u30FC\u30AF\u30F3\u4E00\u89A7\u306B\u767B\u9332\u3055\u308C\u3066\u3044\u307E\u3059\u3002"),o("br"),U(" **\u3053\u3061\u3089\u306E\u30C8\u30FC\u30AF\u30F3\u304B\u3089\u6A29\u9650\u3092\u5916\u3057\u305F\u3044\u5834\u5408\u3001\u4E00\u89A7\u304B\u3089\u6D88\u3057\u3066\u304F\u3060\u3055\u3044\u3002")],-1),Ze={class:"action-wrapper flex justify-end"},eu=["onClick"],uu=o("i",{class:"pi pi-times"},null,-1),lu=[uu],Au=be({setup(au){var M;const{get:ce}=Se(),{submit:T,remove:_e}=Pe(),{payload:fe,user:b,project:u,progress:tu,onload:j}=Le(),{checkPermission:S,findAndUpdateFormElement:L}=me(),{d:F,d2:C,dpc:y,data:R,images:m,useToggle:O}=Ie(),{copyText:Fe}=me(),H=i("https://test.reactool.jp/"+((M=u.value)==null?void 0:M.id)),Ce=Ae(),A=i(null),w=i(""),V=i(""),c=i(ve),_=i(!1),r=i(0),P=i("pin_input"),h=i([]),k=i(["\u8A73\u7D30","\u8A2D\u5B9A","\u5730\u56F3\u306E\u30D4\u30F3","\u30ED\u30B4\u753B\u50CF"]),f=i({}),I=i([{label:"\u7DE8\u96C6",icon:"pi pi-pencil",command:()=>{var e,l,n;j.value="",V.value=((e=u.value)==null?void 0:e.name)||"",k.value=["\u8A73\u7D30","\u8A2D\u5B9A","\u5730\u56F3\u306E\u30D4\u30F3","\u30ED\u30B4\u753B\u50CF"],c.value=ve,!S((l=u.value)==null?void 0:l.permissions,"is_token")&&!((n=b.value)==null?void 0:n.is_superuser)?c.value=L(c.value,"token_on","disabled",!0,1):c.value=L(c.value,"token_on","disabled",!1,1),f.value={id:null,name:null,company:null},$(()=>{var p,a;O({method:"patch",endpoints:["projects/"+((p=u.value)==null?void 0:p.id),"project_details/"+((a=u.value)==null?void 0:a.id)],state:"project"},u.value)})}},{label:"API\u30C8\u30FC\u30AF\u30F3\u4F5C\u6210",icon:"pi pi-unlock",command:()=>{var e;j.value="\u30C8\u30FC\u30AF\u30F3\u4F5C\u6210\u4E2D",V.value="\u30C8\u30FC\u30AF\u30F3",k.value=[],f.value={project:(e=u.value)==null?void 0:e.id},c.value=Re,c.value[0][1].elements[0].model=new Date,c.value[0][1].elements[1].model=new Date,$(()=>{var l;O({method:"post",endpoints:["project_api_tokens","project_details/"+((l=u.value)==null?void 0:l.id)],state:"project"})})}},{label:"API\u30C8\u30FC\u30AF\u30F3\u4E00\u89A7",icon:"pi pi-list",command:()=>{C.value=!0}},{label:"JSON \u30A8\u30AF\u30B9\u30DD\u30FC\u30C8",icon:"pi pi-database",command:()=>{var e;window.open("https://test-panel.reactool.jp/api/project_details/"+((e=u.value)==null?void 0:e.id)+"/?format=json","_blank")}}]);ye(()=>{var e;S((e=u.value)==null?void 0:e.permissions,"is_token")||(I.value=I.value.filter(l=>!["API\u30C8\u30FC\u30AF\u30F3\u4F5C\u6210","API\u30C8\u30FC\u30AF\u30F3\u4E00\u89A7"].includes(l.label))),J()});function J(){var e,l,n,p,a;h.value=JSON.parse(JSON.stringify(((e=u.value)==null?void 0:e.routes)||[])).filter(d=>d.active).filter(d=>!["Frame1","Frame2"].includes(d.component)),(((l=b.value)==null?void 0:l.is_staff)||((n=b.value)==null?void 0:n.is_superuser))&&(h.value.unshift({panel_name:"ProjectRoutes",title:"\u30EB\u30FC\u30C8"}),h.value.unshift({panel_name:"ProjectScopePermissions",title:"\u30D1\u30FC\u30DF\u30C3\u30B7\u30E7\u30F3"})),!((p=b.value)==null?void 0:p.company_owner)&&((a=b.value)==null?void 0:a.company)===29499988&&(h.value=h.value.filter(d=>!["ColorSimulator","Plans","VistaSimulator"].includes(d.name)))}function he(){var e;_.value=!0,fe.value={method:"patch",endpoints:["projects/"+R.value.id,"project_details/"+((e=u.value)==null?void 0:e.id)],state:"project"},r.value===2?T({pin:null},null,"object").then(()=>{_.value=!1,m.value=[]}):r.value===3&&T({logo:null},null,"object").then(()=>{_.value=!1,m.value=[]})}function ge(e){_.value=!0,_e("project_api_tokens/"+e).then(()=>{var l;ce("project_details/"+((l=u.value)==null?void 0:l.id),"project").then(()=>{setTimeout(()=>{_.value=!1},500)})})}return B(()=>u.value,e=>{J(),H.value="https://test.reactool.jp/"+(e==null?void 0:e.id),r.value===2?m.value=(e==null?void 0:e.pin)?[{image:e.pin}]:[]:r.value===3&&(m.value=(e==null?void 0:e.logo)?[{image:e.logo}]:[])}),B(()=>A.value,e=>{e&&f.value.hasOwnProperty("project")&&(j.value="encryption \u30B9\u30BF\u30FC\u30C8",_.value=!0,setTimeout(()=>{var n;const l="https://test.reactool.jp/";w.value=l+((n=u.value)==null?void 0:n.id)+"/?token="+e.token_id,_.value=!1,$(()=>{y.value=!0})},2e3))}),B(()=>F.value,e=>{e||(y.value=!1,r.value=0,w.value="",A.value=null)}),B(()=>y.value,e=>{e||(w.value="",A.value=null)}),B(()=>r.value,e=>{var l,n,p,a,d,x,z,G,K,Q,W,X,Y,Z,ee,ue,le,ae,te,oe,ne,se,ie;e===0?(m.value=[],f.value={id:null,order_id:null,name:(l=u.value)==null?void 0:l.name,context:(n=u.value)==null?void 0:n.context,address:(p=u.value)==null?void 0:p.address,archive:(a=u.value)==null?void 0:a.archive,token_on:(d=u.value)==null?void 0:d.token_on,salon_view:(x=u.value)==null?void 0:x.salon_view,legacy:(z=u.value)==null?void 0:z.legacy}):e===1?(m.value=[],f.value={salon:(G=u.value)==null?void 0:G.salon,salon_view:(K=u.value)==null?void 0:K.salon_view,archive:(Q=u.value)==null?void 0:Q.archive,token_on:(W=u.value)==null?void 0:W.token_on}):e===2?(f.value={logo:null,logo_width:null,logo_height:null,logo_place:3,archive:(X=u.value)==null?void 0:X.archive,token_on:(Y=u.value)==null?void 0:Y.token_on,salon_view:(Z=u.value)==null?void 0:Z.salon_view,legacy:(ee=u.value)==null?void 0:ee.legacy},m.value=((ue=u.value)==null?void 0:ue.pin)?[{image:u.value.pin}]:[],P.value="pin_input"):e===3&&(f.value={pin:null,pin_width:(le=u.value)==null?void 0:le.pin_width,pin_height:(ae=u.value)==null?void 0:ae.pin_height,archive:(te=u.value)==null?void 0:te.archive,token_on:(oe=u.value)==null?void 0:oe.token_on,salon_view:(ne=u.value)==null?void 0:ne.salon_view,legacy:(se=u.value)==null?void 0:se.legacy},m.value=((ie=u.value)==null?void 0:ie.logo)?[{image:u.value.logo}]:[],P.value="logo_input")}),(e,l)=>{const n=re("router-link"),p=re("router-view");return g(),q("div",Oe,[s(Ve,null,{default:v(()=>[o("div",He,[o("h3",{class:"title",innerHTML:t(u).name},null,8,Je),s(qe,{id:"project_setting",items:I.value},null,8,["items"]),o("a",{style:{"margin-left":"5px",color:"#2ecc71"},target:"_blank",href:H.value},"APP\u3078",8,Me)]),ze,o("div",Ge,[(g(!0),q(we,null,xe(h.value,(a,d)=>{var x;return g(),N(n,{key:d,class:"pn-item flex align-center justify-center","active-class":"active",to:{name:a==null?void 0:a.panel_name,params:{dynid:(x=t(Ce))==null?void 0:x.params.dynid}}},{default:v(()=>[U(Be(a==null?void 0:a.title.replace("<br>","")),1)]),_:2},1032,["to"])}),128))]),s(pe,{modelValue:t(F),"onUpdate:modelValue":l[6]||(l[6]=a=>D(F)?F.value=a:null),title:V.value.replaceAll("<br>",""),overflow:k.value.length>0&&r.value===3},{default:v(()=>[s(Ne,{modelValue:t(F),"onUpdate:modelValue":l[0]||(l[0]=a=>D(F)?F.value=a:null),response:A.value,"onUpdate:response":l[1]||(l[1]=a=>A.value=a),activeTab:r.value,"onUpdate:activeTab":l[2]||(l[2]=a=>r.value=a),onload:t(j),tabs:k.value,form:c.value,data:t(R),loading:_.value,query:f.value,submit:t(T)},{default:v(()=>[r.value===2||r.value===3?(g(),N(Ue,{key:0,containerId:P.value,images:t(m),remove:he},null,8,["containerId","images"])):de("",!0)]),_:1},8,["modelValue","response","activeTab","onload","tabs","form","data","loading","query","submit"]),t(y)?(g(),q("div",Ke,[o("div",Qe,[We,o("div",Xe,[je(o("input",{id:"token_text",type:"text",disabled:"","onUpdate:modelValue":l[3]||(l[3]=a=>w.value=a)},null,512),[[ke,w.value]]),o("i",{onClick:l[4]||(l[4]=a=>t(Fe)("token_text")),class:"pi pi-copy flex align-center justify-center"})]),Ye,o("div",Ze,[o("button",{onClick:l[5]||(l[5]=a=>y.value=!1)},"\u9589\u3058\u308B")])])])):de("",!0)]),_:1},8,["modelValue","title","overflow"]),s(pe,{modelValue:t(C),"onUpdate:modelValue":l[8]||(l[8]=a=>D(C)?C.value=a:null),title:"API\u30C8\u30FC\u30AF\u30F3\u4E00\u89A7",overflow:""},{default:v(()=>[s($e,{modelValue:t(C),"onUpdate:modelValue":l[7]||(l[7]=a=>D(C)?C.value=a:null),form:[[]],loading:_.value},{default:v(()=>[s(t(Te),{value:t(u).api_tokens,rowindex:"index",style:{"padding-bottom":"14px"},responsiveLayout:"scroll",class:"option-datatable"},{default:v(()=>[s(t(E),{field:"name",header:"\u30C8\u30FC\u30AF\u30F3\u540D"}),s(t(E),{field:"start_date",header:"\u958B\u59CB\u65E5"}),s(t(E),{field:"end_date",header:"\u7D42\u4E86\u65E5"}),s(t(E),{style:{width:"40px","text-align":"right","margin-left":"auto"},body:"index"},{body:v(a=>[o("span",{onClick:d=>ge(a.data.id),class:"remove pointer"},lu,8,eu)]),_:1})]),_:1},8,["value"])]),_:1},8,["modelValue","loading"])]),_:1},8,["modelValue"])]),_:1}),s(p,null,{default:v(({Component:a})=>[s(De,{name:"fade",mode:"out-in"},{default:v(()=>[(g(),N(Ee(a)))]),_:2},1024)]),_:1})])}}});export{Au as default};
