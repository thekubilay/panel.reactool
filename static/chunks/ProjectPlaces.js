import{d as le}from"./vuedraggable.umd.js";import{s as ae}from"./menu.esm.js";import{d as ue,D as p,o as oe,F as x,b as U,k as d,u as n,l as w,w as F,e as i,a3 as te,J as se,I as ne,a as B,U as L,t as k,M as ie,N as pe,c as S,g as re}from"./vendor.js";import de from"./dropdown.esm.js";import{a as ce,u as me,S as ve,_ as _e}from"./useFormRequestBuilder.js";import{_ as fe}from"./BarTool.js";import{_ as be}from"./FormQuery.js";import{_ as ge}from"./ContextImagesThumbnailContainer.js";import{_ as he}from"./Icon.js";import{b as N,A as ye,u as xe}from"../main.js";import{u as je}from"./useRightClickHandler.js";import{c as Ae,d as Ce}from"./rules.js";import{u as we}from"./useUtils.js";import"./overlayeventbus.esm.js";import"./virtualscroller.esm.js";const D=[[{classes:["flex","justify-space-between"],elements:[{component:null,name:"Dropdown",db_column_name:"map_category",type:"text",model:N().project.map_categories.length?N().project.map_categories[0].id:null,label:"\u30AB\u30C6\u30B4\u30EA\u30FC",hint:null,required:!1,rules:[],id:"map_category_input",disabled:!1,options:[],optionLabel:"name",optionValue:"id",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-2-space","relative"]},{component:null,name:"Dropdown",db_column_name:"show_directions",type:"text",model:!0,label:"\u30C0\u30A4\u30EC\u30AF\u30B7\u30E7\u30F3\u72B6\u614B",hint:null,required:!1,rules:[],id:"show_directions_input",disabled:!1,options:[{name:"\u8868\u793A",value:!0},{name:"\u672A\u8868\u793A",value:!1}],optionLabel:"name",optionValue:"value",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-2-space","relative"]}]},{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputText",db_column_name:"place",type:"text",model:null,label:"\u5834\u6240",hint:null,placeholder:"\u3007\u3007\u7269\u4EF6\u540D",required:!0,id:"place_input",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-2-space"]},{component:null,name:"InputText",db_column_name:"address",type:"text",model:null,label:"\u4F4F\u6240",hint:null,placeholder:"\u6885\u7530\uFF16\u4E01\u76EE",required:!0,id:"address_input",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-2-space"]}]}],[{classes:["flex","justify-space-between"],elements:[{component:null,name:"FileInput",db_column_name:"image",type:"text",model:null,label:"\u753B\u50CF",hint:".jpeg, .png, .svg \u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u3059",required:!0,id:"place_image_input",preview_text:"\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u306E\u305F\u3081\u3001\u30AF\u30EA\u30C3\u30AF\u3084\u753B\u50CF\u30C9\u30ED\u30C3\u30D7\u3057\u3066\u304F\u3060\u3055\u3044",limit:"1MB\u4EE5\u4E0B",accept:"image/*",rules:[Ae],rule:Ce,disabled:!1,props:["placeholder","required","disabled","accept","hint","model","image_path","preview_text","limit","rule"],classes:["flex-column","column-1"]}]}]],Fe=[[{classes:["flex","justify-space-between"],elements:[{component:null,name:"Dropdown",db_column_name:"all",type:"text",model:!0,label:"\u5168\u3066\u8868\u793A",hint:null,required:!1,rules:[],id:"all_input",disabled:!1,options:[{name:"\u8868\u793A",value:!0},{name:"\u672A\u8868\u793A",value:!1}],optionLabel:"name",optionValue:"value",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-2-space","relative"]},{component:null,name:"Dropdown",db_column_name:"administrative",type:"text",model:!0,label:"\u4F4F\u6240\u540D",hint:null,required:!1,rules:[],id:"administrative_input",disabled:!1,options:[{name:"\u8868\u793A",value:!0},{name:"\u672A\u8868\u793A",value:!1}],optionLabel:"name",optionValue:"value",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-2-space","relative"]}]},{classes:["flex","justify-space-between"],elements:[{component:null,name:"Dropdown",db_column_name:"poi",type:"text",model:!0,label:"\u30B9\u30DD\u30C3\u30C8",hint:null,required:!1,rules:[],id:"poi_input",disabled:!1,options:[{name:"\u8868\u793A",value:!0},{name:"\u672A\u8868\u793A",value:!1}],optionLabel:"name",optionValue:"value",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-2-space","relative"]},{component:null,name:"Dropdown",db_column_name:"road",type:"text",model:!0,label:"\u9053\u8DEF",hint:null,required:!1,rules:[],id:"road_input",disabled:!1,options:[{name:"\u8868\u793A",value:!0},{name:"\u672A\u8868\u793A",value:!1}],optionLabel:"name",optionValue:"value",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-2-space","relative"]}]},{classes:["flex","justify-space-between"],elements:[{component:null,name:"Dropdown",db_column_name:"water",type:"text",model:!0,label:"\u6C34\u57DF",hint:null,required:!1,rules:[],id:"water_input",disabled:!1,options:[{name:"\u8868\u793A",value:!0},{name:"\u672A\u8868\u793A",value:!1}],optionLabel:"name",optionValue:"value",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-2-space","relative"]},{component:null,name:"Dropdown",db_column_name:"line",type:"text",model:!0,label:"\u96FB\u8ECA\u30E9\u30A4\u30F3",hint:null,required:!1,rules:[],id:"line_input",disabled:!1,options:[{name:"\u8868\u793A",value:!0},{name:"\u672A\u8868\u793A",value:!1}],optionLabel:"name",optionValue:"value",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-2-space","relative"]}]},{classes:["flex","justify-space-between"],elements:[{component:null,name:"Dropdown",db_column_name:"station",type:"text",model:!0,label:"\u99C5",hint:null,required:!1,rules:[],id:"station_input",disabled:!1,options:[{name:"\u8868\u793A",value:!0},{name:"\u672A\u8868\u793A",value:!1}],optionLabel:"name",optionValue:"value",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-2-space","relative"]}]}]];const Be={id:"project_places",class:"relative panel-board"},De={class:"part-wrap"},Ve={class:"part-wrap part-end"},Ee={class:"spreadsheet-wrapper overflow-x"},qe=te('<div class="sh-container ss-container"><div class="sheet-row sheet-row-header flex align-center"><div class="sheet-cell handle flex align-center"></div><div class="sheet-cell num flex align-center">\u9806\u756A</div><div class="sheet-cell sheet-cell-long value flex align-center">\u65BD\u8A2D\u540D</div><div class="sheet-cell sheet-cell-long value flex align-center">\u4F4F\u6240</div><div class="sheet-cell value flex align-center">\u65BD\u8A2D\u753B\u50CF</div></div></div>',1),Te=["onClick","onContextmenu"],Le=i("div",{class:"sheet-cell handle flex align-center justify-center grab"},[i("i",{class:"pi pi-bars"})],-1),ke={class:"sheet-cell num flex align-center"},$e={class:"sheet-cell sheet-cell-long value flex align-center"},Ie={class:"text block"},Re={class:"sheet-cell sheet-cell-long value flex align-center"},Ue={class:"text block"},Se={class:"sheet-cell sheet-value-cell flex align-center"},Ne={class:"text flex"},ol=ue({setup(Pe){const V=se(),P=ne(),{get:$,save:M}=ye(),{d:f,dr:E,images:c,data:t,useToggle:j}=ce(),{submit:I,submitRowReorder:H,remove:R}=me(),{rcm:O,rcmOpened:J,isRCOn:Q}=je(t),{payload:q,project:o,progress:z,onload:Me,content:b}=xe(),{findAndUpdateFormElement:y}=we(),A=p(!1),m=p(0),G=p("place_pin_image_input"),T=p([]),g=p({}),C=p(!1),s=p(D),r=p(null),v=p([]),_=p([]);oe(()=>{var a;v.value=(a=o.value)==null?void 0:a.map_categories.map(e=>({id:e.id,name:e.name,empty:e.empty})).filter(e=>!e.empty),v.value&&v.value.length&&(r.value=v.value[0].id)});function K(){P.push({name:"ProjectPlacesCategories",params:{cid:V.params.cid,dynid:V.params.dynid}})}function W(){var a,e,l;T.value=["\u5185\u5BB9"],C.value=!0,g.value={project:(a=o.value)==null?void 0:a.id,order_id:_.value?_.value.length+1:1,map_category:r.value},s.value=D,s.value=y(s.value,"map_category","model",r.value),s.value=y(s.value,"map_category","options",(e=o.value)==null?void 0:e.map_categories.filter(u=>!u.empty)),s.value=y(s.value,"place","model",null),s.value=y(s.value,"address","model",null),j({method:"post",endpoints:["app/map_places","project_details/"+((l=o.value)==null?void 0:l.id)],state:"project"})}function X(){var a,e,l,u;s.value=Fe,C.value=!0,g.value={order_id:null,project:(a=o.value)==null?void 0:a.id},j({method:"patch",endpoints:["app/map_settings/"+((e=o.value)==null?void 0:e.map_settings.id),"project_details/"+((l=o.value)==null?void 0:l.id)],state:"project"},(u=o.value)==null?void 0:u.map_settings)}function Y(a){var e,l;J.value||(T.value=["\u5185\u5BB9","\u5834\u6240\u306E\u753B\u50CF"],C.value=!1,c.value=a.pin?[{image:a.pin}]:[],s.value=D,s.value=y(s.value,"map_category","model",r.value),s.value=y(s.value,"map_category","options",(e=o.value)==null?void 0:e.map_categories.filter(u=>!u.empty)),g.value={map_category:r.value},j({method:"patch",endpoints:["app/map_places/"+a.id,"project_details/"+((l=o.value)==null?void 0:l.id)],state:"project"},a))}function Z(a){var e;A.value=!0,q.value={method:"patch",endpoints:["app/map_places/"+t.value.id,"project_details/"+((e=o.value)==null?void 0:e.id)],state:"salon"},m.value===0?I({pin:null},null,"object").then(()=>{A.value=!1,c.value=[]}):m.value===1&&R("app/map_place_images/"+a).then(()=>{A.value=!1,c.value=c.value.filter(l=>l.id!==a)})}const ee=p([{label:"\u65B0\u898F\u65BD\u8A2D",command:()=>{var a;c.value=[],g.value={id:null,order_id:null,show_directions:!1,type:null,place:null,address:null,context:null,pin:null},s.value=D,j({method:"post",endpoints:["app/map_places","project_details/"+((a=o.value)==null?void 0:a.id)],state:"project"})}},{label:"\u884C\u3092\u8907\u88FD\u3059\u308B",command:()=>{var e;b.value=!0;const a={order_id:_.value?_.value.length+1:1,map_category:t.value.map_category,project:(e=o.value)==null?void 0:e.id,show_directions:t.value.show_directions,type:t.value.type,place:t.value.place,address:t.value.address,context:t.value.context};M("app/map_places",a).then(()=>{var l;$("project_details/"+((l=o.value)==null?void 0:l.id),"project").then(()=>{b.value=!1})})}},{label:"\u884C\u3092\u524A\u9664\u3059\u308B",command:()=>{var a;b.value=!0,R("app/map_places/"+((a=t.value)==null?void 0:a.id)).then(()=>{var e;$("project_details/"+((e=o.value)==null?void 0:e.id),"project").then(()=>{b.value=!1})})}}]);return x(()=>f.value,a=>{a||(m.value=0)}),x(()=>o.value,a=>{var e,l;v.value=a==null?void 0:a.map_categories.map(u=>({id:u.id,name:u.name})),_.value=(e=a==null?void 0:a.map_categories.find(u=>u.id===r.value))==null?void 0:e.map_places,t.value&&((l=_.value)==null||l.forEach(u=>{var h;t.value.id===u.id&&(t.value=u,m.value===0?c.value=u.pin?[{image:u.pin}]:[]:m.value===1&&(c.value=((h=u.map_place_images)==null?void 0:h.length)?u.map_place_images:[]))}))}),x(()=>V.params.dynid,a=>{v.value&&v.value.length&&(r.value=v.value[0].id)}),x(()=>r.value,a=>{var e,l;_.value=(l=(e=o.value)==null?void 0:e.map_categories.find(u=>u.id===a))==null?void 0:l.map_places}),x(()=>m.value,a=>{var e,l,u;a===0?(q.value={method:"patch",endpoints:["app/map_places/"+t.value.id,"project_details/"+((e=o.value)==null?void 0:e.id)],state:"project"},g.value={id:null,order_id:null,salon:(l=o.value)==null?void 0:l.id,show_directions:!1,type:null,place:null,address:null,context:null,pin:null}):(q.value={method:"post",endpoints:["app/map_place_images","project_details/"+((u=o.value)==null?void 0:u.id)],state:"project"},G.value="place_image_input",g.value={id:null,map_place:t.value.id,image:null,thumbnail:null},c.value=t.value.map_place_images?t.value.map_place_images:[])}),(a,e)=>(B(),U("div",Be,[d(ve,{modelValue:n(b),"onUpdate:modelValue":e[0]||(e[0]=l=>w(b)?b.value=l:null)},null,8,["modelValue"]),d(fe,{class:"justify-space-between"},{default:F(()=>[i("div",De,[d(n(L),{type:"button",class:"submit-button",icon:"pi pi-plus","icon-pos":"left",label:"\u65B0\u898F\u65BD\u8A2D",onClick:e[1]||(e[1]=l=>W())}),d(n(L),{type:"button",class:"submit-button icon-button",icon:"pi pi-cog","icon-pos":"left",onClick:e[2]||(e[2]=l=>X())})]),i("div",Ve,[d(n(de),{class:"dropdown",modelValue:r.value,"onUpdate:modelValue":e[3]||(e[3]=l=>r.value=l),options:v.value,optionLabel:"name",optionValue:"id",placeholder:"\u9078\u629E"},null,8,["modelValue","options"]),d(n(L),{onClick:e[4]||(e[4]=l=>K()),type:"button",class:"tool-button",label:"\u30AB\u30C6\u30B4\u30EA\u30FC\u3078"})])]),_:1}),i("div",Ee,[qe,d(n(le),{tag:"div",onEnd:e[5]||(e[5]=l=>n(H)({value:_.value},{method:"post",endpoints:["app/map_places","project_details/"+n(o).id],state:"project"})),list:_.value,class:"sb-container ss-container",handle:".handle","item-key":"id"},{item:F(({element:l,index:u})=>[i("div",{onClick:h=>Y(l),onContextmenu:h=>n(Q)(h,l),"aria-haspopup":"true","aria-controls":"plan_rc_menu",class:"sheet-row flex align-center list-group-item relative pointer"},[d(n(ae),{id:"rc_menu",ref_key:"rcm",ref:O,class:"rc has-final-action",model:ee.value,popup:!0},null,8,["model"]),Le,i("div",ke,k(l.order_id?l.order_id:u+1),1),i("div",$e,[i("span",Ie,k(l.place),1)]),i("div",Re,[i("span",Ue,k(l.address),1)]),i("div",Se,[i("span",Ne,[(B(!0),U(ie,null,pe(l.map_place_images,h=>(B(),S(he,{key:h.id,style:{"margin-right":"5px"},svg:"image"}))),128))])])],40,Te)]),_:1},8,["list"])]),d(_e,{modelValue:n(f),"onUpdate:modelValue":e[9]||(e[9]=l=>w(f)?f.value=l:null),title:"\u65BD\u8A2D\u30D5\u30A9\u30FC\u30E0"},{default:F(()=>[d(be,{modelValue:n(f),"onUpdate:modelValue":e[6]||(e[6]=l=>w(f)?f.value=l:null),dr:n(E),"onUpdate:dr":e[7]||(e[7]=l=>w(E)?E.value=l:null),activeTab:m.value,"onUpdate:activeTab":e[8]||(e[8]=l=>m.value=l),topProgress:"",closeAfter:C.value,tabs:T.value,progress:n(z),form:s.value,data:n(t),loading:A.value,query:g.value,submit:n(I)},{default:F(()=>[m.value===1?(B(),S(ge,{key:0,containerId:"place_image_input",images:n(c),remove:Z},null,8,["images"])):re("",!0)]),_:1},8,["modelValue","dr","activeTab","closeAfter","tabs","progress","form","data","loading","query","submit"])]),_:1},8,["modelValue"])]))}});export{ol as default};
