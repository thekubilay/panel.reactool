import{D as i,d as ie,aj as re,F as J,o as pe,b as E,k as m,u as e,l as j,w as T,e as u,M as de,N as me,a3 as ce,a as B,U as se,t as L,c as ve,g as I}from"./vendor.js";import{s as fe}from"./menu.esm.js";import _e from"./dropdown.esm.js";import ge from"./slider.esm.js";import{u as be,a as he,S as Ce,_ as ye}from"./useFormRequestBuilder.js";import{_ as xe}from"./BarTool.js";import{_ as Fe}from"./Icon.js";import{_ as je}from"./FormQuery.js";import{_ as Be}from"./DialogDelete.js";import{A as we,u as De}from"../main.js";import{u as Ee}from"./useRightClickHandler.js";import{u as Ae}from"./useUtils.js";import{u as Ve}from"./useGrabAndMoveHandler.js";import"./overlayeventbus.esm.js";import"./virtualscroller.esm.js";const ue=[[{classes:["flex justify-space-between"],elements:[{component:null,name:"Dropdown",db_column_name:"time",type:"text",model:"\u663C",label:"\u30BF\u30A4\u30E0",hint:null,required:!0,rules:[],id:"day_time_input",disabled:!1,options:[{name:"\u663C",value:"\u663C"},{name:"\u5915",value:"\u5915"}],optionLabel:"name",optionValue:"value",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-3-space","relative"]},{component:null,name:"Dropdown",db_column_name:"repeat",type:"text",model:!0,label:"\u30EB\u30FC\u30D7",hint:null,required:!0,rules:[],id:"loop_input",disabled:!1,options:[{name:"\u306F\u3044",value:!0},{name:"\u3044\u3044\u3048",value:!1}],optionLabel:"name",optionValue:"value",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-3-space","relative"]},{component:null,name:"Dropdown",db_column_name:"is_bg",type:"text",model:!1,label:"\u753B\u50CF\u7A2E\u985E",hint:null,required:!0,rules:[],id:"bg_input",disabled:!1,options:[{name:"\u30D1\u30CE\u30E9\u30DE\u753B\u50CF",value:!1},{name:"BG\u753B\u50CF",value:!0}],optionLabel:"name",optionValue:"value",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-3-space","relative"]}]},{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputNumber",db_column_name:"floor_num",type:"text",model:null,label:"\u30D5\u30ED\u30A2",hint:"\u6570\u5B57\u3060\u3051\u3067\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044",placeholder:"3",required:!0,id:"floor_input",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-2-space","relative"]},{component:null,name:"InputText",db_column_name:"plan_type",type:"text",model:null,label:"\u30BF\u30A4\u30D7",hint:null,placeholder:"AB",required:!1,id:"type_input",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-2-space","relative"]}]},{classes:["flex"],elements:[{component:null,name:"FileInput",db_column_name:"image",type:"text",model:null,label:"\u753B\u50CF",hint:".jpeg, .png \u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u3059",required:!1,id:"image_input",preview_text:"\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u306E\u305F\u3081\u3001\u30AF\u30EA\u30C3\u30AF\u3084\u753B\u50CF\u30C9\u30ED\u30C3\u30D7\u3057\u3066\u304F\u3060\u3055\u3044",limit:"1MB\u4EE5\u4E0B",accept:"image/*",rules:[],rule:null,disabled:!1,props:["placeholder","required","disabled","accept","hint","model","image_path","preview_text","limit","rule"],classes:["flex-column","column-1"]}]}]],ae=[[{classes:["flex"],elements:[{component:null,name:"FileInput",db_column_name:"image",type:"text",model:null,label:"\u753B\u50CF",hint:".jpeg, .png \u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u3059",required:!1,id:"image_input",preview_text:"\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u306E\u305F\u3081\u3001\u30AF\u30EA\u30C3\u30AF\u3084\u753B\u50CF\u30C9\u30ED\u30C3\u30D7\u3057\u3066\u304F\u3060\u3055\u3044",limit:"1MB\u4EE5\u4E0B",accept:"image/*",rules:[],rule:null,disabled:!1,props:["placeholder","required","disabled","accept","hint","model","image_path","preview_text","limit","rule"],classes:["flex-column","column-1"]}]}]];function ke(){const{get:O,save:K}=we(),{submit:b,submitRowReorder:c,remove:V}=be(),{d:P,dr:v,data:h,images:w,useToggle:D}=he(),{rcm:f,rcmOpened:W,isRCOn:S}=Ee(h),{payload:_,content:p,progress:C,project:o}=De(),k=i(),A=i(),y=i("\u663C"),R=i(["\u663C","\u5915"]),N=i(""),H=i([]),G=i([]),x=i(!0),X=i(0),g=i(!1),M=i(!1);function Y(s="content",a=null){var F,q,U,$;s==="content"?(x.value=!0,M.value=!1,k.value=ue,ae[0][0].elements[0].model=y.value,A.value={vista_simulator:(F=o.value)==null?void 0:F.vista_simulator.id,compass_start:1,compass_left:1,compass_top:1},D({method:"post",endpoints:["app/vista_simulator_contents","project_details/"+((q=o.value)==null?void 0:q.id)],state:"project"})):(x.value=!1,k.value=ae,A.value={project:(U=o.value)==null?void 0:U.id},D({method:"patch",endpoints:["app/vista_simulators/"+(a==null?void 0:a.id),"project_details/"+(($=o.value)==null?void 0:$.id)],state:"project"},a))}function Q(s){var a,F;w.value=s.image?[{image:s.image}]:[],x.value=!0,M.value=!0,k.value=ue,A.value={vista_simulator:(a=o.value)==null?void 0:a.vista_simulator.id},D({method:"patch",endpoints:["app/vista_simulator_contents/"+s.id,"project_details/"+((F=o.value)==null?void 0:F.id)],state:"project"},s)}function Z(){var s;g.value=!0,V("app/vista_simulator_contents/"+((s=h.value)==null?void 0:s.id)).then(()=>{var a;v.value=!1,O("project_details/"+((a=o.value)==null?void 0:a.id),"project").then(()=>{P.value=!1,g.value=!1})})}const ee=()=>{var s;x.value=!1,g.value=!0,_.value={method:"patch",endpoints:["app/vista_simulators/"+h.value.id,"project_details/"+((s=o.value)==null?void 0:s.id)],state:"project"},b({image:null,thumbnail:null},null).then(a=>{g.value=!1})},r=()=>{var s;x.value=!1,g.value=!0,_.value={method:"patch",endpoints:["app/vista_simulator_contents/"+h.value.id,"project_details/"+((s=o.value)==null?void 0:s.id)],state:"project"},b({image:null,thumbnail:null},null).then(a=>{g.value=!1,w.value=[]})},z=i([{label:"\u65B0\u898F\u773A\u671B",command:()=>{var s;D({method:"post",endpoints:["app/vista_simulator_contents","project_details/"+((s=o.value)==null?void 0:s.id)],state:"project"})}},{label:"\u884C\u3092\u524A\u9664\u3059\u308B",command:()=>{var s;p.value=!0,V("app/vista_simulator_contents"+((s=h.value)==null?void 0:s.id)).then(()=>{var a;O("project_details/"+((a=o.value)==null?void 0:a.id),"project").then(()=>{p.value=!1})})}}]);return{reform:k,query:A,type:N,types:H,time:y,times:R,vistas:G,rm:M,loading:g,slider:X,closeAfter:x,d:P,dr:v,data:h,content:p,images:w,progress:C,project:o,createOrUpdate:Y,open:Q,removeItem:Z,removeImage:ee,removeContentImage:r,rightClickMenu:z,rcm:f,isRCOn:S,useToggle:D,submit:b,submitRowReorder:c,remove:V}}const Me={id:"project_vista",class:"panel-board relative"},qe={class:"part-wrap"},Ue={class:"part-wrap part-end"},$e={class:"spreadsheet-wrapper overflow-x"},Ie=ce('<div class="sh-container ss-container"><div class="sheet-row sheet-row-header flex align-center"><div class="sheet-cell handle flex align-center"></div><div class="sheet-cell num flex align-center">\u968E</div><div class="sheet-cell img flex align-center"><i class="pi pi-file"></i></div><div class="sheet-cell num flex align-center"><i class="pi pi-sun"></i></div><div class="sheet-cell value sheet-cell-long flex align-center">\u753B\u50CF\u540D</div><div class="sheet-cell value flex align-center">\u9593\u53D6\u308A\u30BF\u30A4\u30D7</div></div></div>',1),Re={class:"sb-container ss-container"},Te=["onClick","onContextmenu"],Le=u("div",{class:"sheet-cell handle flex align-center handle grab"},null,-1),Oe={class:"sheet-cell num flex align-center"},Pe={class:"text block"},Se={class:"sheet-cell img flex align-center"},Ne={class:"sheet-cell num flex align-center"},He={class:"text block"},Ge={class:"sheet-cell value sheet-cell-long flex align-center"},Qe={key:0,class:"text block"},ze={class:"sheet-cell value flex align-center"},Je={key:0,class:"slider-container"},Ke=u("span",{class:"label block"},"\u30B3\u30F3\u30D1\u30B9\u5411\u304D\u65B9",-1),We={key:0,class:"land-print relative overflow-hidden"},Xe={class:"row relative image-container relative"},Ye=["src"],Ze=u("span",{class:"hint"},"*\u30DD\u30A4\u30F3\u30BF\u30FC\u3092\u30B0\u30E9\u30D6\u3057\u306A\u304C\u3089\u914D\u7F6E\u3057\u3066\u304F\u3060\u3055\u3044",-1),el={class:"button-wrapper flex justify-end"},_l=ie({setup(O){const{sortByDesc:K}=Ae(),{reform:b,query:c,type:V,types:P,time:v,times:h,vistas:w,rm:D,slider:f,closeAfter:W,loading:S,d:_,dr:p,data:C,content:o,images:k,progress:A,project:y,createOrUpdate:R,open:N,rightClickMenu:H,rcm:G,isRCOn:x,useToggle:X,removeItem:g,removeImage:M,removeContentImage:Y,submit:Q,submitRowReorder:Z,remove:ee}=ke(),{element:r,offset:z,onMouseEnter:s,onMouseLeave:a,onMouseDown:F,onMouseUp:q,onMouseMove:U}=Ve(),$=i(null);function oe(d,l){return d.filter(t=>t.time===v.value)||[]}function ne(){var l,t;const d=((l=y.value)==null?void 0:l.vista_simulator.vista_simulator_contents)||[];w.value=oe(d,{time:v.value,type:V.value}),f.value=parseInt((t=C.value)==null?void 0:t.compass_start)}return re(()=>ne()),J(f,()=>{r.value&&(r.value.style.transform="rotate("+f.value+"deg)"),r.value&&(c.value.compass_start=f.value)}),J(()=>r.value,d=>{d&&C.value&&setTimeout(()=>{d.setAttribute("src",$.value),r.value.style.top=C.value.compass_top+"px",r.value.style.left=C.value.compass_left+"px",r.value.style.transform="rotate("+C.value.compass_start+"deg)"},50)}),J(()=>z.value,d=>{c.value.compass_top=r.value.computedStyleMap().get("top").value,c.value.compass_left=r.value.computedStyleMap().get("left").value}),pe(()=>{var d,l;$.value=new URL("/static/assets/compass.svg",self.location),w.value=(l=(d=y.value)==null?void 0:d.vista_simulator.vista_simulator_contents)==null?void 0:l.filter(t=>t.time===v.value)}),(d,l)=>(B(),E("div",Me,[m(Ce,{modelValue:e(o),"onUpdate:modelValue":l[0]||(l[0]=t=>j(o)?o.value=t:null)},null,8,["modelValue"]),m(xe,{class:"justify-space-between"},{default:T(()=>[u("div",qe,[m(e(se),{type:"button",class:"submit-button",icon:"pi pi-plus","icon-pos":"left",label:"\u65B0\u898F\u773A\u671BF",onClick:l[1]||(l[1]=t=>e(R)())}),m(e(se),{type:"button",class:"submit-button icon-button",icon:"pi pi-cog","icon-pos":"left",onClick:l[2]||(l[2]=t=>e(R)("sim",e(y).vista_simulator))})]),u("div",Ue,[m(e(_e),{style:{"margin-left":"0",width:"60px"},class:"dropdown",modelValue:e(v),"onUpdate:modelValue":l[3]||(l[3]=t=>j(v)?v.value=t:null),options:e(h),placeholder:"\u30BF\u30A4\u30E0"},null,8,["modelValue","options"])])]),_:1}),u("div",$e,[Ie,u("div",Re,[(B(!0),E(de,null,me(e(K)(e(w),"floor_num"),(t,n)=>{var le;return B(),E("div",{key:n,onClick:te=>e(N)(t),onContextmenu:te=>e(x)(te,t),"aria-haspopup":"true","aria-controls":"rc_menu",class:"sheet-row flex align-center list-group-item relative pointer"},[m(e(fe),{id:"rc_menu",ref_for:!0,ref_key:"rcm",ref:G,class:"rc has-final-action",model:e(H),popup:!0},null,8,["model"]),Le,u("div",Oe,[u("span",Pe,L(t.floor_num),1)]),u("div",Se,[t.image?(B(),ve(Fe,{key:0,svg:"image"})):I("",!0)]),u("div",Ne,[u("span",He,L(t.time),1)]),u("div",Ge,[t.image?(B(),E("span",Qe,L((le=t.image)==null?void 0:le.split("/",6)[5].split(".",1)[0]),1)):I("",!0)]),u("div",ze,L(t.plan_type),1)],40,Te)}),128))])]),m(ye,{modelValue:e(_),"onUpdate:modelValue":l[17]||(l[17]=t=>j(_)?_.value=t:null),title:"\u773A\u671B\u30D5\u30A9\u30FC\u30E0",overflow:""},{default:T(()=>[m(je,{modelValue:e(_),"onUpdate:modelValue":l[11]||(l[11]=t=>j(_)?_.value=t:null),dr:e(p),"onUpdate:dr":l[12]||(l[12]=t=>j(p)?p.value=t:null),form:e(b),"onUpdate:form":l[13]||(l[13]=t=>j(b)?b.value=t:null),"close-after":e(W),topProgress:"",progress:e(A),data:e(C),loading:e(S),query:e(c),remove:e(D),submit:e(Q)},{default:T(()=>{var t;return[e(c).hasOwnProperty("project")||e(c).hasOwnProperty("plan_type")&&e(b)[0][1].elements[1].model?(B(),E("div",Je,[Ke,m(e(ge),{modelValue:e(f),"onUpdate:modelValue":l[4]||(l[4]=n=>j(f)?f.value=n:null),min:1,max:360},null,8,["modelValue"]),e(y).vista_simulator.image?(B(),E("div",We,[u("div",Xe,[u("img",{class:"print",src:(t=e(y).vista_simulator)==null?void 0:t.image,alt:"landplan"},null,8,Ye),u("img",{draggable:!1,onMousemove:l[5]||(l[5]=(...n)=>e(U)&&e(U)(...n)),onMouseenter:l[6]||(l[6]=(...n)=>e(s)&&e(s)(...n)),onMouseleave:l[7]||(l[7]=(...n)=>e(a)&&e(a)(...n)),onMousedown:l[8]||(l[8]=(...n)=>e(F)&&e(F)(...n)),onMouseup:l[9]||(l[9]=(...n)=>e(q)&&e(q)(...n)),ref_key:"element",ref:r,class:"compass",alt:"compass"},null,544),e(c).hasOwnProperty("project")?(B(),E("button",{key:0,onClick:l[10]||(l[10]=n=>e(M)()),class:"remove"}," \u753B\u50CF\u524A\u9664 ")):I("",!0)]),Ze])):I("",!0)])):I("",!0)]}),_:1},8,["modelValue","dr","form","close-after","progress","data","loading","query","remove","submit"]),m(Be,{modelValue:e(p),"onUpdate:modelValue":l[16]||(l[16]=t=>j(p)?p.value=t:null)},{default:T(()=>[u("div",el,[u("button",{onClick:l[14]||(l[14]=t=>p.value=!1),class:"cancel"},"\u3044\u3044\u3048"),u("button",{onClick:l[15]||(l[15]=t=>e(g)()),class:"delete"},"\u306F\u3044")])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]))}});export{_l as default};
