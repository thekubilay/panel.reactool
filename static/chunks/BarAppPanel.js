import{d as L,u as R,l as w,E as K,D as A,o as i,c as d,g as _,h as e,n as T,b as r,f as h,N as G,i as U,O as J,k as Q,m as W,L as ue,a1 as ne,bO as oe,w as x,F as X,q as Y,t as B,T as Z,A as re,r as ie,e as de,p as D}from"../main.js";import{_ as ce}from"./FormQuery.js";import{_ as ee}from"./Icon.js";import{_ as pe}from"./ButtonDropdown.js";import{o as se,_ as N}from"./Dialog.js";import O from"./password.esm.js";import{S as _e}from"./Spinner.js";import{a as te,u as me}from"./useFormRequestBuilder.js";import{f as ve}from"./FormUserUpdate.js";import"./plugin-vue_export-helper.js";import"./menu.esm.js";import"./portal.esm.js";import"./rules.js";const fe={class:"form form-password-change"},we=["onSubmit"],he={class:"row column-1 flex justify-space-between"},ge={class:"flex-column column-2-space"},be=e("span",{class:"label flex"},[U("\u904E\u53BB\u306E\u30D1\u30B9\u30EF\u30FC\u30C9"),e("span",{class:"required flex align-start"},"*\u5FC5\u9808")],-1),ye={key:0,class:"invalid block"},xe={class:"row column-1 flex justify-space-between"},ke={class:"flex-column column-2-space"},Ce=e("span",{class:"label flex"},[U("\u65B0\u898F\u30D1\u30B9\u30EF\u30FC\u30C9"),e("span",{class:"required flex align-start"},"*\u5FC5\u9808")],-1),Be={key:0,class:"invalid block"},Fe={class:"row column-1 flex justify-space-between"},$e={class:"flex-column column-2-space"},Ve=e("span",{class:"label flex"},[U("\u65B0\u898F\u30D1\u30B9\u30EF\u30FC\u30C9\u78BA\u8A8D"),e("span",{class:"required flex align-start"},"*\u5FC5\u9808")],-1),Ee={key:0,class:"invalid block"},je={class:"action-wrapper flex align-center"},De=L({__name:"FormUserChangePassword",props:{modelValue:Boolean},emits:["update:modelValue"],setup(H,{emit:F}){const{submit:$}=te(),{payload:k,user:C}=R(),f=w(!1),s=w([]),u=K({old_password:null,new_password:null,password_confirm:null});function y(){s.value=[],k.value={method:"patch",endpoints:["change_password",""],state:""},Object.keys(u).forEach(c=>{u[c]||s.value.push(c)}),u.new_password!==u.password_confirm&&s.value.push("new_password","password_confirm"),s.value.length?f.value=!1:$(u,[[]]).then(c=>{c.code===200?window.location.href="http://127.0.0.1:8000/accounts/login/":s.value.push("old_password"),f.value=!1})}return A(()=>u.old_password,c=>{s.value=s.value.filter(t=>t!=="old_password")}),A(()=>u.new_password,c=>{s.value=s.value.filter(t=>t!=="new_password")}),A(()=>u.password_confirm,c=>{s.value=s.value.filter(t=>t!=="password_confirm")}),(c,t)=>(i(),d("div",fe,[_(_e,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=n=>f.value=n),text:""},null,8,["modelValue"]),e("form",{action:"",onSubmit:G(n=>!1,["prevent"])},[e("div",he,[e("div",ge,[be,_(r(O),{class:T({error:s.value.includes("old_password")}),modelValue:u.old_password,"onUpdate:modelValue":t[1]||(t[1]=n=>u.old_password=n),toggleMask:"",feedback:!1},null,8,["class","modelValue"]),s.value.includes("old_password")?(i(),d("span",ye,"\u904E\u53BB\u306E\u30D1\u30B9\u30EF\u30FC\u30C9\u3092\u6B63\u3057\u304F\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044")):h("",!0)])]),e("div",xe,[e("div",ke,[Ce,_(r(O),{class:T({error:s.value.includes("new_password")}),modelValue:u.new_password,"onUpdate:modelValue":t[2]||(t[2]=n=>u.new_password=n),toggleMask:"",appendTo:"self"},null,8,["class","modelValue"]),s.value.includes("new_password")?(i(),d("span",Be,"\u65B0\u898F\u306E\u30D1\u30B9\u30EF\u30FC\u30C9\u3092\u6B63\u3057\u304F\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044")):h("",!0)])]),e("div",Fe,[e("div",$e,[Ve,_(r(O),{class:T({error:s.value.includes("password_confirm")}),modelValue:u.password_confirm,"onUpdate:modelValue":t[3]||(t[3]=n=>u.password_confirm=n),toggleMask:"",feedback:!1},null,8,["class","modelValue"]),s.value.includes("password_confirm")?(i(),d("span",Ee,"\u65B0\u898F\u78BA\u8A8D\u306E\u30D1\u30B9\u30EF\u30FC\u30C9\u3092\u6B63\u3057\u304F\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044")):h("",!0)])]),e("div",je,[e("button",{onClick:t[4]||(t[4]=n=>F("update:modelValue",!1)),class:"flex align-center justify-center cancel"},"\u4E2D\u6B62"),e("button",{onClick:t[5]||(t[5]=n=>y()),class:"flex align-center justify-center submit-or-next"},"\u767B\u9332")])],40,we)]))}});const Ae={class:"app-filter-wrapper relative"},Te={class:"input-wrapper relative"},Ue=e("i",{class:"pi pi-search"},null,-1),qe={class:"dropdown-wrapper"},Pe={key:0,class:"dropdown"},Me={key:0,class:"empty-text flex-column align-center justify-center"},Se=e("span",{class:"text block"},"\u7D50\u679C\u306A\u3057",-1),Ne=["onClick"],Oe={class:"text block"},Le=e("span",{class:"arrow-wrap flex justify-center"},[e("i",{class:"pi pi-arrow-right flex"})],-1),Re=L({__name:"FilterApp",setup(H){const{projects:F,salons:$}=R(),k=J(),C=Q(),f=w(!1),s=w(),u=w(""),y=w([]),c=w([]);W(()=>{var p;s.value=document.getElementById("afi"),(p=s.value)==null||p.addEventListener("keydown",n),$.value.forEach(o=>{const m={id:o.id,path:null,name:o.name.replaceAll("<br>",""),type:"salon"};y.value.push(m)}),F.value.forEach(o=>{const m={id:o.id,path:null,name:o.name.replaceAll("<br>",""),type:"project"};y.value.push(m)})});const t=ue({set(p){c.value=y.value.filter(o=>o.name.match(p))},get(){return u.value}});function n(p){p&&p.keyCode===27&&(f.value=!1)}function q(p){p.type==="salon"?k.push({name:"SalonProjects",params:{cid:C.params.cid,dynid:p.id}}).then(()=>{f.value=!1,u.value=""}):p.type==="project"&&k.push({name:"ProjectPlaces",params:{cid:C.params.cid,dynid:p.id}}).then(()=>{f.value=!1,u.value=""})}return se(s,p=>{f.value=!1}),(p,o)=>(i(),d("div",Ae,[e("div",Te,[Ue,ne(e("input",{id:"afi",onClick:o[0]||(o[0]=m=>f.value=!f.value),type:"text","onUpdate:modelValue":o[1]||(o[1]=m=>t.value=m),placeholder:"\u691C\u7D22"},null,512),[[oe,t.value]])]),e("div",qe,[_(Z,{name:"slideDown"},{default:x(()=>[f.value?(i(),d("ul",Pe,[c.value.length?h("",!0):(i(),d("li",Me,[_(ee,{svg:"empty",width:"24px"}),Se])),(i(!0),d(X,null,Y(c.value,(m,V)=>(i(),d("li",{key:V,onClick:P=>q(m),class:"dropdown-item flex align-center pointer"},[e("span",Oe,B(m.name),1),U(),Le],8,Ne))),128))])):h("",!0)]),_:1})])]))}});const He={id:"bar_app",class:"container flex justify-space-between"},Ie={class:"bar-app-brand"},ze={class:"bar-app-global-filter flex align-center"},Ke={class:"bar-app-global-actions flex justify-end"},Ge=e("i",{class:"pi pi-question-circle"},null,-1),Je={key:0,class:"badge flex align-center justify-center text-center"},Qe=e("div",{class:"header flex align-center"},[e("h3",{class:"ht"},"\u901A\u77E5")],-1),We={class:"body relative"},Xe=["onClick"],Ye={class:"content"},Ze={class:"date"},es={class:"title"},ss={class:"content"},ts={key:0,class:"unseen block relative"},ls=e("span",{class:"badge"},null,-1),as=[ls],us=["onClick"],ns=e("span",{class:"remove flex align-center justify-center"},[e("i",{class:"pi pi-trash"})],-1),os=[ns],rs={key:0,class:"empty flex align-center justify-center"},is={class:"d-content-header flex align-center justify-end"},ds={class:"d-content-body"},cs=["innerHTML"],Bs=L({__name:"BarAppPanel",setup(H){const F=Q(),$=J(),{get:k}=re(),{submit:C,remove:f}=te(),{user:s,onload:u,progress:y,payload:c}=R(),{d:t,d2:n,useToggle:q}=me(),p=K({id:null,first_name:null,last_name:null,email:null,username:null}),o=w(0),m=w(!1),V=w(0),P=w(),M=w(!1),E=w(null),S=w([{label:"\u30D7\u30ED\u30D5\u30A3\u30FC\u30EB",icon:"pi pi-user",command:()=>{var v;q({method:"patch",endpoints:["users/"+((v=s.value)==null?void 0:v.id),"users/current"],state:"user"})}},{label:"\u30D1\u30B9\u30EF\u30FC\u30C9\u66F4\u65B0",icon:"pi pi-lock",command:()=>{n.value=!0}},{label:"\u7BA1\u7406\u30D1\u30CD\u30EB",icon:"pi pi-cog",command:()=>{$.push({name:"Admin"})}},{label:"\u30ED\u30B0\u30A2\u30A6\u30C8",icon:"pi pi-sign-out",command:()=>location.href="https://panel.reactool.jp/accounts/logout/"}]),le=v=>{E.value=v,M.value=!0,m.value=!1,v.seen||(c.value={method:"patch",endpoints:["user-news/"+v.id,"users/current"],state:"user"},C({seen:!0},null,"object").then(()=>{setTimeout(()=>{var l;o.value=((l=s.value)==null?void 0:l.news.filter(g=>!g.seen).length)||0},1e3)}))},ae=v=>{f("user-news/"+v).then(()=>{k("users/current","user").then(l=>{var g;o.value=((g=l.news)==null?void 0:g.filter(b=>!b.seen).length)||0})})};return W(()=>{var v,l,g;o.value=((v=s.value)==null?void 0:v.news.filter(b=>!b.seen).length)||0,!((l=s.value)!=null&&l.is_superuser)&&!((g=s.value)!=null&&g.is_staff)&&(S.value=S.value.filter(b=>b.label!=="\u7BA1\u7406\u30D1\u30CD\u30EB"))}),se(P,v=>{m.value=!1}),A(()=>V.value,v=>{var l;v===0?c.value={method:"patch",endpoints:["users/"+((l=s.value)==null?void 0:l.id),"users/current"],state:"user"}:c.value={method:"patch",endpoints:["users","users/current"],state:"user"}}),(v,l)=>{var b,I;const g=ie("router-link");return i(),d("header",He,[e("div",Ie,[_(g,{class:"brand flex align-center",to:{name:"Dashboard",params:{cid:r(s).company}}},{default:x(()=>[_(ee,{svg:"reactool",width:"100px"})]),_:1},8,["to"])]),e("div",ze,[_(Re)]),e("div",Ke,[r(s).is_superuser?(i(),de(g,{key:0,class:"tutorials flex align-center justify-center",to:{name:"BoardTutorials",params:{cid:r(F).params.cid}}},{default:x(()=>[Ge]),_:1},8,["to"])):h("",!0),e("button",{onClick:l[0]||(l[0]=a=>m.value=!m.value),class:"news-button flex align-center justify-center relative"},[o.value>0?(i(),d("span",Je,B(o.value),1)):h("",!0),e("i",{class:T(["pi pi-bell",{active:o.value>0}])},null,2)]),_(Z,{name:"fade"},{default:x(()=>[m.value?(i(),d("div",{key:0,class:"news",ref_key:"newsOutside",ref:P},[Qe,e("div",We,[(i(!0),d(X,null,Y(r(s).news,a=>(i(),d("div",{class:"row flex align-center",onClick:j=>le(a)},[e("div",Ye,[e("span",Ze,B(a.created_at.substring(0,10)),1),e("h4",es,B(a.title),1),e("div",ss,B(a.content.replace(/<[^>]*>?/gm,"").substring(0,50)),1)]),a.seen?h("",!0):(i(),d("div",ts,as)),a.seen?(i(),d("div",{key:1,onClick:G(j=>ae(a.id),["stop"]),class:"unseen flex align-center justify-center relative"},os,8,us)):h("",!0)],8,Xe))),256)),r(s).news.length?h("",!0):(i(),d("div",rs,"\u7A7A"))])],512)):h("",!0)]),_:1}),_(pe,{id:"user_menu",final:"",label:(b=r(s))==null?void 0:b.username,items:S.value},null,8,["label","items"])]),_(N,{modelValue:r(t),"onUpdate:modelValue":l[3]||(l[3]=a=>D(t)?t.value=a:null),title:(I=r(s))==null?void 0:I.username},{default:x(()=>[_(ce,{modelValue:r(t),"onUpdate:modelValue":l[1]||(l[1]=a=>D(t)?t.value=a:null),"active-tab":V.value,"onUpdate:activeTab":l[2]||(l[2]=a=>V.value=a),"close-after":"",topProgress:"",progress:r(y),form:r(ve),onload:r(u),data:r(s),query:p,submit:r(C)},null,8,["modelValue","active-tab","progress","form","onload","data","query","submit"])]),_:1},8,["modelValue","title"]),_(N,{modelValue:r(n),"onUpdate:modelValue":l[5]||(l[5]=a=>D(n)?n.value=a:null),title:"\u30D1\u30B9\u30EF\u30FC\u30C9\u66F4\u65B0"},{default:x(()=>[_(De,{modelValue:r(n),"onUpdate:modelValue":l[4]||(l[4]=a=>D(n)?n.value=a:null)},null,8,["modelValue"])]),_:1},8,["modelValue"]),_(N,{modelValue:M.value,"onUpdate:modelValue":l[6]||(l[6]=a=>M.value=a),title:E.value&&E.value.title,overflow:""},{default:x(()=>{var a,j,z;return[e("div",is,B((j=(a=E.value)==null?void 0:a.created_at)==null?void 0:j.substring(0,10)),1),e("div",ds,[e("div",{innerHTML:(z=E.value)==null?void 0:z.content},null,8,cs)])]}),_:1},8,["modelValue","title"])])}}});export{Bs as default};
