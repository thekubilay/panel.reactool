import{a as P,C as w,O as K,N as A,b as i,q as d,f as m,x as e,y as U,t as l,v as h,V as Q,z as T,X,B as G,o as J,c as ue,a4 as oe,a5 as ne,D,w as x,F as W,E as Y,A as k,T as Z,r as re,e as ie}from"./vendor.js";import{_ as de}from"./FormQuery.js";import{_ as ee}from"./Icon.js";import{_ as ce}from"./ButtonDropdown.js";import{o as se,_ as R}from"./Dialog.js";import O from"./password.esm.js";import{S as pe}from"./Spinner.js";import{a as te,u as me}from"./useFormRequestBuilder.js";import{u as I,A as _e}from"../main.js";import{f as ve}from"./FormUserUpdate.js";import"./plugin-vue_export-helper.js";import"./menu.esm.js";import"./overlayeventbus.esm.js";import"./rules.js";const fe={class:"form form-password-change"},we=["onSubmit"],he={class:"row column-1 flex justify-space-between"},ge={class:"flex-column column-2-space"},be=e("span",{class:"label flex"},[T("\u904E\u53BB\u306E\u30D1\u30B9\u30EF\u30FC\u30C9"),e("span",{class:"required flex align-start"},"*\u5FC5\u9808")],-1),ye={key:0,class:"invalid block"},xe={class:"row column-1 flex justify-space-between"},Be={class:"flex-column column-2-space"},Ce=e("span",{class:"label flex"},[T("\u65B0\u898F\u30D1\u30B9\u30EF\u30FC\u30C9"),e("span",{class:"required flex align-start"},"*\u5FC5\u9808")],-1),ke={key:0,class:"invalid block"},je={class:"row column-1 flex justify-space-between"},Fe={class:"flex-column column-2-space"},$e=e("span",{class:"label flex"},[T("\u65B0\u898F\u30D1\u30B9\u30EF\u30FC\u30C9\u78BA\u8A8D"),e("span",{class:"required flex align-start"},"*\u5FC5\u9808")],-1),Ve={key:0,class:"invalid block"},De={class:"action-wrapper flex align-center"},Ee=P({props:{modelValue:Boolean},emits:["update:modelValue"],setup(L,{emit:j}){const{submit:F}=te(),{payload:B,user:C}=I(),f=w(!1),s=w([]),o=K({old_password:null,new_password:null,password_confirm:null});function y(){s.value=[],B.value={method:"patch",endpoints:["change_password",""],state:""},Object.keys(o).forEach(c=>{o[c]||s.value.push(c)}),o.new_password!==o.password_confirm&&s.value.push("new_password","password_confirm"),s.value.length?f.value=!1:F(o,[[]]).then(c=>{c.code===200?window.location.href="http://127.0.0.1:8000/accounts/login/":s.value.push("old_password"),f.value=!1})}return A(()=>o.old_password,c=>{s.value=s.value.filter(t=>t!=="old_password")}),A(()=>o.new_password,c=>{s.value=s.value.filter(t=>t!=="new_password")}),A(()=>o.password_confirm,c=>{s.value=s.value.filter(t=>t!=="password_confirm")}),(c,t)=>(i(),d("div",fe,[m(pe,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=n=>f.value=n),text:""},null,8,["modelValue"]),e("form",{action:"",onSubmit:Q(n=>!1,["prevent"])},[e("div",he,[e("div",ge,[be,m(l(O),{class:U({error:s.value.includes("old_password")}),modelValue:l(o).old_password,"onUpdate:modelValue":t[1]||(t[1]=n=>l(o).old_password=n),toggleMask:"",feedback:!1},null,8,["class","modelValue"]),s.value.includes("old_password")?(i(),d("span",ye,"\u904E\u53BB\u306E\u30D1\u30B9\u30EF\u30FC\u30C9\u3092\u6B63\u3057\u304F\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044")):h("",!0)])]),e("div",xe,[e("div",Be,[Ce,m(l(O),{class:U({error:s.value.includes("new_password")}),modelValue:l(o).new_password,"onUpdate:modelValue":t[2]||(t[2]=n=>l(o).new_password=n),toggleMask:"",appendTo:"self"},null,8,["class","modelValue"]),s.value.includes("new_password")?(i(),d("span",ke,"\u65B0\u898F\u306E\u30D1\u30B9\u30EF\u30FC\u30C9\u3092\u6B63\u3057\u304F\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044")):h("",!0)])]),e("div",je,[e("div",Fe,[$e,m(l(O),{class:U({error:s.value.includes("password_confirm")}),modelValue:l(o).password_confirm,"onUpdate:modelValue":t[3]||(t[3]=n=>l(o).password_confirm=n),toggleMask:"",feedback:!1},null,8,["class","modelValue"]),s.value.includes("password_confirm")?(i(),d("span",Ve,"\u65B0\u898F\u78BA\u8A8D\u306E\u30D1\u30B9\u30EF\u30FC\u30C9\u3092\u6B63\u3057\u304F\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044")):h("",!0)])]),e("div",De,[e("button",{onClick:t[4]||(t[4]=n=>j("update:modelValue",!1)),class:"flex align-center justify-center cancel"},"\u4E2D\u6B62"),e("button",{onClick:t[5]||(t[5]=n=>y()),class:"flex align-center justify-center submit-or-next"},"\u767B\u9332")])],40,we)]))}});const Ae={class:"app-filter-wrapper relative"},Ue={class:"input-wrapper relative"},Te=e("i",{class:"pi pi-search"},null,-1),qe={class:"dropdown-wrapper"},Se={key:0,class:"dropdown"},Me={key:0,class:"empty-text flex-column align-center justify-center"},Ne=e("span",{class:"text block"},"\u7D50\u679C\u306A\u3057",-1),Pe=["onClick"],Re={class:"text block"},Oe=T(),Ie=e("span",{class:"arrow-wrap flex justify-center"},[e("i",{class:"pi pi-arrow-right flex"})],-1),Le=P({setup(L){const{projects:j,salons:F}=I(),B=X(),C=G(),f=w(!1),s=w(),o=w(""),y=w([]),c=w([]);J(()=>{var p;s.value=document.getElementById("afi"),(p=s.value)==null||p.addEventListener("keydown",n),F.value.forEach(r=>{const _={id:r.id,path:null,name:r.name.replaceAll("<br>",""),type:"salon"};y.value.push(_)}),j.value.forEach(r=>{const _={id:r.id,path:null,name:r.name.replaceAll("<br>",""),type:"project"};y.value.push(_)})});const t=ue({set(p){c.value=y.value.filter(r=>r.name.match(p))},get(){return o.value}});function n(p){p&&p.keyCode===27&&(f.value=!1)}function q(p){p.type==="salon"?B.push({name:"SalonProjects",params:{cid:C.params.cid,dynid:p.id}}).then(()=>{f.value=!1,o.value=""}):p.type==="project"&&B.push({name:"ProjectPlaces",params:{cid:C.params.cid,dynid:p.id}}).then(()=>{f.value=!1,o.value=""})}return se(s,p=>{f.value=!1}),(p,r)=>(i(),d("div",Ae,[e("div",Ue,[Te,oe(e("input",{id:"afi",onClick:r[0]||(r[0]=_=>f.value=!f.value),type:"text","onUpdate:modelValue":r[1]||(r[1]=_=>D(t)?t.value=_:null),placeholder:"\u691C\u7D22"},null,512),[[ne,l(t)]])]),e("div",qe,[m(Z,{name:"slideDown"},{default:x(()=>[f.value?(i(),d("ul",Se,[c.value.length?h("",!0):(i(),d("li",Me,[m(ee,{svg:"empty",width:"24px"}),Ne])),(i(!0),d(W,null,Y(c.value,(_,$)=>(i(),d("li",{key:$,onClick:S=>q(_),class:"dropdown-item flex align-center pointer"},[e("span",Re,k(_.name),1),Oe,Ie],8,Pe))),128))])):h("",!0)]),_:1})])]))}});const He={id:"bar_app",class:"container flex justify-space-between"},ze={class:"bar-app-brand"},Ke={class:"bar-app-global-filter flex align-center"},Qe={class:"bar-app-global-actions flex justify-end"},Xe=e("i",{class:"pi pi-question-circle"},null,-1),Ge={key:0,class:"badge flex align-center justify-center text-center"},Je=e("div",{class:"header flex align-center"},[e("h3",{class:"ht"},"\u901A\u77E5")],-1),We={class:"body relative"},Ye=["onClick"],Ze={class:"content"},es={class:"date"},ss={class:"title"},ts={class:"content"},ls={key:0,class:"unseen block relative"},as=e("span",{class:"badge"},null,-1),us=[as],os=["onClick"],ns=e("span",{class:"remove flex align-center justify-center"},[e("i",{class:"pi pi-trash"})],-1),rs=[ns],is={key:0,class:"empty flex align-center justify-center"},ds={class:"d-content-header flex align-center justify-end"},cs={class:"d-content-body"},ps=["innerHTML"],Fs=P({setup(L){const j=G(),F=X(),{get:B}=_e(),{submit:C,remove:f}=te(),{user:s,onload:o,progress:y,payload:c}=I(),{d:t,d2:n,useToggle:q}=me(),p=K({id:null,first_name:null,last_name:null,email:null,username:null}),r=w(0),_=w(!1),$=w(0),S=w(),M=w(!1),V=w(null),N=w([{label:"\u30D7\u30ED\u30D5\u30A3\u30FC\u30EB",icon:"pi pi-user",command:()=>{var v;q({method:"patch",endpoints:["users/"+((v=s.value)==null?void 0:v.id),"users/current"],state:"user"})}},{label:"\u30D1\u30B9\u30EF\u30FC\u30C9\u66F4\u65B0",icon:"pi pi-lock",command:()=>{n.value=!0}},{label:"\u7BA1\u7406\u30D1\u30CD\u30EB",icon:"pi pi-cog",command:()=>{F.push({name:"Admin"})}},{label:"\u30ED\u30B0\u30A2\u30A6\u30C8",icon:"pi pi-sign-out",command:()=>location.href="https://test-panel.reactool.jp/accounts/logout/"}]),le=v=>{V.value=v,M.value=!0,_.value=!1,v.seen||(c.value={method:"patch",endpoints:["user-news/"+v.id,"users/current"],state:"user"},C({seen:!0},null,"object").then(()=>{setTimeout(()=>{var a;r.value=((a=s.value)==null?void 0:a.news.filter(g=>!g.seen).length)||0},1e3)}))},ae=v=>{f("user-news/"+v).then(()=>{B("users/current","user").then(a=>{var g;r.value=((g=a.news)==null?void 0:g.filter(b=>!b.seen).length)||0})})};return J(()=>{var v,a,g;r.value=((v=s.value)==null?void 0:v.news.filter(b=>!b.seen).length)||0,!((a=s.value)==null?void 0:a.is_superuser)&&!((g=s.value)==null?void 0:g.is_staff)&&(N.value=N.value.filter(b=>b.label!=="\u7BA1\u7406\u30D1\u30CD\u30EB"))}),se(S,v=>{_.value=!1}),A(()=>$.value,v=>{var a;v===0?c.value={method:"patch",endpoints:["users/"+((a=s.value)==null?void 0:a.id),"users/current"],state:"user"}:c.value={method:"patch",endpoints:["users","users/current"],state:"user"}}),(v,a)=>{var b,H;const g=re("router-link");return i(),d("header",He,[e("div",ze,[m(g,{class:"brand flex align-center",to:{name:"Dashboard",params:{cid:l(s).company}}},{default:x(()=>[m(ee,{svg:"reactool",width:"100px"})]),_:1},8,["to"])]),e("div",Ke,[m(Le)]),e("div",Qe,[l(s).is_superuser?(i(),ie(g,{key:0,class:"tutorials flex align-center justify-center",to:{name:"BoardTutorials",params:{cid:l(j).params.cid}}},{default:x(()=>[Xe]),_:1},8,["to"])):h("",!0),e("button",{onClick:a[0]||(a[0]=u=>_.value=!_.value),class:"news-button flex align-center justify-center relative"},[r.value>0?(i(),d("span",Ge,k(r.value),1)):h("",!0),e("i",{class:U(["pi pi-bell",{active:r.value>0}])},null,2)]),m(Z,{name:"fade"},{default:x(()=>[_.value?(i(),d("div",{key:0,class:"news",ref_key:"newsOutside",ref:S},[Je,e("div",We,[(i(!0),d(W,null,Y(l(s).news,u=>(i(),d("div",{class:"row flex align-center",onClick:E=>le(u)},[e("div",Ze,[e("span",es,k(u.created_at.substring(0,10)),1),e("h4",ss,k(u.title),1),e("div",ts,k(u.content.replace(/<[^>]*>?/gm,"").substring(0,50)),1)]),u.seen?h("",!0):(i(),d("div",ls,us)),u.seen?(i(),d("div",{key:1,onClick:Q(E=>ae(u.id),["stop"]),class:"unseen flex align-center justify-center relative"},rs,8,os)):h("",!0)],8,Ye))),256)),l(s).news.length?h("",!0):(i(),d("div",is,"\u7A7A"))])],512)):h("",!0)]),_:1}),m(ce,{id:"user_menu",final:"",label:(b=l(s))==null?void 0:b.username,items:N.value},null,8,["label","items"])]),m(R,{modelValue:l(t),"onUpdate:modelValue":a[3]||(a[3]=u=>D(t)?t.value=u:null),title:(H=l(s))==null?void 0:H.username},{default:x(()=>[m(de,{modelValue:l(t),"onUpdate:modelValue":a[1]||(a[1]=u=>D(t)?t.value=u:null),"active-tab":$.value,"onUpdate:active-tab":a[2]||(a[2]=u=>$.value=u),"close-after":"",topProgress:"",progress:l(y),form:l(ve),onload:l(o),data:l(s),query:l(p),submit:l(C)},null,8,["modelValue","active-tab","progress","form","onload","data","query","submit"])]),_:1},8,["modelValue","title"]),m(R,{modelValue:l(n),"onUpdate:modelValue":a[5]||(a[5]=u=>D(n)?n.value=u:null),title:"\u30D1\u30B9\u30EF\u30FC\u30C9\u66F4\u65B0"},{default:x(()=>[m(Ee,{modelValue:l(n),"onUpdate:modelValue":a[4]||(a[4]=u=>D(n)?n.value=u:null)},null,8,["modelValue"])]),_:1},8,["modelValue"]),m(R,{modelValue:M.value,"onUpdate:modelValue":a[6]||(a[6]=u=>M.value=u),title:V.value&&V.value.title,overflow:""},{default:x(()=>{var u,E,z;return[e("div",ds,k((E=(u=V.value)==null?void 0:u.created_at)==null?void 0:E.substring(0,10)),1),e("div",cs,[e("div",{innerHTML:(z=V.value)==null?void 0:z.content},null,8,ps)])]}),_:1},8,["modelValue","title"])])}}});export{Fs as default};
