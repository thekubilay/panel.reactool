import{d as R}from"./vuedraggable.umd.js";import{d as U,D as p,o as I,F as b,b as S,k as n,u as t,l as _,w as f,e as u,a3 as N,a as P,U as T,t as c}from"./vendor.js";import{s as H}from"./menu.esm.js";import M from"./dropdown.esm.js";import{u as L,a as O,S as G,_ as Q}from"./useFormRequestBuilder.js";import{_ as z}from"./BarTool.js";import{_ as J}from"./Icon.js";import{A as K,u as W}from"../main.js";import{u as X}from"./useRightClickHandler.js";import{_ as Y}from"./FormQuery.js";import{c as Z,d as ee}from"./rules.js";import{u as le}from"./useUtils.js";import"./overlayeventbus.esm.js";import"./virtualscroller.esm.js";const m=[[{classes:["flex"],elements:[{component:null,name:"Dropdown",db_column_name:"kind",type:"text",model:"\u6577\u5730\u914D\u7F6E\u56F3",label:"\u4E00\u822C\u56F3\u7A2E\u985E",hint:null,required:!0,rules:[],id:"kind_input",disabled:!1,options:[{name:"\u6577\u5730\u914D\u7F6E\u56F3",value:"\u6577\u5730\u914D\u7F6E\u56F3"},{name:"\u7ACB\u9762\u56F3",value:"\u7ACB\u9762\u56F3"},{name:"\u5404\u968E\u5E73\u9762\u56F3",value:"\u5404\u968E\u5E73\u9762\u56F3"}],optionLabel:"name",optionValue:"value",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-2-space","relative"]}]},{classes:["flex"],elements:[{component:null,name:"FileInput",db_column_name:"image",type:"text",model:null,label:"\u753B\u50CF",hint:".jpeg, .png \u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u3059",required:!0,id:"general_plan_input",preview_text:"\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u306E\u305F\u3081\u3001\u30AF\u30EA\u30C3\u30AF\u3084\u753B\u50CF\u30C9\u30ED\u30C3\u30D7\u3057\u3066\u304F\u3060\u3055\u3044",limit:"1MB\u4EE5\u4E0B",accept:"image/*",rules:[Z],rule:ee,disabled:!1,props:["placeholder","required","disabled","accept","hint","model","image_path","preview_text","limit","rule"],classes:["flex-column","column-1"]}]}]];const se={id:"project_general_plans",class:"panel-board relative"},ue={class:"part-wrap"},te={class:"part-wrap part-end"},ae={class:"spreadsheet-wrapper overflow-x"},ne=N('<div class="sh-container ss-container"><div class="sheet-row sheet-row-header flex align-center"><div class="sheet-cell handle flex align-center"></div><div class="sheet-cell num flex align-center">\u9806\u756A</div><div class="sheet-cell img flex align-center"><i class="pi pi-file"></i></div><div class="sheet-cell value flex align-center">\u30D7\u30E9\u30F3\u540D</div><div class="sheet-cell value sheet-cell-long flex align-center">\u753B\u50CF\u540D</div><div class="sheet-cell value flex align-center">\u30BF\u30A4\u30D7</div></div></div>',1),oe=["onContextmenu","onClick"],ie=u("div",{class:"sheet-cell handle flex align-center handle grab"},[u("i",{class:"pi pi-bars"})],-1),re={class:"sheet-cell num flex align-center"},de={class:"text block"},pe={class:"sheet-cell img flex align-center"},ce={class:"sheet-cell value flex align-center"},me={class:"text block"},ve={class:"sheet-cell value sheet-cell-long flex align-center"},_e={class:"text block"},fe={class:"sheet-cell value flex align-center"},ge={class:"text block"},Se=U({setup(he){const{get:E,save:Fe}=K(),{submit:C,submitRowReorder:j,remove:k}=L(),{d:i,dr:xe,data:g,useToggle:v}=O(),{rcm:D,rcmOpened:be,isRCOn:B}=X(g),{payload:Ee,content:r,progress:w,project:a}=W(),{findAndUpdateFormElement:h}=le(),F=p(m),o=p("\u6577\u5730\u914D\u7F6E\u56F3"),V=p(["\u6577\u5730\u914D\u7F6E\u56F3","\u7ACB\u9762\u56F3","\u5404\u968E\u5E73\u9762\u56F3"]),d=p([]),y=p([{label:"\u65B0\u898F\u30D7\u30E9\u30F3",command:()=>{var l;v({method:"post",endpoints:["app/general_plans","project_details/"+((l=a.value)==null?void 0:l.id)],state:"project"})}},{label:"\u884C\u3092\u524A\u9664\u3059\u308B",command:()=>{var l;r.value=!0,k("app/general_plans/"+((l=g.value)==null?void 0:l.id)).then(()=>{var e;E("project_details/"+((e=a.value)==null?void 0:e.id),"project").then(()=>{r.value=!1})})}}]);I(()=>{var l;d.value=((l=a.value)==null?void 0:l.general_plans.filter(e=>e.kind===o.value))||[]});function A(){var l;F.value=h(m,"kind","model",o.value),v({method:"post",endpoints:["app/general_plans","project_details/"+((l=a.value)==null?void 0:l.id)],state:"project"})}function $(l){var e;F.value=h(m,"kind","model",o.value),v({method:"patch",endpoints:["app/general_plans/"+l.id,"project_details/"+((e=a.value)==null?void 0:e.id)],state:"project"})}return b(()=>o.value,l=>{var e;d.value=((e=a.value)==null?void 0:e.general_plans.filter(s=>s.kind===l))||[]}),b(()=>a.value,l=>{d.value=(l==null?void 0:l.general_plans.filter(e=>e.kind===o.value))||[]}),(l,e)=>(P(),S("div",se,[n(G,{modelValue:t(r),"onUpdate:modelValue":e[0]||(e[0]=s=>_(r)?r.value=s:null)},null,8,["modelValue"]),n(z,{class:"justify-space-between"},{default:f(()=>[u("div",ue,[n(t(T),{type:"button",class:"submit-button",icon:"pi pi-plus","icon-pos":"left",label:"\u65B0\u898F\u30D7\u30E9\u30F3",onClick:e[1]||(e[1]=s=>A())})]),u("div",te,[n(t(M),{style:{"margin-left":"0",width:"120px"},class:"dropdown",modelValue:o.value,"onUpdate:modelValue":e[2]||(e[2]=s=>o.value=s),options:V.value,placeholder:"\u30D5\u30A9\u30EB\u30C0\u30FC\u9078\u629E"},null,8,["modelValue","options"])])]),_:1}),u("div",ae,[ne,n(t(R),{tag:"div",onEnd:e[3]||(e[3]=s=>t(j)({value:d.value},{method:"post",endpoints:["app/general_plans","project_details/"+t(a).id],state:"project"})),list:d.value,class:"sb-container ss-container",handle:".handle","item-key":"id"},{item:f(({element:s,index:q})=>[u("div",{onContextmenu:x=>t(B)(x,s),onClick:x=>$(s),"aria-haspopup":"true","aria-controls":"plan_rc_menu",class:"sheet-row flex align-center list-group-item relative pointer"},[n(t(H),{id:"rc_menu",ref_key:"rcm",ref:D,class:"rc has-final-action",model:y.value,popup:!0},null,8,["model"]),ie,u("div",re,[u("span",de,c(q+1),1)]),u("div",pe,[n(J,{svg:"image"})]),u("div",ce,[u("span",me,c(s.kind),1)]),u("div",ve,[u("span",_e,c(s.image.split("/",6)[5].split(".")[0]),1)]),u("div",fe,[u("span",ge,"."+c(s.image.split("/",6)[5].split(".")[1]),1)])],40,oe)]),_:1},8,["list"])]),n(Q,{modelValue:t(i),"onUpdate:modelValue":e[5]||(e[5]=s=>_(i)?i.value=s:null),title:"\u4E00\u822C\u56F3\u30D5\u30A9\u30FC\u30E0"},{default:f(()=>[n(Y,{modelValue:t(i),"onUpdate:modelValue":e[4]||(e[4]=s=>_(i)?i.value=s:null),"close-after":"",topProgress:"",progress:t(w),form:t(m),query:{project:t(a).id},submit:t(C)},null,8,["modelValue","progress","form","query","submit"])]),_:1},8,["modelValue"])]))}});export{Se as default};
