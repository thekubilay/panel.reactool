import{d as ge,D as i,o as Ae,F as w,b as q,k as s,w as p,J as ye,r as re,a as C,e as o,u as t,M as we,N as xe,c as N,H as U,t as Be,l as D,g as de,K as ke,L as De,T as je,m as Ee,ae as $}from"./vendor.js";import{s as Te,a as j}from"./column.esm.js";import{_ as Ve}from"./BarTool.js";import{u as Pe,a as Ie,_ as pe}from"./useFormRequestBuilder.js";import{_ as qe}from"./ButtonDropdown.js";import{_ as Ne}from"./FormQuery.js";import{_ as Ue}from"./ContextImagesThumbnailContainer.js";import{_ as $e}from"./FormNested.js";import{A as Le,u as Re}from"../main.js";import{u as ve}from"./FormProject.js";import{u as me}from"./useUtils.js";import"./dropdown.esm.js";import"./overlayeventbus.esm.js";import"./virtualscroller.esm.js";import"./menu.esm.js";import"./Icon.js";import"./rules.js";const Se=[[{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputText",db_column_name:"name",type:"text",model:null,label:"\u30C8\u30FC\u30AF\u30F3\u540D",hint:null,placeholder:"AAA\u304A\u5BA2\u69D8",required:!0,id:"token_input",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-2-space"]},{component:null,name:"Dropdown",db_column_name:"permanent",type:"text",model:!1,label:"\u6052\u4E45\u7684",hint:"\u300C\u306F\u3044\u300D\u306B\u3059\u308B\u3068\u3001\u671F\u9593\u30EA\u30DF\u30C3\u30C8\u306A\u3057\u306B\u306A\u308A\u307E\u3059",required:!1,rules:[],id:"master_token_input",disabled:!1,options:[{name:"\u306F\u3044",value:!0},{name:"\u3044\u3044\u3048",value:!1}],optionLabel:"name",optionValue:"value",placeholder:"\u6A29\u9650\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-2-space","relative"]}]},{classes:["flex","justify-space-between"],elements:[{component:null,name:"CalendarInput",db_column_name:"start_date",type:"text",model:new Date,label:"\u898B\u308B\u671F\u9593\u7D42\u958B\u59CB\u65E5",hint:null,placeholder:"null",required:!0,id:"start_date_input",rules:[],dateFormat:"yy\u5E74mm\u6708dd\u65E5",disabled:!1,appendTo:"self",props:["placeholder","required","disabled","dateFormat","appendTo"],classes:["flex-column","column-2-space"]},{component:null,name:"CalendarInput",db_column_name:"end_date",type:"text",model:new Date,label:"\u898B\u308B\u671F\u9593\u7D42\u4E86\u65E5",hint:null,placeholder:"null",required:!0,id:"end_date_input",rules:[],dateFormat:"yy\u5E74mm\u6708dd\u65E5",appendTo:"self",disabled:!1,props:["placeholder","required","disabled","dateFormat","appendTo"],classes:["flex-column","column-2-space"]}]}]];const Me={id:"project"},Oe={class:"part-wrap flex align-center relative"},He=["innerHTML"],Je=["href"],Ke=o("span",{class:"divider"},null,-1),Qe={class:"part-wrap flex align-center"},ze={key:0,class:"token-dialog"},Ge={class:"window"},We=o("h4",{class:"title"},"\u65B0\u898F\u30C8\u30FC\u30AF\u30F3",-1),Xe={class:"copy-container relative"},Ye=o("p",{class:"warning-text"},[U(" *\u4F5C\u6210\u3055\u308C\u305F\u30C8\u30FC\u30AF\u30F3\u306F\u3001\u30C8\u30FC\u30AF\u30F3\u540D\u3068\u65E5\u4ED8\u542B\u3081\u3066API\u30C8\u30FC\u30AF\u30F3\u4E00\u89A7\u306B\u767B\u9332\u3055\u308C\u3066\u3044\u307E\u3059\u3002"),o("br"),U(" **\u3053\u3061\u3089\u306E\u30C8\u30FC\u30AF\u30F3\u304B\u3089\u6A29\u9650\u3092\u5916\u3057\u305F\u3044\u5834\u5408\u3001\u4E00\u89A7\u304B\u3089\u6D88\u3057\u3066\u304F\u3060\u3055\u3044\u3002")],-1),Ze={class:"action-wrapper flex justify-end"},eu=["onClick"],uu=o("i",{class:"pi pi-times"},null,-1),au=[uu],Au=ge({setup(lu){var J;const{get:ce}=Le(),{submit:E,remove:_e}=Pe(),{payload:fe,user:T,project:u,progress:tu,onload:x}=Re(),{checkPermission:L,findAndUpdateFormElement:R}=me(),{d:f,d2:F,dpc:h,data:S,images:v,useToggle:M}=Ie(),{copyText:Fe}=me(),O=i("https://app.reactool.jp/"+((J=u.value)==null?void 0:J.id)),Ce=ye(),b=i(null),g=i(""),V=i(""),m=i(ve),c=i(!1),r=i(0),P=i("pin_input"),B=i([]),k=i(["\u8A73\u7D30","\u8A2D\u5B9A","\u5730\u56F3\u306E\u30D4\u30F3","\u30ED\u30B4\u753B\u50CF"]),_=i({}),I=i([{label:"\u7DE8\u96C6",icon:"pi pi-pencil",command:()=>{var e,a,n;x.value="",V.value=((e=u.value)==null?void 0:e.name)||"",k.value=["\u8A73\u7D30","\u8A2D\u5B9A","\u5730\u56F3\u306E\u30D4\u30F3","\u30ED\u30B4\u753B\u50CF"],m.value=ve,!L((a=u.value)==null?void 0:a.permissions,"is_token")&&!((n=T.value)==null?void 0:n.is_superuser)?m.value=R(m.value,"token_on","disabled",!0,1):m.value=R(m.value,"token_on","disabled",!1,1),_.value={id:null,name:null,company:null},$(()=>{var d,l;M({method:"patch",endpoints:["projects/"+((d=u.value)==null?void 0:d.id),"project_details/"+((l=u.value)==null?void 0:l.id)],state:"project"},u.value)})}},{label:"API\u30C8\u30FC\u30AF\u30F3\u4F5C\u6210",icon:"pi pi-unlock",command:()=>{var e;x.value="\u30C8\u30FC\u30AF\u30F3\u4F5C\u6210\u4E2D",V.value="\u30C8\u30FC\u30AF\u30F3",k.value=[],_.value={project:(e=u.value)==null?void 0:e.id},m.value=Se,m.value[0][1].elements[0].model=new Date,m.value[0][1].elements[1].model=new Date,$(()=>{var a;M({method:"post",endpoints:["project_api_tokens","project_details/"+((a=u.value)==null?void 0:a.id)],state:"project"})})}},{label:"API\u30C8\u30FC\u30AF\u30F3\u4E00\u89A7",icon:"pi pi-list",command:()=>{F.value=!0}},{label:"JSON \u30A8\u30AF\u30B9\u30DD\u30FC\u30C8",icon:"pi pi-database",command:()=>{var e;window.open("http://panel-test-env.eba-92hkwvtp.ap-northeast-1.elasticbeanstalk.com/api/project_details/"+((e=u.value)==null?void 0:e.id)+"/?format=json","_blank")}}]);Ae(()=>{var e;L((e=u.value)==null?void 0:e.permissions,"is_token")||(I.value=I.value.filter(a=>!["API\u30C8\u30FC\u30AF\u30F3\u4F5C\u6210","API\u30C8\u30FC\u30AF\u30F3\u4E00\u89A7"].includes(a.label))),H()});function H(){var e,a,n;B.value=JSON.parse(JSON.stringify(((e=u.value)==null?void 0:e.routes)||[])).filter(d=>d.active).filter(d=>!["Frame1","Frame2"].includes(d.component)),(((a=T.value)==null?void 0:a.is_staff)||((n=T.value)==null?void 0:n.is_superuser))&&(B.value.unshift({panel_name:"ProjectRoutes",title:"\u30EB\u30FC\u30C8"}),B.value.unshift({panel_name:"ProjectScopePermissions",title:"\u30D1\u30FC\u30DF\u30C3\u30B7\u30E7\u30F3"}))}function he(){var e;c.value=!0,fe.value={method:"patch",endpoints:["projects/"+S.value.id,"project_details/"+((e=u.value)==null?void 0:e.id)],state:"project"},r.value===2?E({pin:null},null,"object").then(()=>{c.value=!1,v.value=[]}):r.value===3&&E({logo:null},null,"object").then(()=>{c.value=!1,v.value=[]})}function be(e){c.value=!0,_e("project_api_tokens/"+e).then(()=>{var a;ce("project_details/"+((a=u.value)==null?void 0:a.id),"project").then(()=>{setTimeout(()=>{c.value=!1},500)})})}return w(()=>u.value,e=>{H(),O.value="https://app.reactool.jp/"+(e==null?void 0:e.id),r.value===2?v.value=(e==null?void 0:e.pin)?[{image:e.pin}]:[]:r.value===3&&(v.value=(e==null?void 0:e.logo)?[{image:e.logo}]:[])}),w(()=>b.value,e=>{e&&_.value.hasOwnProperty("project")&&(x.value="encryption \u30B9\u30BF\u30FC\u30C8",c.value=!0,setTimeout(()=>{var n;const a="https://app.reactool.jp/";g.value=a+((n=u.value)==null?void 0:n.id)+"/?token="+e.token_id,c.value=!1,$(()=>{h.value=!0})},2e3))}),w(()=>f.value,e=>{e||(h.value=!1,r.value=0,g.value="",b.value=null)}),w(()=>h.value,e=>{e||(g.value="",b.value=null)}),w(()=>r.value,e=>{var a,n,d,l,A,y,K,Q,z,G,W,X,Y,Z,ee,ue,ae,le,te,oe,ne,se,ie;e===0?(v.value=[],_.value={id:null,order_id:null,name:(a=u.value)==null?void 0:a.name,context:(n=u.value)==null?void 0:n.context,address:(d=u.value)==null?void 0:d.address,archive:(l=u.value)==null?void 0:l.archive,token_on:(A=u.value)==null?void 0:A.token_on,salon_view:(y=u.value)==null?void 0:y.salon_view,legacy:(K=u.value)==null?void 0:K.legacy}):e===1?(v.value=[],_.value={salon:(Q=u.value)==null?void 0:Q.salon,salon_view:(z=u.value)==null?void 0:z.salon_view,archive:(G=u.value)==null?void 0:G.archive,token_on:(W=u.value)==null?void 0:W.token_on}):e===2?(_.value={logo:null,logo_width:null,logo_height:null,logo_place:3,archive:(X=u.value)==null?void 0:X.archive,token_on:(Y=u.value)==null?void 0:Y.token_on,salon_view:(Z=u.value)==null?void 0:Z.salon_view,legacy:(ee=u.value)==null?void 0:ee.legacy},v.value=((ue=u.value)==null?void 0:ue.pin)?[{image:u.value.pin}]:[],P.value="pin_input"):e===3&&(_.value={pin:null,pin_width:(ae=u.value)==null?void 0:ae.pin_width,pin_height:(le=u.value)==null?void 0:le.pin_height,archive:(te=u.value)==null?void 0:te.archive,token_on:(oe=u.value)==null?void 0:oe.token_on,salon_view:(ne=u.value)==null?void 0:ne.salon_view,legacy:(se=u.value)==null?void 0:se.legacy},v.value=((ie=u.value)==null?void 0:ie.logo)?[{image:u.value.logo}]:[],P.value="logo_input")}),(e,a)=>{const n=re("router-link"),d=re("router-view");return C(),q("div",Me,[s(Ve,null,{default:p(()=>[o("div",Oe,[o("h3",{class:"title",innerHTML:t(u).name},null,8,He),s(qe,{id:"project_setting",items:I.value},null,8,["items"]),o("a",{style:{"margin-left":"5px",color:"#2ecc71"},target:"_blank",href:O.value},"APP\u3078",8,Je)]),Ke,o("div",Qe,[(C(!0),q(we,null,xe(B.value,(l,A)=>{var y;return C(),N(n,{key:A,class:"pn-item flex align-center justify-center","active-class":"active",to:{name:l==null?void 0:l.panel_name,params:{dynid:(y=t(Ce))==null?void 0:y.params.dynid}}},{default:p(()=>[U(Be(l==null?void 0:l.title.replace("<br>","")),1)]),_:2},1032,["to"])}),128))]),s(pe,{modelValue:t(f),"onUpdate:modelValue":a[6]||(a[6]=l=>D(f)?f.value=l:null),title:V.value.replaceAll("<br>",""),overflow:k.value.length>0&&r.value===3},{default:p(()=>[s(Ne,{modelValue:t(f),"onUpdate:modelValue":a[0]||(a[0]=l=>D(f)?f.value=l:null),response:b.value,"onUpdate:response":a[1]||(a[1]=l=>b.value=l),activeTab:r.value,"onUpdate:activeTab":a[2]||(a[2]=l=>r.value=l),onload:t(x),tabs:k.value,form:m.value,data:t(S),loading:c.value,query:_.value,submit:t(E)},{default:p(()=>[r.value===2||r.value===3?(C(),N(Ue,{key:0,containerId:P.value,images:t(v),remove:he},null,8,["containerId","images"])):de("",!0)]),_:1},8,["modelValue","response","activeTab","onload","tabs","form","data","loading","query","submit"]),t(h)?(C(),q("div",ze,[o("div",Ge,[We,o("div",Xe,[ke(o("input",{id:"token_text",type:"text",disabled:"","onUpdate:modelValue":a[3]||(a[3]=l=>g.value=l)},null,512),[[De,g.value]]),o("i",{onClick:a[4]||(a[4]=l=>t(Fe)("token_text")),class:"pi pi-copy flex align-center justify-center"})]),Ye,o("div",Ze,[o("button",{onClick:a[5]||(a[5]=l=>h.value=!1)},"\u9589\u3058\u308B")])])])):de("",!0)]),_:1},8,["modelValue","title","overflow"]),s(pe,{modelValue:t(F),"onUpdate:modelValue":a[8]||(a[8]=l=>D(F)?F.value=l:null),title:"API\u30C8\u30FC\u30AF\u30F3\u4E00\u89A7",overflow:""},{default:p(()=>[s($e,{modelValue:t(F),"onUpdate:modelValue":a[7]||(a[7]=l=>D(F)?F.value=l:null),form:[[]],loading:c.value},{default:p(()=>[s(t(Te),{value:t(u).api_tokens,rowindex:"index",style:{"padding-bottom":"14px"},responsiveLayout:"scroll",class:"option-datatable"},{default:p(()=>[s(t(j),{field:"name",header:"\u30C8\u30FC\u30AF\u30F3\u540D"}),s(t(j),{field:"start_date",header:"\u958B\u59CB\u65E5"}),s(t(j),{field:"end_date",header:"\u7D42\u4E86\u65E5"}),s(t(j),{style:{width:"40px","text-align":"right","margin-left":"auto"},body:"index"},{body:p(l=>[o("span",{onClick:A=>be(l.data.id),class:"remove pointer"},au,8,eu)]),_:1})]),_:1},8,["value"])]),_:1},8,["modelValue","loading"])]),_:1},8,["modelValue"])]),_:1}),s(d,null,{default:p(({Component:l})=>[s(je,{name:"fade",mode:"out-in"},{default:p(()=>[(C(),N(Ee(l)))]),_:2},1024)]),_:1})])}}});export{Au as default};
