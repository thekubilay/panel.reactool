import{E as ie,j as re,D as v,d as fe,F as Z,b as N,k as c,u as e,l as g,w as h,e as s,a as A,U as ve,t as ee,M as _e,N as be,n as he,c as de,g as le,K as xe,L as ge}from"./vendor.js";import{d as pe}from"./vuedraggable.umd.js";import{s as je}from"./menu.esm.js";import{a as ne,s as ye}from"./column.esm.js";import{a as Ce,u as Ee,S as we,_ as ce}from"./useFormRequestBuilder.js";import{_ as De}from"./BarTool.js";import{_ as Fe}from"./Icon.js";import{u as ke}from"./useRightClickHandler.js";import{A as Ve,u as qe}from"../main.js";import{_ as Ae}from"./FormQuery.js";import{_ as Be}from"./FormNested.js";import{_ as Ie}from"./DialogDelete.js";import"./overlayeventbus.esm.js";import"./dropdown.esm.js";import"./virtualscroller.esm.js";const te=[[{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputText",db_column_name:"name",type:"text",model:null,label:"\u30D5\u30A1\u30A4\u30EB\u540D",hint:null,placeholder:"\u9593\u53D6\u308A",required:!0,id:"name_input",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-2-space"]},{component:null,name:"InputText",db_column_name:"class_name",type:"text",model:null,label:"CSS\u30AF\u30E9\u30B9",hint:null,placeholder:"class-name",required:!1,id:"class_name_input",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-2-space"]}]},{classes:["flex"],elements:[{component:null,name:"Dropdown",db_column_name:"type",type:"text",model:"InputText",label:"\u30BF\u30A4\u30D7",hint:null,required:!1,rules:[],id:"type_input",disabled:!1,options:[{name:"\u30C6\u30AD\u30B9\u30C8\u5217",value:"InputText"},{name:"\u6570\u5B57\u5217",value:"InputNumber"},{name:"\u9078\u629E\u5217",value:"Dropdown"},{name:"\u753B\u50CF\u5217",value:"FileInput"}],optionLabel:"name",optionValue:"value",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-1","relative"]}]}]],$e=[{classes:["flex"],elements:[{component:null,name:"Dropdown",db_column_name:"name",type:"text",model:null,label:"",hint:null,required:!1,rules:[],id:"",disabled:!1,options:[],optionLabel:"name",optionValue:"id",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-1","relative"]}]},{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputText",db_column_name:"name",type:"text",model:null,label:"",hint:null,placeholder:"\u30FC",required:!1,id:"",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-1"]}]},{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputNumber",db_column_name:"name",type:"text",model:0,label:"",hint:null,placeholder:"\u30FC",required:!1,id:"",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-1"]}]},{classes:["flex"],elements:[{component:null,name:"FileInput",db_column_name:"value",type:"text",model:null,label:"PIN",hint:".jpeg, .png \u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u3059",required:!1,id:"pin_input",preview_text:"\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u306E\u305F\u3081\u3001\u30AF\u30EA\u30C3\u30AF\u3084\u753B\u50CF\u30C9\u30ED\u30C3\u30D7\u3057\u3066\u304F\u3060\u3055\u3044",limit:"1MB\u4EE5\u4E0B",accept:"image/*",rules:[],rule:null,disabled:!1,props:["placeholder","required","disabled","accept","hint","model","preview_text"],classes:["flex-column","column-1"]}]}];function Re(O){const j=ie({id:null,order_id:null,project:O.value.id,name:null,type:null,class_name:null,plan_field_options:[]}),B=ie({id:null,order_id:null,plan_field:null,plan_content:null,value:null,field:null,image:null,thumbnail:null});return{q1:j,q2:B}}function Ne(){const{get:O,save:j}=Ve(),{d:B,dr:I,images:D,data:d,useToggle:x}=Ce(),{submit:F,submitRowReorder:z,submitAsFormObject:k,remove:L}=Ee(),{rcm:se,rcmOpened:oe,isRCOn:S}=ke(d),{payload:y,project:r,progress:M,onload:K,content:_}=qe(),{q1:m,q2:Y}=Re(r),V=re(()=>{var l;return(l=r.value)==null?void 0:l.plan_fields}),H=re(()=>{var l;return(l=r.value)==null?void 0:l.plan_contents}),b=v(te),G=v(!1),C=v(),U=v(!1),W=v("image_input"),X=v(null),Q=v(!1),P=v([]),T=v([]),J=v([]),$=v(!1),E=v([{label:"\u884C\u3092\u8907\u88FD\u3059\u308B",command:()=>{var l;_.value=!0,j("app/plan_contents",{duplicate:!0,project:(l=r.value)==null?void 0:l.id},"post").then(a=>{var o;const u=d.value.plan_contexts.map(i=>(i.plan_content=a.id,i.id=null,i));y.value={method:"post",endpoints:["app/plan_contexts","project_details/"+((o=r.value)==null?void 0:o.id)],state:"project"},F({duplicate:u},null,"object").then(()=>{_.value=!1})})}},{label:"\u884C\u3092\u524A\u9664\u3059\u308B",command:()=>{_.value=!0,L("app/plan_contents/"+d.value.id).then(()=>{var l;O("project_details/"+((l=r.value)==null?void 0:l.id),"project").then(()=>{_.value=!1})})}}]);return{reform:b,query:C,dropdown:Q,d:B,d2:$,dr:I,rm:U,data:d,response:X,q1:m,containerId:W,loading:G,content:_,project:r,progress:M,fields:V,contents:H,rightClickMenu:E,rcm:se,isRCOn:S,submit:F,submitRowReorder:z,reorderOptions:l=>{m.plan_field_options=l.value},saveRow:()=>{var u;y.value={method:"post",endpoints:["app/plan_contexts","project_details/"+((u=r.value)==null?void 0:u.id)],state:"project"};let l={update:[]},a=[];d.value.plan_contexts.forEach((o,i)=>{if(o.value=b.value[0][i].elements[0].model,l.update.push({id:o.id,value:o.value}),o.field==="FileInput"){const w=new FormData;b.value[0][i].elements[0].model&&(w.append("image",b.value[0][i].elements[0].model),w.append("thumbnail",b.value[0][i].elements[0].model),a.push({id:o.id,data:w}))}}),F(l,null,"object").then(()=>{a.length?a.forEach((o,i)=>{var w;y.value={method:"patch",endpoints:["app/plan_contexts/"+o.id,"project_details/"+((w=r.value)==null?void 0:w.id)],state:"project"},F(o.data,null).then(()=>{a.length===i+1&&($.value=!1)})}):$.value=!1})},removeItem:l=>{_.value=!0,L(l+d.value.id).then(()=>{var a;B.value=!1,I.value=!1,O("project_details/"+((a=r.value)==null?void 0:a.id),"project").then(()=>{U.value=!1,_.value=!1})})},cr:()=>{var a,u,o;y.value={method:"post",endpoints:["app/plan_contents","project_details/"+((a=r.value)==null?void 0:a.id)],state:"project"},_.value=!0;const l=[];(u=V.value)==null||u.forEach(i=>{const w={id:null,order_id:null,plan_field:i,plan_content:null,value:"",field:i.type,image:null,thumbnail:null};l.push(w)}),F({create:l,project:(o=r.value)==null?void 0:o.id},null,"object").then(()=>{_.value=!1})},cf:()=>{var l;m.plan_field_options=[],C.value=m,C.value.order_id=V.value&&V.value.length?V.value.length+1:1,b.value=JSON.parse(JSON.stringify(te)),x({method:"post",endpoints:["app/plan_fields","project_details/"+((l=r.value)==null?void 0:l.id)],state:"project"})},ef:l=>{var a;U.value=!0,C.value=m,C.value.order_id=l.order_id,C.value.plan_field_options=l.plan_field_options,b.value=JSON.parse(JSON.stringify(te)),b.value.forEach(u=>{u.forEach(o=>{o.elements.forEach(i=>{i.db_column_name==="type"&&(i.disabled=!0)})})}),x({method:"patch",endpoints:["app/plan_fields/"+l.id,"project_details/"+((a=r.value)==null?void 0:a.id)],state:"project"},l)},ec:l=>{var u,o;C.value=Y,d.value=l,y.value={method:"post",endpoints:["app/plan_contents/"+l.id,"project_details/"+((u=r.value)==null?void 0:u.id)],state:"project"};let a=[[]];(o=V.value)==null||o.forEach((i,w)=>{$e.forEach(ue=>{if(ue.elements[0].name===i.type){let p=JSON.parse(JSON.stringify(ue.elements[0]));p.db_column_name="value",p.label=i.name,l.plan_contexts.forEach(q=>{q.plan_field.id===i.id&&(["\u91D1\u984D","\u4FA1\u683C"].includes(i.name)&&(p.mode="currency",p.props.push("mode"),p.locale="jp-JP",p.props.push("locale"),p.currency="JPY",p.props.push("currency")),q.field==="InputNumber"?q.value&&q.value!==""?p.model=parseInt(q.value):p.model=null:(q.field==="Dropdown"&&(p.options=i.plan_field_options,p.optionValue="name"),p.model=q.value))});const me={classes:["flex"],elements:[p]};a[0].push(me)}})}),b.value=a,$.value=!0},co:()=>{const l={id:null,order_id:null,name:"\u9078\u629E\u9805\u76EE "+(m.plan_field_options.length+1),plan_field:null};m.plan_field_options.push(l),P.value.push(l)},ro:l=>{m.plan_field_options.forEach((u,o)=>{o===l&&u.id&&J.value.push(u.id)}),m.plan_field_options=m.plan_field_options.filter((u,o)=>o!==l)},so:l=>{var a;y.value={method:"post",endpoints:["app/plan_field_options","project_details/"+((a=r.value)==null?void 0:a.id)],state:"project"},l.hasOwnProperty("type")&&l.type==="Dropdown"&&(m.plan_field_options.forEach((u,o)=>{u.order_id=o+1,u.plan_field=l.id,u.id&&T.value.push(u)}),F({create:P.value,update:T.value,remove:J.value},null,"object").then(()=>{J.value=[],P.value=[],T.value=[]}))},sd:l=>{l.forEach(a=>{a.forEach(u=>{u.elements.forEach(o=>{Q.value=o.name==="Dropdown"&&o.model==="Dropdown"})})})}}}const Oe={id:"project_plans",class:"panel-board relative"},Se={class:"part-wrap"},Ue={class:"cm-spreadsheet-wrapper overflow-x"},Pe={class:"sh-container ss-container flex"},Te=s("div",{class:"sheet-cell handle bfd sheet-cell flex align-center"},null,-1),Je=s("div",{class:"sheet-cell num bfd flex align-center"},"\u9806\u756A",-1),Le={class:"list-cell flex align-center relative pointer"},Me={class:"sheet-cell column-1 edit-cell value flex align-center"},He=s("span",{class:"flex align-center justify-center handle grab"},[s("i",{class:"pi pi-bars"})],-1),Qe={class:"context th-context block"},ze=["onClick"],Ke=s("i",{class:"pi pi-pencil"},null,-1),Ye=[Ke],Ge=s("span",{class:"text flex align-center justify-center"},[s("i",{class:"pi pi-plus"})],-1),We=[Ge],Xe=["onClick","onContextmenu"],Ze=s("div",{class:"sheet-cell handle bfd flex align-center justify-center grab"},[s("i",{class:"pi pi-bars"})],-1),el={class:"sheet-cell num bfd flex align-center"},ll={class:"sheet-cell value flex align-center"},nl={key:1,class:"context block"},tl=["onUpdate:modelValue"],sl=["onClick"],ol=s("i",{class:"pi pi-times"},null,-1),al=[ol],ul={class:"button-wrapper flex justify-end"},il={class:"action-wrapper flex align-center"},Al=fe({setup(O){const{reform:j,query:B,dropdown:I,d:D,d2:d,dr:x,rm:F,data:z,response:k,q1:L,containerId:se,loading:oe,content:S,project:y,progress:r,fields:M,contents:K,rightClickMenu:_,rcm:m,isRCOn:Y,submit:V,submitRowReorder:H,reorderOptions:b,saveRow:G,removeItem:C,cr:U,cf:W,ef:X,ec:Q,co:P,ro:T,so:J,sd:$}=Ne();return Z(()=>D.value,E=>{E||(I.value=E)}),Z(()=>k.value,E=>{J(E)}),Z(()=>j.value,E=>{$(E)},{deep:!0}),(E,t)=>(A(),N("div",Oe,[c(we,{modelValue:e(S),"onUpdate:modelValue":t[0]||(t[0]=n=>g(S)?S.value=n:null)},null,8,["modelValue"]),c(De,{class:"justify-space-between"},{default:h(()=>[s("div",Se,[c(e(ve),{type:"button",class:"submit-button",icon:"pi pi-plus","icon-pos":"left",label:"\u65B0\u898F\u30ED\u30FC",onClick:t[1]||(t[1]=n=>e(U)())})])]),_:1}),s("div",Ue,[s("div",Pe,[Te,Je,c(e(pe),{tag:"div",onEnd:t[2]||(t[2]=n=>e(H)({value:e(M)},{method:"post",endpoints:["app/plan_fields","project_details/"+e(y).id],state:"project"})),list:e(M),class:"sheet-row sheet-row-header flex align-center",handle:".handle","item-key":"id"},{item:h(({element:n,index:R})=>[s("div",Le,[s("div",Me,[He,s("span",Qe,ee(n.name),1),s("span",{onClick:f=>e(X)(n),class:"edit flex align-center justify-center pointer"},Ye,8,ze)])])]),_:1},8,["list"]),s("div",{onClick:t[3]||(t[3]=n=>e(W)()),class:"sheet-cell add bfd flex align-center pointer"},We)]),c(e(pe),{tag:"div",onEnd:t[4]||(t[4]=n=>e(H)({value:e(K)},{method:"post",endpoints:["app/plan_contents","project_details/"+e(y).id],state:"project"})),list:e(K),class:"cm-ss-body",handle:".handle","item-key":"id"},{item:h(({element:n,index:R})=>[s("div",{onClick:f=>e(Q)(n),onContextmenu:f=>e(Y)(f,n),"aria-haspopup":"true","aria-controls":"plan_rc_menu",class:"sb-container ss-container flex"},[c(e(je),{id:"rc_menu",ref_key:"rcm",ref:m,class:"rc has-final-action",model:e(_),popup:!0},null,8,["model"]),Ze,s("div",el,ee(R+1),1),(A(!0),N(_e,null,be(n.plan_contexts,(f,ae)=>(A(),N("div",{key:ae,class:"ss-contents flex"},[s("div",ll,[f.value||!f.image?(A(),N("span",{key:0,class:he([{"number-price":["\u91D1\u984D","\u4FA1\u683C"].includes(f.plan_field.name)&&f.field==="InputNumber","number-text":!["\u91D1\u984D","\u4FA1\u683C"].includes(f.plan_field.name)&&f.field==="InputNumber"},"context block"])},ee(f.value),3)):(A(),N("span",nl,[f.image?(A(),de(Fe,{key:0,svg:"image"})):le("",!0)]))])]))),128))],40,Xe)]),_:1},8,["list"])]),c(ce,{modelValue:e(D),"onUpdate:modelValue":t[12]||(t[12]=n=>g(D)?D.value=n:null),title:"\u30D5\u30A3\u30FC\u30EB\u30C9\u30D5\u30A9\u30FC\u30E0",overflow:""},{default:h(()=>[c(Ae,{modelValue:e(D),"onUpdate:modelValue":t[6]||(t[6]=n=>g(D)?D.value=n:null),dr:e(x),"onUpdate:dr":t[7]||(t[7]=n=>g(x)?x.value=n:null),response:e(k),"onUpdate:response":t[8]||(t[8]=n=>g(k)?k.value=n:null),topProgress:"",closeAfter:"",progress:e(r),form:e(j),data:e(z),loading:e(oe),query:e(B),remove:e(F),submit:e(V)},{default:h(()=>[e(I)?(A(),de(e(ye),{key:0,value:e(L).plan_field_options,rowindex:"index",onRowReorder:e(b),responsiveLayout:"scroll",class:"option-datatable"},{default:h(()=>[c(e(ne),{rowReorder:!0,headerStyle:"width: 3rem",reorderableColumn:!1}),c(e(ne),{field:"name",header:"\u9805\u76EE\u540D"},{body:h(n=>[xe(s("input",{class:"option-input",type:"text","onUpdate:modelValue":R=>n.data.name=R,placeholder:"\u9078\u629E\u9805\u76EE"},null,8,tl),[[ge,n.data.name]])]),_:1}),c(e(ne),{style:{width:"40px","text-align":"right","margin-left":"auto"},body:"index"},{body:h(n=>[s("span",{onClick:R=>e(T)(n.index),class:"remove pointer"},al,8,sl)]),_:1})]),_:1},8,["value","onRowReorder"])):le("",!0),e(I)?(A(),N("button",{key:1,onClick:t[5]||(t[5]=n=>e(P)()),class:"add-option"},"\u9078\u629E\u9805\u76EE\u3092\u8FFD\u52A0\u3059\u308B")):le("",!0)]),_:1},8,["modelValue","dr","response","progress","form","data","loading","query","remove","submit"]),c(Ie,{modelValue:e(x),"onUpdate:modelValue":t[11]||(t[11]=n=>g(x)?x.value=n:null)},{default:h(()=>[s("div",ul,[s("button",{onClick:t[9]||(t[9]=n=>x.value=!1),class:"cancel"},"\u3044\u3044\u3048"),s("button",{onClick:t[10]||(t[10]=n=>e(C)("app/plan_fields/")),class:"delete"},"\u306F\u3044")])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),c(ce,{modelValue:e(d),"onUpdate:modelValue":t[18]||(t[18]=n=>g(d)?d.value=n:null),title:"\u9593\u53D6\u308A\u30D5\u30A9\u30FC\u30E0",overflow:""},{default:h(()=>[c(Be,{modelValue:e(d),"onUpdate:modelValue":t[15]||(t[15]=n=>g(d)?d.value=n:null),form:e(j),"onUpdate:form":t[16]||(t[16]=n=>g(j)?j.value=n:null),response:e(k),"onUpdate:response":t[17]||(t[17]=n=>g(k)?k.value=n:null),"close-after":"",topProgress:"",progress:e(r)},{actions:h(()=>[s("div",il,[s("button",{onClick:t[13]||(t[13]=n=>d.value=!1),class:"flex align-center justify-center cancel"},"\u4E2D\u6B62"),s("button",{onClick:t[14]||(t[14]=n=>e(G)()),class:"flex align-center justify-center submit-or-next"},"\u767B\u9332")])]),_:1},8,["modelValue","form","response","progress"])]),_:1},8,["modelValue"])]))}});export{Al as default};
