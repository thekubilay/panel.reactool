import{d as G}from"./vuedraggable.umd.js";import{s as J}from"./menu.esm.js";import{a as K,u as W,S as X,_ as Y}from"./useFormRequestBuilder.js";import{_ as R}from"./Icon.js";import{_ as Z}from"./DialogDelete.js";import{_ as ee}from"./ContextImagesThumbnailContainer.js";import{_ as le}from"./FormQuery.js";import{A as ae,u as se}from"../main.js";import{f as w}from"./FormSalonPlaces.js";import{u as ne}from"./useRightClickHandler.js";import{d as te,D as c,F as D,b as S,k as p,u,l as g,e as n,w as b,a3 as ue,a as y,t as F,c as N,g as oe,M as ie,N as de}from"./vendor.js";import"./overlayeventbus.esm.js";import"./rules.js";const re={id:"salon-map",class:"panel-board"},ce={class:"spreadsheet-wrapper overflow-y"},ve=ue('<div class="sh-container ss-container"><div class="sheet-row sheet-row-header flex align-center"><div class="sheet-cell handle flex align-center"></div><div class="sheet-cell num flex align-center">\u9806\u756A</div><div class="sheet-cell sheet-cell-long value flex align-center">\u65BD\u8A2D\u540D</div><div class="sheet-cell sheet-cell-long value flex align-center">\u4F4F\u6240</div><div class="sheet-cell value flex align-center">PIN</div><div class="sheet-cell value flex align-center">\u65BD\u8A2D\u753B\u50CF</div></div></div>',1),pe=["onClick","onContextmenu"],me=n("div",{class:"sheet-cell handle flex align-center justify-center grab"},[n("i",{class:"pi pi-bars"})],-1),_e={class:"sheet-cell num flex align-center"},fe={class:"sheet-cell sheet-cell-long value flex align-center"},ge={class:"context block"},he={class:"sheet-cell sheet-cell-long value flex align-center"},xe={class:"context block"},be={class:"sheet-cell sheet-value-cell flex align-center"},ye={class:"text block"},Ce={class:"sheet-cell sheet-value-cell flex align-center"},ke={class:"text flex"},je={class:"button-wrapper flex justify-end"},Ee=te({setup(Be){var $;const{get:C,save:T}=ae(),{d:i,dr:d,images:o,data:s,useToggle:A}=K(),{submit:I,submitRowReorder:U,remove:k}=W(),{rcm:q,rcmOpened:E,isRCOn:P}=ne(s),{payload:j,content:v,progress:H,salon:t}=se(),m=c(!1),B=c("place_pin_image_input"),r=c(0),M=c(["\u5185\u5BB9","\u5834\u6240\u306E\u753B\u50CF"]),V=c(w),_=c(null),f=c(($=t.value)==null?void 0:$.map_places),O=c([{label:"\u65B0\u898F\u65BD\u8A2D",command:()=>{var a,e;o.value=[],_.value={id:null,order_id:null,salon:(a=t.value)==null?void 0:a.id,show_directions:!1,type:null,place:null,address:null,context:null,pin:null},V.value=w,A({method:"post",endpoints:["salons_places","salons/"+((e=t.value)==null?void 0:e.id)],state:"salon"})}},{label:"\u884C\u3092\u8907\u88FD\u3059\u308B",command:()=>{var e;v.value=!0;const a={order_id:f.value?f.value.length+1:1,salon:(e=t.value)==null?void 0:e.id,show_directions:s.value.show_directions,type:s.value.type,place:s.value.place,address:s.value.address,context:s.value.context};T("salons_places",a).then(()=>{var l;C("salons/"+((l=t.value)==null?void 0:l.id),"salon").then(()=>{v.value=!1})})}},{label:"\u884C\u3092\u524A\u9664\u3059\u308B",command:()=>{var a;v.value=!0,k("salons_places/"+((a=s.value)==null?void 0:a.id)).then(()=>{var e;C("salons/"+((e=t.value)==null?void 0:e.id),"salon").then(()=>{v.value=!1})})}}]);function L(a){var e,l;E.value||(o.value=a.pin?[{image:a.pin}]:[],V.value=w,_.value={id:null,order_id:null,salon:(e=t.value)==null?void 0:e.id,show_directions:!1,type:null,place:null,address:null,context:null,pin:null},A({method:"patch",endpoints:["salons_places/"+a.id,"salons/"+((l=t.value)==null?void 0:l.id)],state:"salon"},a))}function Q(a){var e;m.value=!0,j.value={method:"patch",endpoints:["salons_places/"+s.value.id,"salons/"+((e=t.value)==null?void 0:e.id)],state:"salon"},r.value===0?I({pin:null},null,"object").then(()=>{m.value=!1,o.value=[]}):r.value===1&&k("salons_places_images/"+a).then(()=>{m.value=!1,o.value=o.value.filter(l=>l.id!==a)})}function z(){var a;m.value=!0,k("salons_places/"+((a=s.value)==null?void 0:a.id)).then(()=>{var e;d.value=!1,C("salons/"+((e=t.value)==null?void 0:e.id),"salon").then(()=>{i.value=!1,m.value=!1})})}return D(()=>i.value,a=>{a||(r.value=0)}),D(()=>{var a;return(a=t.value)==null?void 0:a.map_places},a=>{f.value=a,a==null||a.forEach(e=>{var l;s.value&&s.value.id===e.id&&(s.value=e,r.value===0?o.value=e.pin?[{image:e.pin}]:[]:r.value===1&&(o.value=((l=e.map_place_images)==null?void 0:l.length)?e.map_place_images:[]))})}),D(()=>r.value,a=>{var e,l,h;a===0?(j.value={method:"patch",endpoints:["salons_places/"+s.value.id,"salons/"+((e=t.value)==null?void 0:e.id)],state:"salon"},B.value="place_pin_image_input",o.value=s.value.pin?[{image:s.value.pin}]:[],_.value={id:null,order_id:null,salon:(l=t.value)==null?void 0:l.id,show_directions:!1,type:null,place:null,address:null,context:null,pin:null}):(j.value={method:"post",endpoints:["salons_places_images","salons/"+((h=t.value)==null?void 0:h.id)],state:"salon"},B.value="place_image_input",_.value={id:null,map_place:s.value.id,image:null,thumbnail:null},o.value=s.value.map_place_images?s.value.map_place_images:[])}),(a,e)=>(y(),S("div",re,[p(X,{modelValue:u(v),"onUpdate:modelValue":e[0]||(e[0]=l=>g(v)?v.value=l:null)},null,8,["modelValue"]),n("div",ce,[ve,p(u(G),{tag:"div",onEnd:e[1]||(e[1]=l=>u(U)({value:f.value},{method:"post",endpoints:["salons_places","salons"],state:"salons"})),list:f.value,class:"sb-container ss-container",handle:".handle","item-key":"id"},{item:b(({element:l,index:h})=>[n("div",{onClick:x=>L(l),onContextmenu:x=>u(P)(x,l),"aria-haspopup":"true","aria-controls":"plan_rc_menu",class:"sheet-row flex align-center list-group-item relative pointer"},[p(u(J),{id:"rc_menu",ref_key:"rcm",ref:q,class:"rc has-final-action",model:O.value,popup:!0},null,8,["model"]),me,n("div",_e,F(h+1),1),n("div",fe,[n("span",ge,F(l.place),1)]),n("div",he,[n("span",xe,F(l.address),1)]),n("div",be,[n("span",ye,[l.pin?(y(),N(R,{key:0,svg:"image"})):oe("",!0)])]),n("div",Ce,[n("span",ke,[(y(!0),S(ie,null,de(l.map_place_images,x=>(y(),N(R,{style:{"margin-right":"5px"},key:x.id,svg:"image"}))),128))])])],40,pe)]),_:1},8,["list"])]),p(Y,{modelValue:u(i),"onUpdate:modelValue":e[8]||(e[8]=l=>g(i)?i.value=l:null),title:"\u65BD\u8A2D\u30D5\u30A9\u30FC\u30E0"},{default:b(()=>[p(le,{modelValue:u(i),"onUpdate:modelValue":e[2]||(e[2]=l=>g(i)?i.value=l:null),dr:u(d),"onUpdate:dr":e[3]||(e[3]=l=>g(d)?d.value=l:null),activeTab:r.value,"onUpdate:activeTab":e[4]||(e[4]=l=>r.value=l),topProgress:"",tabs:M.value,progress:u(H),form:V.value,data:u(s),loading:m.value,query:_.value,remove:!0,submit:u(I)},{default:b(()=>[p(ee,{containerId:B.value,images:u(o),remove:Q},null,8,["containerId","images"])]),_:1},8,["modelValue","dr","activeTab","tabs","progress","form","data","loading","query","submit"]),p(Z,{modelValue:u(d),"onUpdate:modelValue":e[7]||(e[7]=l=>g(d)?d.value=l:null)},{default:b(()=>[n("div",je,[n("button",{onClick:e[5]||(e[5]=l=>d.value=!1),class:"cancel"},"\u3044\u3044\u3048"),n("button",{onClick:e[6]||(e[6]=l=>z()),class:"delete"},"\u306F\u3044")])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]))}});export{Ee as default};
