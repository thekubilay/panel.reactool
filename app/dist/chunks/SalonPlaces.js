import{D as z}from"./vuedraggable.umd.js";import{s as G}from"./menu.esm.js";import{_ as J}from"./Dialog.js";import{S as K}from"./Spinner.js";import{_ as R}from"./Icon.js";import{_ as X}from"./DialogDelete.js";import{_ as Y}from"./ContextImagesThumbnailContainer.js";import{_ as Z}from"./FormQuery.js";import{u as ee,a as le}from"./useFormRequestBuilder.js";import{A as ae,u as se}from"../main.js";import{f as V}from"./FormSalonPlaces.js";import{u as ne}from"./useRightClickHandler.js";import{a as te,C as c,N as w,q as S,f as p,t as o,D as g,x as n,w as b,W as oe,b as y,A as F,e as q,v as ue,F as ie,E as re}from"./vendor.js";import"./overlayeventbus.esm.js";import"./plugin-vue_export-helper.js";import"./rules.js";const de={id:"salon-map",class:"panel-board"},ce={class:"spreadsheet-wrapper overflow-y"},ve=oe('<div class="sh-container ss-container"><div class="sheet-row sheet-row-header flex align-center"><div class="sheet-cell handle flex align-center"></div><div class="sheet-cell num flex align-center">\u9806\u756A</div><div class="sheet-cell sheet-cell-long value flex align-center">\u65BD\u8A2D\u540D</div><div class="sheet-cell sheet-cell-long value flex align-center">\u4F4F\u6240</div><div class="sheet-cell value flex align-center">PIN</div><div class="sheet-cell value flex align-center">\u65BD\u8A2D\u753B\u50CF</div></div></div>',1),pe=["onClick","onContextmenu"],me=n("div",{class:"sheet-cell handle flex align-center justify-center grab"},[n("i",{class:"pi pi-bars"})],-1),_e={class:"sheet-cell num flex align-center"},fe={class:"sheet-cell sheet-cell-long value flex align-center"},ge={class:"context block"},he={class:"sheet-cell sheet-cell-long value flex align-center"},xe={class:"context block"},be={class:"sheet-cell sheet-value-cell flex align-center"},ye={class:"text block"},Ce={class:"sheet-cell sheet-value-cell flex align-center"},je={class:"text flex"},De={class:"button-wrapper flex justify-end"},Oe=te({setup(ke){var $;const{get:C,save:E}=ae(),{d:i,dr:r,images:u,data:s,useToggle:A}=ee(),{submit:I,submitRowReorder:N,remove:j}=le(),{rcm:T,rcmOpened:U,isRCOn:P}=ne(s),{payload:D,content:v,progress:H,salon:t}=se(),m=c(!1),k=c("place_pin_image_input"),d=c(0),O=c(["\u5185\u5BB9","\u5834\u6240\u306E\u753B\u50CF"]),B=c(V),_=c(null),f=c(($=t.value)==null?void 0:$.map_places),L=c([{label:"\u65B0\u898F\u65BD\u8A2D",command:()=>{var a,e;u.value=[],_.value={id:null,order_id:null,salon:(a=t.value)==null?void 0:a.id,show_directions:!1,type:null,place:null,address:null,context:null,pin:null},B.value=V,A({method:"post",endpoints:["salons_places","salons/"+((e=t.value)==null?void 0:e.id)],state:"salon"})}},{label:"\u884C\u3092\u8907\u88FD\u3059\u308B",command:()=>{var e;v.value=!0;const a={order_id:f.value?f.value.length+1:1,salon:(e=t.value)==null?void 0:e.id,show_directions:s.value.show_directions,type:s.value.type,place:s.value.place,address:s.value.address,context:s.value.context};E("salons_places",a).then(()=>{var l;C("salons/"+((l=t.value)==null?void 0:l.id),"salon").then(()=>{v.value=!1})})}},{label:"\u884C\u3092\u524A\u9664\u3059\u308B",command:()=>{var a;v.value=!0,j("salons_places/"+((a=s.value)==null?void 0:a.id)).then(()=>{var e;C("salons/"+((e=t.value)==null?void 0:e.id),"salon").then(()=>{v.value=!1})})}}]);function M(a){var e,l;U.value||(u.value=a.pin?[{image:a.pin}]:[],B.value=V,_.value={id:null,order_id:null,salon:(e=t.value)==null?void 0:e.id,show_directions:!1,type:null,place:null,address:null,context:null,pin:null},A({method:"patch",endpoints:["salons_places/"+a.id,"salons/"+((l=t.value)==null?void 0:l.id)],state:"salon"},a))}function Q(a){var e;m.value=!0,D.value={method:"patch",endpoints:["salons_places/"+s.value.id,"salons/"+((e=t.value)==null?void 0:e.id)],state:"salon"},d.value===0?I({pin:null},null,"object").then(()=>{m.value=!1,u.value=[]}):d.value===1&&j("salons_places_images/"+a).then(()=>{m.value=!1,u.value=u.value.filter(l=>l.id!==a)})}function W(){var a;m.value=!0,j("salons_places/"+((a=s.value)==null?void 0:a.id)).then(()=>{var e;r.value=!1,C("salons/"+((e=t.value)==null?void 0:e.id),"salon").then(()=>{i.value=!1,m.value=!1})})}return w(()=>i.value,a=>{a||(d.value=0)}),w(()=>{var a;return(a=t.value)==null?void 0:a.map_places},a=>{f.value=a,a==null||a.forEach(e=>{var l;s.value&&s.value.id===e.id&&(s.value=e,d.value===0?u.value=e.pin?[{image:e.pin}]:[]:d.value===1&&(u.value=((l=e.map_place_images)==null?void 0:l.length)?e.map_place_images:[]))})}),w(()=>d.value,a=>{var e,l,h;a===0?(D.value={method:"patch",endpoints:["salons_places/"+s.value.id,"salons/"+((e=t.value)==null?void 0:e.id)],state:"salon"},k.value="place_pin_image_input",u.value=s.value.pin?[{image:s.value.pin}]:[],_.value={id:null,order_id:null,salon:(l=t.value)==null?void 0:l.id,show_directions:!1,type:null,place:null,address:null,context:null,pin:null}):(D.value={method:"post",endpoints:["salons_places_images","salons/"+((h=t.value)==null?void 0:h.id)],state:"salon"},k.value="place_image_input",_.value={id:null,map_place:s.value.id,image:null,thumbnail:null},u.value=s.value.map_place_images?s.value.map_place_images:[])}),(a,e)=>(y(),S("div",de,[p(K,{modelValue:o(v),"onUpdate:modelValue":e[0]||(e[0]=l=>g(v)?v.value=l:null)},null,8,["modelValue"]),n("div",ce,[ve,p(o(z),{tag:"div",onEnd:e[1]||(e[1]=l=>o(N)({value:f.value},{method:"post",endpoints:["salons_places","salons"],state:"salons"})),list:f.value,class:"sb-container ss-container",handle:".handle","item-key":"id"},{item:b(({element:l,index:h})=>[n("div",{onClick:x=>M(l),onContextmenu:x=>o(P)(x,l),"aria-haspopup":"true","aria-controls":"plan_rc_menu",class:"sheet-row flex align-center list-group-item relative pointer"},[p(o(G),{id:"rc_menu",ref_key:"rcm",ref:T,class:"rc has-final-action",model:L.value,popup:!0},null,8,["model"]),me,n("div",_e,F(h+1),1),n("div",fe,[n("span",ge,F(l.place),1)]),n("div",he,[n("span",xe,F(l.address),1)]),n("div",be,[n("span",ye,[l.pin?(y(),q(R,{key:0,svg:"image"})):ue("",!0)])]),n("div",Ce,[n("span",je,[(y(!0),S(ie,null,re(l.map_place_images,x=>(y(),q(R,{style:{"margin-right":"5px"},key:x.id,svg:"image"}))),128))])])],40,pe)]),_:1},8,["list"])]),p(J,{modelValue:o(i),"onUpdate:modelValue":e[8]||(e[8]=l=>g(i)?i.value=l:null),title:"\u65BD\u8A2D\u30D5\u30A9\u30FC\u30E0"},{default:b(()=>[p(Z,{modelValue:o(i),"onUpdate:modelValue":e[2]||(e[2]=l=>g(i)?i.value=l:null),dr:o(r),"onUpdate:dr":e[3]||(e[3]=l=>g(r)?r.value=l:null),activeTab:d.value,"onUpdate:activeTab":e[4]||(e[4]=l=>d.value=l),topProgress:"",tabs:O.value,progress:o(H),form:B.value,data:o(s),loading:m.value,query:_.value,remove:!0,submit:o(I)},{default:b(()=>[p(Y,{containerId:k.value,images:o(u),remove:Q},null,8,["containerId","images"])]),_:1},8,["modelValue","dr","activeTab","tabs","progress","form","data","loading","query","submit"]),p(X,{modelValue:o(r),"onUpdate:modelValue":e[7]||(e[7]=l=>g(r)?r.value=l:null)},{default:b(()=>[n("div",De,[n("button",{onClick:e[5]||(e[5]=l=>r.value=!1),class:"cancel"},"\u3044\u3044\u3048"),n("button",{onClick:e[6]||(e[6]=l=>W()),class:"delete"},"\u306F\u3044")])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]))}});export{Oe as default};
