import{d as J,D as m,o as W,F as E,b as w,k as i,u,l as _,w as r,e as a,M as X,N as Y,a3 as Z,a as j,U as I,c as ee,g as le,t as te,K as ue,L as ae}from"./vendor.js";import ie from"./dropdown.esm.js";import{s as oe}from"./menu.esm.js";import{s as se,a as q}from"./column.esm.js";import{_ as ne}from"./BarTool.js";import{u as re,a as de,S as pe,_ as R}from"./useFormRequestBuilder.js";import{b as ce,A as me,u as ve}from"../main.js";import{u as _e}from"./useRightClickHandler.js";import{_ as fe}from"./Icon.js";import{_ as ge}from"./FormQuery.js";import{_ as be}from"./ContextImagesThumbnailContainer.js";import{u as he}from"./useUtils.js";import{_ as je}from"./DialogDelete.js";import{_ as Ce}from"./FormNested.js";import"./overlayeventbus.esm.js";import"./virtualscroller.esm.js";const C=[[{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputNumber",db_column_name:"name",type:"text",model:null,label:"\u753B\u50CF\u756A\u53F7",hint:"\u4E26\u3073\u9806\u3067\u4F7F\u308F\u308C\u308B\u306E\u3067\u6570\u5B57\u3067\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044",placeholder:"\u30FC",required:!0,id:"name_input",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-2-space","relative"]},{component:null,name:"Dropdown",db_column_name:"building_vr_direction",type:"text",model:!1,label:"\u65B9\u5411",hint:null,required:!0,rules:[],id:"direction_input",disabled:!1,options:ce().project.building_vr.building_vr_directions,optionLabel:"name",optionValue:"id",placeholder:"\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-2-space","relative"]}]},{classes:["flex"],elements:[{component:null,name:"FileInput",db_column_name:"image",type:"text",model:null,label:"\u753B\u50CF",hint:".jpeg, .png \u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u3059",required:!1,id:"image_input",preview_text:"\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u306E\u305F\u3081\u3001\u30AF\u30EA\u30C3\u30AF\u3084\u753B\u50CF\u30C9\u30ED\u30C3\u30D7\u3057\u3066\u304F\u3060\u3055\u3044",limit:"1MB\u4EE5\u4E0B",accept:"image/*",rules:[],rule:null,disabled:!1,props:["placeholder","required","disabled","accept","hint","model","image_path","preview_text","limit","rule"],classes:["flex-column","column-1"]}]}]];const xe={id:"project_building_vr",class:"panel-board"},Be={class:"part-wrap"},Fe={class:"part-wrap part-end"},Ve={class:"spreadsheet-wrapper overflow-x"},ye=Z('<div class="sh-container ss-container"><div class="sheet-row sheet-row-header flex align-center"><div class="sheet-cell handle flex align-center"></div><div class="sheet-cell img flex align-center"><i class="pi pi-file"></i></div><div class="sheet-cell value sheet-cell-long flex align-center">\u753B\u50CF\u756A\u53F7</div></div></div>',1),Ee={class:"sb-container ss-container"},we=["onClick","onContextmenu"],ke=a("div",{class:"sheet-cell handle flex align-center handle grab"},null,-1),$e={class:"sheet-cell img flex align-center"},De={class:"sheet-cell num flex align-center"},Ae={class:"text block"},Ue={class:"button-wrapper flex justify-end"},Ie=["onUpdate:modelValue"],qe=["onClick"],Re=a("i",{class:"pi pi-times"},null,-1),Ne=[Re],Se={class:"action-wrapper flex align-center"},il=J({setup(Le){const{get:k,save:Oe}=me(),{submit:x,submitRowReorder:Te,remove:$}=re(),{d:v,d2:s,dr:d,data:g,images:B,useToggle:F}=de(),{rcm:N,rcmOpened:Me,isRCOn:S}=_e(g),{sortByAsc:L}=he(),{payload:D,content:b,progress:O,project:o}=ve(),f=m(0),h=m([]),V=m([]),p=m(!1),y=m(!1),c=m([]),A=m([]);W(()=>{var t,e;c.value=((t=o.value)==null?void 0:t.building_vr.building_vr_directions)||[],(e=o.value)==null||e.building_vr.building_vr_directions.forEach((l,n)=>{n===0&&(f.value=l.id),h.value.push({name:l.name,id:l.id})})});function T(){var t;y.value=!1,C[0][0].elements[1].disabled=!1,C[0][0].elements[1].model=f.value,F({method:"post",endpoints:["app/building_vr_direction_images","project_details/"+((t=o.value)==null?void 0:t.id)],state:"project"})}function M(t){var e;y.value=!0,C[0][0].elements[1].disabled=!0,B.value=t.image?[{image:t.image}]:[],F({method:"patch",endpoints:["app/building_vr_direction_images","project_details/"+((e=o.value)==null?void 0:e.id)],state:"project"},t)}function H(){p.value=!0,x({create:c.value,remove:A.value},null,"object").then(()=>{p.value=!1,s.value=!1})}function P(){var t;p.value=!0,$("app/building_vr_direction_images/"+((t=g.value)==null?void 0:t.id)).then(()=>{var e;d.value=!1,k("project_details/"+((e=o.value)==null?void 0:e.id),"project").then(()=>{v.value=!1,p.value=!1})})}function K(t){var e;p.value=!0,D.value={method:"patch",endpoints:["app/building_vr_direction_images/"+g.value.id,"project_details/"+((e=o.value)==null?void 0:e.id)],state:"project"},x({image:null,thumbnail:null},null,"object").then(()=>{p.value=!1,B.value=[]})}const Q=()=>{var e;const t={id:null,building_vr:((e=o.value)==null?void 0:e.building_vr.id)||null,order_id:null,name:"\u65B9\u5411"+(c.value.length+1)};c.value.push(t)},z=t=>{const e=c.value.filter((l,n)=>n!==t);c.value.forEach((l,n)=>{t===n&&l.id&&A.value.push(l)}),c.value=e},G=m([{label:"\u65B0\u898F\u753B\u50CF",command:()=>{var t;F({method:"post",endpoints:["app/building_vr_direction_images","project_details/"+((t=o.value)==null?void 0:t.id)],state:"project"})}},{label:"\u884C\u3092\u524A\u9664\u3059\u308B",command:()=>{var t;b.value=!0,$("app/building_vr_direction_images/"+((t=g.value)==null?void 0:t.id)).then(()=>{var e;k("project_details/"+((e=o.value)==null?void 0:e.id),"project").then(()=>{b.value=!1})})}}]);return E(()=>s.value,t=>{var e;t&&(D.value={method:"post",endpoints:["app/building_vr_directions","project_details/"+((e=o.value)==null?void 0:e.id)],state:"project"})}),E(()=>f.value,t=>{var e;(e=o.value)==null||e.building_vr.building_vr_directions.forEach(l=>{l.id===t&&(V.value=l.building_vr_direction_images||[])})}),E(()=>o.value,t=>{h.value=[],t==null||t.building_vr.building_vr_directions.forEach(e=>{e.id===f.value&&(V.value=e.building_vr_direction_images||[]),h.value.push({name:e.name,id:e.id})})}),(t,e)=>(j(),w("div",xe,[i(pe,{modelValue:u(b),"onUpdate:modelValue":e[0]||(e[0]=l=>_(b)?b.value=l:null)},null,8,["modelValue"]),i(ne,{class:"justify-space-between"},{default:r(()=>[a("div",Be,[i(u(I),{type:"button",class:"submit-button",icon:"pi pi-plus","icon-pos":"left",label:"\u65B0\u898F\u753B\u50CF",onClick:e[1]||(e[1]=l=>T())})]),a("div",Fe,[i(u(ie),{style:{"margin-left":"0",width:"120px"},class:"dropdown",modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=l=>f.value=l),options:h.value,optionLabel:"name",optionValue:"id",placeholder:"\u65B9\u5411\u9078\u629E"},null,8,["modelValue","options"]),i(u(I),{type:"button",class:"submit-button icon-button",icon:"pi pi-cog","icon-pos":"left",onClick:e[3]||(e[3]=l=>s.value=!0)})])]),_:1}),a("div",Ve,[ye,a("div",Ee,[(j(!0),w(X,null,Y(u(L)(V.value,"name"),(l,n)=>(j(),w("div",{key:n,onClick:U=>M(l),onContextmenu:U=>u(S)(U,l),"aria-haspopup":"true","aria-controls":"plan_rc_menu",class:"sheet-row flex align-center list-group-item relative pointer"},[i(u(oe),{id:"rc_menu",ref_for:!0,ref_key:"rcm",ref:N,class:"rc has-final-action",model:G.value,popup:!0},null,8,["model"]),ke,a("div",$e,[l.image?(j(),ee(fe,{key:0,svg:"image"})):le("",!0)]),a("div",De,[a("span",Ae,te(l.name),1)])],40,we))),128))])]),i(R,{modelValue:u(v),"onUpdate:modelValue":e[9]||(e[9]=l=>_(v)?v.value=l:null),title:"\u5916\u89B3\u753B\u50CF\u30D5\u30A9\u30FC\u30E0"},{default:r(()=>[i(ge,{modelValue:u(v),"onUpdate:modelValue":e[4]||(e[4]=l=>_(v)?v.value=l:null),dr:u(d),"onUpdate:dr":e[5]||(e[5]=l=>_(d)?d.value=l:null),"close-after":"",topProgress:"",progress:u(O),form:u(C),data:u(g),loading:p.value,remove:y.value,query:{project:u(o).id},submit:u(x)},{default:r(()=>[i(be,{containerId:"image_input",images:u(B),remove:K},null,8,["images"])]),_:1},8,["modelValue","dr","progress","form","data","loading","remove","query","submit"]),i(je,{modelValue:u(d),"onUpdate:modelValue":e[8]||(e[8]=l=>_(d)?d.value=l:null)},{default:r(()=>[a("div",Ue,[a("button",{onClick:e[6]||(e[6]=l=>d.value=!1),class:"cancel"},"\u3044\u3044\u3048"),a("button",{onClick:e[7]||(e[7]=l=>P()),class:"delete"},"\u306F\u3044")])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),i(R,{modelValue:u(s),"onUpdate:modelValue":e[14]||(e[14]=l=>_(s)?s.value=l:null),title:"\u65B9\u5411\u30D5\u30A9\u30FC\u30E0"},{default:r(()=>[i(Ce,{modelValue:u(s),"onUpdate:modelValue":e[13]||(e[13]=l=>_(s)?s.value=l:null),form:[[]],loading:p.value},{actions:r(()=>[a("div",Se,[a("button",{onClick:e[11]||(e[11]=l=>s.value=!1),class:"flex align-center justify-center cancel"},"\u4E2D\u6B62"),a("button",{onClick:e[12]||(e[12]=l=>H()),class:"flex align-center justify-center submit-or-next"},"\u767B\u9332")])]),default:r(()=>[i(u(se),{value:c.value,rowindex:"index",responsiveLayout:"scroll",class:"option-datatable"},{default:r(()=>[i(u(q),{field:"name",header:"\u9805\u76EE\u540D"},{body:r(l=>[ue(a("input",{class:"option-input",type:"text","onUpdate:modelValue":n=>l.data.name=n,placeholder:"\u9078\u629E\u9805\u76EE"},null,8,Ie),[[ae,l.data.name]])]),_:1}),i(u(q),{style:{width:"40px","text-align":"right","margin-left":"auto"},body:"index"},{body:r(l=>[a("span",{onClick:n=>z(l.index),class:"remove pointer"},Ne,8,qe)]),_:1})]),_:1},8,["value"]),a("button",{onClick:e[10]||(e[10]=l=>Q()),class:"add-option"},"\u65B9\u5411\u3092\u8FFD\u52A0\u3059\u308B")]),_:1},8,["modelValue","loading"])]),_:1},8,["modelValue"])]))}});export{il as default};
