import{d as S,u as z,r as v,a as se,w as R,c as o,b as c,e,n as j,f as a,g,h as te,i as A,o as l,j as le,k as W,l as X,m as Q,p as ie,v as ce,q as y,T as U,F as I,s as L,t as D,A as de,x as Y,y as O,z as N,B as pe,C as H,D as _e}from"../main.js";import{_ as me}from"./FormQuery.js";import{_ as ae}from"./Icon.js";import{_ as ve}from"./ButtonDropdown.js";import{o as ne,_ as G}from"./Dialog.js";import J from"./password.esm.js";import{S as fe}from"./Spinner.js";import{u as ue,a as he}from"./useFormRequestBuilder.js";import{f as we}from"./FormUserUpdate.js";import{u as ge}from"./useUtils.js";import"./plugin-vue_export-helper.js";import"./menu.esm.js";import"./portal.esm.js";import"./rules.js";const ye={class:"form form-password-change"},be=["onSubmit"],xe={class:"row column-1 flex justify-space-between"},ke={class:"flex-column column-2-space"},Ce=e("span",{class:"label flex"},[A("\u904E\u53BB\u306E\u30D1\u30B9\u30EF\u30FC\u30C9"),e("span",{class:"required flex align-start"},"*\u5FC5\u9808")],-1),Be={key:0,class:"invalid block"},$e={class:"row column-1 flex justify-space-between"},Fe={class:"flex-column column-2-space"},Ve=e("span",{class:"label flex"},[A("\u65B0\u898F\u30D1\u30B9\u30EF\u30FC\u30C9"),e("span",{class:"required flex align-start"},"*\u5FC5\u9808")],-1),De={key:0,class:"invalid block"},Ee={class:"row column-1 flex justify-space-between"},je={class:"flex-column column-2-space"},Ae=e("span",{class:"label flex"},[A("\u65B0\u898F\u30D1\u30B9\u30EF\u30FC\u30C9\u78BA\u8A8D"),e("span",{class:"required flex align-start"},"*\u5FC5\u9808")],-1),Pe={key:0,class:"invalid block"},Te={class:"action-wrapper flex align-center"},Ue=S({__name:"FormUserChangePassword",props:{modelValue:Boolean},emits:["update:modelValue"],setup(q,{emit:$}){const{submit:F}=ue(),{payload:k,user:B}=z(),h=v(!1),s=v([]),d=se({old_password:null,new_password:null,password_confirm:null});function b(){s.value=[],k.value={method:"patch",endpoints:["change_password",""],state:""},Object.keys(d).forEach(u=>{d[u]||s.value.push(u)}),d.new_password!==d.password_confirm&&s.value.push("new_password","password_confirm"),s.value.length?h.value=!1:F(d,[[]]).then(u=>{u.code===200?window.location.href="http://127.0.0.1:8000/accounts/login/":s.value.push("old_password"),h.value=!1})}return R(()=>d.old_password,u=>{s.value=s.value.filter(t=>t!=="old_password")}),R(()=>d.new_password,u=>{s.value=s.value.filter(t=>t!=="new_password")}),R(()=>d.password_confirm,u=>{s.value=s.value.filter(t=>t!=="password_confirm")}),(u,t)=>(l(),o("div",ye,[c(fe,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=i=>h.value=i),text:""},null,8,["modelValue"]),e("form",{action:"",onSubmit:te(i=>!1,["prevent"])},[e("div",xe,[e("div",ke,[Ce,c(a(J),{class:j({error:s.value.includes("old_password")}),modelValue:d.old_password,"onUpdate:modelValue":t[1]||(t[1]=i=>d.old_password=i),toggleMask:"",feedback:!1},null,8,["class","modelValue"]),s.value.includes("old_password")?(l(),o("span",Be,"\u904E\u53BB\u306E\u30D1\u30B9\u30EF\u30FC\u30C9\u3092\u6B63\u3057\u304F\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044")):g("",!0)])]),e("div",$e,[e("div",Fe,[Ve,c(a(J),{class:j({error:s.value.includes("new_password")}),modelValue:d.new_password,"onUpdate:modelValue":t[2]||(t[2]=i=>d.new_password=i),toggleMask:"",appendTo:"self"},null,8,["class","modelValue"]),s.value.includes("new_password")?(l(),o("span",De,"\u65B0\u898F\u306E\u30D1\u30B9\u30EF\u30FC\u30C9\u3092\u6B63\u3057\u304F\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044")):g("",!0)])]),e("div",Ee,[e("div",je,[Ae,c(a(J),{class:j({error:s.value.includes("password_confirm")}),modelValue:d.password_confirm,"onUpdate:modelValue":t[3]||(t[3]=i=>d.password_confirm=i),toggleMask:"",feedback:!1},null,8,["class","modelValue"]),s.value.includes("password_confirm")?(l(),o("span",Pe,"\u65B0\u898F\u78BA\u8A8D\u306E\u30D1\u30B9\u30EF\u30FC\u30C9\u3092\u6B63\u3057\u304F\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044")):g("",!0)])]),e("div",Te,[e("button",{onClick:t[4]||(t[4]=i=>$("update:modelValue",!1)),class:"flex align-center justify-center cancel"},"\u4E2D\u6B62"),e("button",{onClick:t[5]||(t[5]=i=>b()),class:"flex align-center justify-center submit-or-next"},"\u767B\u9332")])],40,be)]))}});const Se={class:"app-filter-wrapper relative"},qe={class:"input-wrapper relative"},Me=e("i",{class:"pi pi-search"},null,-1),Ne={class:"dropdown-wrapper"},He={key:0,class:"dropdown"},Re={key:0,class:"empty-text flex-column align-center justify-center"},Ie=e("span",{class:"text block"},"\u7D50\u679C\u306A\u3057",-1),Le=["onClick"],Oe={class:"text block"},ze=e("span",{class:"arrow-wrap flex justify-center"},[e("i",{class:"pi pi-arrow-right flex"})],-1),Ke=S({__name:"FilterApp",setup(q){const{projects:$,salons:F}=z(),k=le(),B=W(),h=v(!1),s=v(),d=v(""),b=v([]),u=v([]);X(()=>{var _;s.value=document.getElementById("afi"),(_=s.value)==null||_.addEventListener("keydown",i),F.value.forEach(p=>{const m={id:p.id,path:null,name:p.name.replaceAll("<br>",""),type:"salon"};b.value.push(m)}),$.value.forEach(p=>{const m={id:p.id,path:null,name:p.name.replaceAll("<br>",""),type:"project"};b.value.push(m)})});const t=Q({set(_){u.value=b.value.filter(p=>p.name.match(_))},get(){return d.value}});function i(_){_&&_.keyCode===27&&(h.value=!1)}function P(_){_.type==="salon"?k.push({name:"SalonProjects",params:{cid:B.params.cid,dynid:_.id}}).then(()=>{h.value=!1,d.value=""}):_.type==="project"&&k.push({name:"ProjectPlaces",params:{cid:B.params.cid,dynid:_.id}}).then(()=>{h.value=!1,d.value=""})}return ne(s,_=>{h.value=!1}),(_,p)=>(l(),o("div",Se,[e("div",qe,[Me,ie(e("input",{id:"afi",onClick:p[0]||(p[0]=m=>h.value=!h.value),type:"text","onUpdate:modelValue":p[1]||(p[1]=m=>t.value=m),placeholder:"\u691C\u7D22"},null,512),[[ce,t.value]])]),e("div",Ne,[c(U,{name:"slideDown"},{default:y(()=>[h.value?(l(),o("ul",He,[u.value.length?g("",!0):(l(),o("li",Re,[c(ae,{svg:"empty",width:"24px"}),Ie])),(l(!0),o(I,null,L(u.value,(m,x)=>(l(),o("li",{key:x,onClick:E=>P(m),class:"dropdown-item flex align-center pointer"},[e("span",Oe,D(m.name),1),A(),ze],8,Le))),128))])):g("",!0)]),_:1})])]))}});const Ge={id:"bar_app",class:"container flex justify-space-between"},Je={class:"bar-app-brand"},Qe={class:"bar-app-global-filter flex align-center"},We={class:"bar-app-global-actions flex justify-end"},Xe=e("i",{class:"pi pi-question-circle"},null,-1),Ye={key:0,class:"badge flex align-center justify-center text-center"},Ze=e("div",{class:"header flex align-center"},[e("h3",{class:"ht"},"\u901A\u77E5")],-1),es={class:"body relative"},ss=["onClick"],ts={class:"content"},ls={class:"date"},as={class:"title"},ns={class:"content"},us={key:0,class:"unseen block relative"},os=e("span",{class:"badge"},null,-1),rs=[os],is=["onClick"],cs=e("span",{class:"remove flex align-center justify-center"},[e("i",{class:"pi pi-trash"})],-1),ds=[cs],ps={key:0,class:"empty flex align-center justify-center"},_s={class:"d-content-header flex align-center justify-end"},ms={class:"d-content-body"},vs=["innerHTML"],fs=S({__name:"BarAppPanel",setup(q){const $=W(),F=le(),{get:k}=de(),{submit:B,remove:h}=ue(),{user:s,onload:d,progress:b,payload:u}=z(),{d:t,d2:i,useToggle:P}=he(),_=se({id:null,first_name:null,last_name:null,email:null,username:null}),p=v(0),m=v(!1),x=v(0),E=v(),f=v(!1),T=v(null),K=v([{label:"\u30D7\u30ED\u30D5\u30A3\u30FC\u30EB",icon:"pi pi-user",command:()=>{var w;P({method:"patch",endpoints:["users/"+((w=s.value)==null?void 0:w.id),"users/current"],state:"user"})}},{label:"\u30D1\u30B9\u30EF\u30FC\u30C9\u66F4\u65B0",icon:"pi pi-lock",command:()=>{i.value=!0}},{label:"\u7BA1\u7406\u30D1\u30CD\u30EB",icon:"pi pi-cog",command:()=>{F.push({name:"Admin"})}},{label:"\u30ED\u30B0\u30A2\u30A6\u30C8",icon:"pi pi-sign-out",command:()=>location.href="https://panel.reactool.jp/accounts/logout/"}]),oe=w=>{T.value=w,f.value=!0,m.value=!1,w.seen||(u.value={method:"patch",endpoints:["user-news/"+w.id,"users/current"],state:"user"},B({seen:!0},null,"object").then(()=>{setTimeout(()=>{var n;p.value=((n=s.value)==null?void 0:n.news.filter(C=>!C.seen).length)||0},1e3)}))},re=w=>{h("user-news/"+w).then(()=>{k("users/current","user").then(n=>{var C;p.value=((C=n.news)==null?void 0:C.filter(V=>!V.seen).length)||0})})};return X(()=>{var w,n,C;p.value=((w=s.value)==null?void 0:w.news.filter(V=>!V.seen).length)||0,!((n=s.value)!=null&&n.is_superuser)&&!((C=s.value)!=null&&C.is_staff)&&(K.value=K.value.filter(V=>V.label!=="\u7BA1\u7406\u30D1\u30CD\u30EB"))}),ne(E,w=>{m.value=!1}),R(()=>x.value,w=>{var n;w===0?u.value={method:"patch",endpoints:["users/"+((n=s.value)==null?void 0:n.id),"users/current"],state:"user"}:u.value={method:"patch",endpoints:["users","users/current"],state:"user"}}),(w,n)=>{var V,Z;const C=Y("router-link");return l(),o("header",Ge,[e("div",Je,[c(C,{class:"brand flex align-center",to:{name:"Dashboard",params:{cid:a(s).company}}},{default:y(()=>[c(ae,{svg:"reactool",width:"100px"})]),_:1},8,["to"])]),e("div",Qe,[c(Ke)]),e("div",We,[a(s).is_superuser?(l(),O(C,{key:0,class:"tutorials flex align-center justify-center",to:{name:"BoardTutorials",params:{cid:a($).params.cid}}},{default:y(()=>[Xe]),_:1},8,["to"])):g("",!0),e("button",{onClick:n[0]||(n[0]=r=>m.value=!m.value),class:"news-button flex align-center justify-center relative"},[p.value>0?(l(),o("span",Ye,D(p.value),1)):g("",!0),e("i",{class:j(["pi pi-bell",{active:p.value>0}])},null,2)]),c(U,{name:"fade"},{default:y(()=>[m.value?(l(),o("div",{key:0,class:"news",ref_key:"newsOutside",ref:E},[Ze,e("div",es,[(l(!0),o(I,null,L(a(s).news,r=>(l(),o("div",{class:"row flex align-center",onClick:M=>oe(r)},[e("div",ts,[e("span",ls,D(r.created_at.substring(0,10)),1),e("h4",as,D(r.title),1),e("div",ns,D(r.content.replace(/<[^>]*>?/gm,"").substring(0,50)),1)]),r.seen?g("",!0):(l(),o("div",us,rs)),r.seen?(l(),o("div",{key:1,onClick:te(M=>re(r.id),["stop"]),class:"unseen flex align-center justify-center relative"},ds,8,is)):g("",!0)],8,ss))),256)),a(s).news.length?g("",!0):(l(),o("div",ps,"\u7A7A"))])],512)):g("",!0)]),_:1}),c(ve,{id:"user_menu",final:"",label:(V=a(s))==null?void 0:V.username,items:K.value},null,8,["label","items"])]),c(G,{modelValue:a(t),"onUpdate:modelValue":n[3]||(n[3]=r=>N(t)?t.value=r:null),title:(Z=a(s))==null?void 0:Z.username},{default:y(()=>[c(me,{modelValue:a(t),"onUpdate:modelValue":n[1]||(n[1]=r=>N(t)?t.value=r:null),"active-tab":x.value,"onUpdate:activeTab":n[2]||(n[2]=r=>x.value=r),"close-after":"",topProgress:"",progress:a(b),form:a(we),onload:a(d),data:a(s),query:_,submit:a(B)},null,8,["modelValue","active-tab","progress","form","onload","data","query","submit"])]),_:1},8,["modelValue","title"]),c(G,{modelValue:a(i),"onUpdate:modelValue":n[5]||(n[5]=r=>N(i)?i.value=r:null),title:"\u30D1\u30B9\u30EF\u30FC\u30C9\u66F4\u65B0"},{default:y(()=>[c(Ue,{modelValue:a(i),"onUpdate:modelValue":n[4]||(n[4]=r=>N(i)?i.value=r:null)},null,8,["modelValue"])]),_:1},8,["modelValue"]),c(G,{modelValue:f.value,"onUpdate:modelValue":n[6]||(n[6]=r=>f.value=r),title:T.value&&T.value.title,overflow:""},{default:y(()=>{var r,M,ee;return[e("div",_s,D((M=(r=T.value)==null?void 0:r.created_at)==null?void 0:M.substring(0,10)),1),e("div",ms,[e("div",{innerHTML:(ee=T.value)==null?void 0:ee.content},null,8,vs)])]}),_:1},8,["modelValue","title"])])}}});const hs={id:"sidebar_app"},ws={class:"ctr2 overflow-y"},gs={key:0,class:"body custom-sb custom-sb-invert"},ys={key:0,class:"body custom-sb custom-sb-invert"},bs=S({__name:"SidebarAppPanel",setup(q){const{user:$,salons:F,projects:k,project:B,content:h}=z(),{setColorById:s,groupBy:d}=ge(),b=W(),u=v(!1),t=v(!0),i=v(),P=Q(()=>u.value?u.value&&!t.value?"auto":"50%":"40px"),_=Q(()=>t.value?t.value&&!u.value?"calc(100% - 40px)":"50%":"40px"),p=(m,x)=>"ProjectPlaces";return X(()=>{pe(),i.value=document.getElementsByClassName("nav-item")}),(m,x)=>{const E=Y("router-link");return l(),o("div",hs,[e("nav",null,[e("div",ws,[a($).is_superuser?(l(),o("div",{key:0,class:"part part1",style:H({height:P.value})},[e("div",{onClick:x[0]||(x[0]=f=>u.value=!u.value),class:"header pointer"},[A(" \u30B5\u30ED\u30F3 "),e("i",{style:{top:"1px"},class:j("pi pi-angle-"+(u.value?"up":"down"))},null,2)]),c(U,{name:"slideDown"},{default:y(()=>[u.value?(l(),o("div",gs,[(l(!0),o(I,null,L(a(F),f=>(l(),O(E,{key:f.id,to:{name:"SalonProjects",params:{cid:a(b).params.cid,dynid:f.id}},class:"nav-item flex align-center","active-class":"active"},{default:y(()=>[e("span",{class:"color block",style:H({backgroundColor:a(s)(f.id)})},null,4),e("div",null,D(f.name),1)]),_:2},1032,["to"]))),128))])):g("",!0)]),_:1})],4)):g("",!0),e("div",{class:"part part2",style:H({height:_.value})},[e("div",{onClick:x[1]||(x[1]=f=>t.value=!t.value),class:"header pointer"},[A(" \u30D7\u30ED\u30B8\u30A7\u30AF\u30C8 "),e("i",{style:{top:"1px"},class:j("pi pi-angle-"+(t.value?"up":"down"))},null,2)]),c(U,{name:"slideDown"},{default:y(()=>[t.value?(l(),o("div",ys,[(l(!0),o(I,null,L(a(k),f=>(l(),O(E,{key:f.id,to:{name:p(f.id,a(b).name+""),params:{cid:a(b).params.cid,dynid:f.id}},class:"p-nav-item nav-item flex align-center","active-class":"active"},{default:y(()=>[e("span",{class:"color block",style:H({backgroundColor:a(s)(f.id)})},null,4),e("div",null,D(f.name.replaceAll("<br>","")),1)]),_:2},1032,["to"]))),128))])):g("",!0)]),_:1})],4)])])])}}}),xs={class:"mrw"},ks={class:"flex column-1"},Cs={class:"column-1 flex"},Ns=S({__name:"index",setup(q){return($,F)=>{const k=Y("router-view");return l(),o("div",xs,[c(fs,{class:"bar-board container flex align-center"}),e("main",ks,[e("div",Cs,[c(bs),c(k,{class:"contents column-1"},{default:y(({Component:B})=>[c(U,{name:"fade",mode:"out-in"},{default:y(()=>[(l(),O(_e(B)))]),_:2},1024)]),_:1})])])])}}});export{Ns as default};
