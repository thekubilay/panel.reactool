import{a as G,p as i,o as J,t as y,v as w,f as a,z as u,H as m,w as v,x as t,a4 as W,E as X,D as Y,b as x,S as k,K as _,e as Z,A as V,B as ee}from"./vendor.js";import{D as le}from"./vuedraggable.umd.js";import se from"./dropdown.esm.js";import{s as te}from"./menu.esm.js";import{u as ue,a as oe,_ as ae}from"./useFormRequestBuilder.js";import{_ as ne}from"./FormQuery.js";import{_ as ie}from"./DialogDelete.js";import{S as re}from"./Spinner.js";import{_ as de}from"./BarTool.js";import{_ as ce}from"./Icon.js";import{a as pe,A as me,u as fe}from"../main.js";import{u as ve}from"./useRightClickHandler.js";import{f as _e}from"./rules.js";import{u as he}from"./useUtils.js";import"./overlayeventbus.esm.js";import"./virtualscroller.esm.js";import"./plugin-vue_export-helper.js";var $;const g=[[{classes:["flex"],elements:[{component:null,name:"Dropdown",db_column_name:"document_folder",type:"text",model:null,label:"\u30D5\u30A9\u30EB\u30C0\u30FC",hint:null,required:!1,rules:[],id:"folder_input",disabled:!1,options:(($=pe().project)==null?void 0:$.document_folders)||[],optionLabel:"name",optionValue:"id",placeholder:"\u30D5\u30A9\u30EB\u30C0\u30FC\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-1","relative"]}]},{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputText",db_column_name:"name",type:"text",model:null,label:"\u30D5\u30A1\u30A4\u30EB\u540D",hint:null,placeholder:"\u30D1\u30F3\u30D5\u30EC\u30C3\u30C8",required:!0,id:"name_input",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-1"]}]},{classes:["flex"],elements:[{component:null,name:"FileInput",db_column_name:"file",type:"text",model:null,label:"\u30D5\u30A1\u30A4\u30EB",hint:".pdf \u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u3059",required:!1,id:"file_input",preview_text:"\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u306E\u305F\u3081\u3001\u30AF\u30EA\u30C3\u30AF\u3084\u753B\u50CF\u30C9\u30ED\u30C3\u30D7\u3057\u3066\u304F\u3060\u3055\u3044",limit:"1MB\u4EE5\u4E0B",accept:"file/*",rules:[_e],rule:null,disabled:!1,props:["placeholder","required","disabled","accept","hint","model","preview_text","limit"],classes:["flex-column","column-1"]}]}]];const be={id:"project_documents",class:"panel-board"},Ce={class:"part-wrap"},xe={class:"part-wrap part-end"},ge={class:"spreadsheet-wrapper overflow-x"},je=W('<div class="sh-container ss-container"><div class="sheet-row sheet-row-header flex align-center"><div class="sheet-cell handle flex align-center"></div><div class="sheet-cell num flex align-center">\u9806\u756A</div><div class="sheet-cell img flex align-center"><i class="pi pi-file"></i></div><div class="sheet-cell value sheet-cell-long flex align-center">\u66F8\u985E\u540D</div><div class="sheet-cell value flex align-center">\u30BF\u30A4\u30D7</div><div class="sheet-cell value flex align-center">\u30B5\u30A4\u30BA</div><div class="sheet-cell value flex align-center">\u66F8\u985E\u30DA\u30FC\u30B8</div></div></div>',1),Fe=["onClick","onContextmenu"],De=t("div",{class:"sheet-cell handle flex align-center handle grab"},[t("i",{class:"pi pi-bars"})],-1),Ee={class:"sheet-cell num flex align-center"},Be={class:"text block"},Ae={class:"sheet-cell img flex align-center"},ye={class:"sheet-cell value sheet-cell-long flex align-center"},we={class:"text block"},ke={class:"sheet-cell value flex align-center"},Ve={class:"text block"},$e={class:"sheet-cell value flex align-center"},qe={class:"text block"},Re=["onClick"],Se={key:0,style:{color:"blue","text-decoration":"underline"},class:"text block"},Ue={class:"button-wrapper flex justify-end"},ul=G({setup(Ie){const j=X(),q=Y(),{get:F,save:Ne}=me(),{submit:R,submitRowReorder:S,remove:D}=ue(),{d:r,dr:n,data:f,useToggle:h}=oe(),{rcm:U,rcmOpened:Pe,isRCOn:I}=ve(f),{formatBytes:N}=he(),{payload:Te,content:c,progress:P,project:o}=fe(),b=i(!1),E=i(!1),d=i(0),B=i([{name:"\u30D5\u30A9\u30EB\u30C0\u30FC\u306A\u3057",id:0}]),p=i([]),A=i(g);i(),J(()=>{var s,e;B.value=[{name:"\u30D5\u30A9\u30EB\u30C0\u30FC\u306A\u3057",id:0},...(s=o.value)==null?void 0:s.document_folders],p.value=(e=o.value)==null?void 0:e.documents.filter(l=>l.document_folder===null)});function T(s){s.file&&window.open(s.file)}function H(s){s.forEach(e=>{var l;e[0].elements[0].model=0,e[0].elements[0].options=[{name:"NO \u30D5\u30A9\u30EB\u30C0\u30FC",id:0},...(l=o.value)==null?void 0:l.document_folders]})}function M(){q.push({name:"ProjectDocumentsFolders",params:{cid:j.params.cid,dynid:j.params.dynid}})}function L(){var s;b.value=!1,H(g),A.value=g,h({method:"post",endpoints:["app/documents","project_details/"+((s=o.value)==null?void 0:s.id)],state:"project"})}function O(s){var e;b.value=!0,h({method:"patch",endpoints:["app/documents/"+s.id,"project_details/"+((e=o.value)==null?void 0:e.id)],state:"project"},s)}function z(){var s;E.value=!0,D("app/documents/"+((s=f.value)==null?void 0:s.id)).then(()=>{var e;n.value=!1,F("project_details/"+((e=o.value)==null?void 0:e.id),"project").then(()=>{r.value=!1,E.value=!1})})}const K=i([{label:"\u65B0\u898F\u66F8\u985E",command:()=>{var s;h({method:"post",endpoints:["app/documents","project_details/"+((s=o.value)==null?void 0:s.id)],state:"project"})}},{label:"\u884C\u3092\u524A\u9664\u3059\u308B",command:()=>{var s;c.value=!0,D("app/documents/"+((s=f.value)==null?void 0:s.id)).then(()=>{var e;F("project_details/"+((e=o.value)==null?void 0:e.id),"project").then(()=>{c.value=!1})})}}]);return y(()=>o.value,s=>{p.value=s==null?void 0:s.documents.filter(e=>d.value!==0?e.document_folder===d.value:!e.document_folder)}),y(()=>d.value,s=>{var e;p.value=(e=o.value)==null?void 0:e.documents.filter(l=>d.value!==0?l.document_folder===d.value:!l.document_folder)}),(s,e)=>(x(),w("div",be,[a(re,{modelValue:u(c),"onUpdate:modelValue":e[0]||(e[0]=l=>m(c)?c.value=l:null)},null,8,["modelValue"]),a(de,{class:"justify-space-between"},{default:v(()=>[t("div",Ce,[a(u(k),{type:"button",class:"submit-button",icon:"pi pi-plus","icon-pos":"left",label:"\u66F8\u985E\u3092\u8FFD\u52A0",onClick:e[1]||(e[1]=l=>L())})]),t("div",xe,[a(u(se),{style:{"margin-left":"0",width:"150px"},class:"dropdown",modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=l=>d.value=l),options:B.value,optionLabel:"name",optionValue:"id",placeholder:"\u30D5\u30A9\u30EB\u30C0\u30FC\u9078\u629E"},null,8,["modelValue","options"]),a(u(k),{onClick:e[3]||(e[3]=l=>M()),type:"button",class:"tool-button",label:"\u30D5\u30A9\u30EB\u30C0\u30FC\u4F5C\u6210\u3078"})])]),_:1}),t("div",ge,[je,a(u(le),{tag:"div",onEnd:e[4]||(e[4]=l=>u(S)({value:p.value},{method:"post",endpoints:["app/documents","project_details/"+u(o).id],state:"project"})),list:p.value,class:"sb-container ss-container",handle:".handle","item-key":"id"},{item:v(({element:l,index:Q})=>[t("div",{onClick:C=>O(l),onContextmenu:C=>u(I)(C,l),"aria-haspopup":"true","aria-controls":"plan_rc_menu",class:"sheet-row flex align-center list-group-item relative pointer"},[a(u(te),{id:"rc_menu",ref_key:"rcm",ref:U,class:"rc has-final-action",model:K.value,popup:!0},null,8,["model"]),De,t("div",Ee,[t("span",Be,_(Q+1),1)]),t("div",Ae,[l.file?(x(),Z(ce,{key:0,svg:"pdf"})):V("",!0)]),t("div",ye,[t("span",we,_(l.name),1)]),t("div",ke,[t("span",Ve,_(l.type),1)]),t("div",$e,[t("span",qe,_(u(N)(l.size)),1)]),t("div",{onClick:ee(C=>T(l),["stop"]),class:"sheet-cell value flex align-center"},[l.file?(x(),w("span",Se,"\u66F8\u985E\u3092\u307F\u308B")):V("",!0)],8,Re)],40,Fe)]),_:1},8,["list"])]),a(ae,{modelValue:u(r),"onUpdate:modelValue":e[10]||(e[10]=l=>m(r)?r.value=l:null),title:"\u66F8\u985E\u30D5\u30A9\u30FC\u30E0"},{default:v(()=>[a(ne,{modelValue:u(r),"onUpdate:modelValue":e[5]||(e[5]=l=>m(r)?r.value=l:null),dr:u(n),"onUpdate:dr":e[6]||(e[6]=l=>m(n)?n.value=l:null),"close-after":"",topProgress:"",progress:u(P),form:A.value,data:u(f),remove:b.value,query:{project:u(o).id},submit:u(R)},null,8,["modelValue","dr","progress","form","data","remove","query","submit"]),a(ie,{modelValue:u(n),"onUpdate:modelValue":e[9]||(e[9]=l=>m(n)?n.value=l:null)},{default:v(()=>[t("div",Ue,[t("button",{onClick:e[7]||(e[7]=l=>n.value=!1),class:"cancel"},"\u3044\u3044\u3048"),t("button",{onClick:e[8]||(e[8]=l=>z()),class:"delete"},"\u306F\u3044")])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]))}});export{ul as default};
