import{K as J,d as Q,k as W,j as X,A as Y,u as Z,r as i,l as ee,w,c as j,b as a,f as s,z as m,q as v,e as u,a2 as le,o as x,M as k,t as _,y as te,g as V,h as ue}from"../main.js";import{D as se}from"./vuedraggable.umd.js";import{s as oe}from"./dropdown.esm.js";import{s as ae}from"./menu.esm.js";import{_ as ne}from"./Dialog.js";import{_ as ie}from"./FormQuery.js";import{_ as re}from"./DialogDelete.js";import{S as de}from"./Spinner.js";import{_ as ce}from"./BarTool.js";import{_ as pe}from"./Icon.js";import{u as me,a as fe}from"./useFormRequestBuilder.js";import{u as ve}from"./useRightClickHandler.js";import{f as _e}from"./rules.js";import{u as he}from"./useUtils.js";import"./_commonjsHelpers.js";import"./index.esm.js";import"./virtualscroller.esm.js";import"./portal.esm.js";import"./plugin-vue_export-helper.js";var $;const g=[[{classes:["flex"],elements:[{component:null,name:"Dropdown",db_column_name:"document_folder",type:"text",model:null,label:"\u30D5\u30A9\u30EB\u30C0\u30FC",hint:null,required:!1,rules:[],id:"folder_input",disabled:!1,options:(($=J().project)==null?void 0:$.document_folders)||[],optionLabel:"name",optionValue:"id",placeholder:"\u30D5\u30A9\u30EB\u30C0\u30FC\u9078\u629E",appendTo:"body",props:["placeholder","required","disabled","options","optionLabel","optionValue","appendTo"],classes:["flex-column","column-1","relative"]}]},{classes:["flex","justify-space-between"],elements:[{component:null,name:"InputText",db_column_name:"name",type:"text",model:null,label:"\u30D5\u30A1\u30A4\u30EB\u540D",hint:null,placeholder:"\u30D1\u30F3\u30D5\u30EC\u30C3\u30C8",required:!0,id:"name_input",rules:[],disabled:!1,props:["placeholder","required","disabled"],classes:["flex-column","column-1"]}]},{classes:["flex"],elements:[{component:null,name:"FileInput",db_column_name:"file",type:"text",model:null,label:"\u30D5\u30A1\u30A4\u30EB",hint:".pdf \u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u3059",required:!1,id:"file_input",preview_text:"\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u306E\u305F\u3081\u3001\u30AF\u30EA\u30C3\u30AF\u3084\u753B\u50CF\u30C9\u30ED\u30C3\u30D7\u3057\u3066\u304F\u3060\u3055\u3044",limit:"1MB\u4EE5\u4E0B",accept:"file/*",rules:[_e],rule:null,disabled:!1,props:["placeholder","required","disabled","accept","hint","model","preview_text","limit"],classes:["flex-column","column-1"]}]}]];const Ce={id:"project_documents",class:"panel-board"},be={class:"part-wrap"},xe={class:"part-wrap part-end"},ge={class:"spreadsheet-wrapper overflow-x"},Fe=le('<div class="sh-container ss-container"><div class="sheet-row sheet-row-header flex align-center"><div class="sheet-cell handle flex align-center"></div><div class="sheet-cell num flex align-center">\u9806\u756A</div><div class="sheet-cell img flex align-center"><i class="pi pi-file"></i></div><div class="sheet-cell value sheet-cell-long flex align-center">\u66F8\u985E\u540D</div><div class="sheet-cell value flex align-center">\u30BF\u30A4\u30D7</div><div class="sheet-cell value flex align-center">\u30B5\u30A4\u30BA</div><div class="sheet-cell value flex align-center">\u66F8\u985E\u30DA\u30FC\u30B8</div></div></div>',1),De=["onClick","onContextmenu"],Ee=u("div",{class:"sheet-cell handle flex align-center handle grab"},[u("i",{class:"pi pi-bars"})],-1),Ae={class:"sheet-cell num flex align-center"},ye={class:"text block"},Be={class:"sheet-cell img flex align-center"},we={class:"sheet-cell value sheet-cell-long flex align-center"},je={class:"text block"},ke={class:"sheet-cell value flex align-center"},Ve={class:"text block"},$e={class:"sheet-cell value flex align-center"},qe={class:"text block"},Re=["onClick"],Ue={key:0,style:{color:"blue","text-decoration":"underline"},class:"text block"},Ne={class:"button-wrapper flex justify-end"},al=Q({__name:"ProjectDocuments",setup(Pe){const F=W(),q=X(),{get:D,save:Se}=Y(),{submit:R,submitRowReorder:U,remove:E}=me(),{d:r,dr:n,data:f,useToggle:h}=fe(),{rcm:N,rcmOpened:Ie,isRCOn:P}=ve(f),{formatBytes:S}=he(),{payload:Me,content:c,progress:I,project:o}=Z(),C=i(!1),A=i(!1),d=i(0),y=i([{name:"\u30D5\u30A9\u30EB\u30C0\u30FC\u306A\u3057",id:0}]),p=i([]),B=i(g);i(),ee(()=>{var t,e;y.value=[{name:"\u30D5\u30A9\u30EB\u30C0\u30FC\u306A\u3057",id:0},...(t=o.value)==null?void 0:t.document_folders],p.value=(e=o.value)==null?void 0:e.documents.filter(l=>l.document_folder===null)});function M(t){t.file&&window.open(t.file)}function T(t){t.forEach(e=>{var l;e[0].elements[0].model=0,e[0].elements[0].options=[{name:"NO \u30D5\u30A9\u30EB\u30C0\u30FC",id:0},...(l=o.value)==null?void 0:l.document_folders]})}function L(){q.push({name:"ProjectDocumentsFolders",params:{cid:F.params.cid,dynid:F.params.dynid}})}function O(){var t;C.value=!1,T(g),B.value=g,h({method:"post",endpoints:["app/documents","project_details/"+((t=o.value)==null?void 0:t.id)],state:"project"})}function z(t){var e;C.value=!0,h({method:"patch",endpoints:["app/documents/"+t.id,"project_details/"+((e=o.value)==null?void 0:e.id)],state:"project"},t)}function H(){var t;A.value=!0,E("app/documents/"+((t=f.value)==null?void 0:t.id)).then(()=>{var e;n.value=!1,D("project_details/"+((e=o.value)==null?void 0:e.id),"project").then(()=>{r.value=!1,A.value=!1})})}const K=i([{label:"\u65B0\u898F\u66F8\u985E",command:()=>{var t;h({method:"post",endpoints:["app/documents","project_details/"+((t=o.value)==null?void 0:t.id)],state:"project"})}},{label:"\u884C\u3092\u524A\u9664\u3059\u308B",command:()=>{var t;c.value=!0,E("app/documents/"+((t=f.value)==null?void 0:t.id)).then(()=>{var e;D("project_details/"+((e=o.value)==null?void 0:e.id),"project").then(()=>{c.value=!1})})}}]);return w(()=>o.value,t=>{p.value=t==null?void 0:t.documents.filter(e=>d.value!==0?e.document_folder===d.value:!e.document_folder)}),w(()=>d.value,t=>{var e;p.value=(e=o.value)==null?void 0:e.documents.filter(l=>d.value!==0?l.document_folder===d.value:!l.document_folder)}),(t,e)=>(x(),j("div",Ce,[a(de,{modelValue:s(c),"onUpdate:modelValue":e[0]||(e[0]=l=>m(c)?c.value=l:null)},null,8,["modelValue"]),a(ce,{class:"justify-space-between"},{default:v(()=>[u("div",be,[a(s(k),{type:"button",class:"submit-button",icon:"pi pi-plus","icon-pos":"left",label:"\u66F8\u985E\u3092\u8FFD\u52A0",onClick:e[1]||(e[1]=l=>O())})]),u("div",xe,[a(s(oe),{style:{"margin-left":"0",width:"150px"},class:"dropdown",modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=l=>d.value=l),options:y.value,optionLabel:"name",optionValue:"id",placeholder:"\u30D5\u30A9\u30EB\u30C0\u30FC\u9078\u629E"},null,8,["modelValue","options"]),a(s(k),{onClick:e[3]||(e[3]=l=>L()),type:"button",class:"tool-button",label:"\u30D5\u30A9\u30EB\u30C0\u30FC\u4F5C\u6210\u3078"})])]),_:1}),u("div",ge,[Fe,a(s(se),{tag:"div",onEnd:e[4]||(e[4]=l=>s(U)({value:p.value},{method:"post",endpoints:["app/documents","project_details/"+s(o).id],state:"project"})),list:p.value,class:"sb-container ss-container",handle:".handle","item-key":"id"},{item:v(({element:l,index:G})=>[u("div",{onClick:b=>z(l),onContextmenu:b=>s(P)(b,l),"aria-haspopup":"true","aria-controls":"plan_rc_menu",class:"sheet-row flex align-center list-group-item relative pointer"},[a(s(ae),{id:"rc_menu",ref_key:"rcm",ref:N,class:"rc has-final-action",model:K.value,popup:!0},null,8,["model"]),Ee,u("div",Ae,[u("span",ye,_(G+1),1)]),u("div",Be,[l.file?(x(),te(pe,{key:0,svg:"pdf"})):V("",!0)]),u("div",we,[u("span",je,_(l.name),1)]),u("div",ke,[u("span",Ve,_(l.type),1)]),u("div",$e,[u("span",qe,_(s(S)(l.size)),1)]),u("div",{onClick:ue(b=>M(l),["stop"]),class:"sheet-cell value flex align-center"},[l.file?(x(),j("span",Ue,"\u66F8\u985E\u3092\u307F\u308B")):V("",!0)],8,Re)],40,De)]),_:1},8,["list"])]),a(ne,{modelValue:s(r),"onUpdate:modelValue":e[10]||(e[10]=l=>m(r)?r.value=l:null),title:"\u66F8\u985E\u30D5\u30A9\u30FC\u30E0"},{default:v(()=>[a(ie,{modelValue:s(r),"onUpdate:modelValue":e[5]||(e[5]=l=>m(r)?r.value=l:null),dr:s(n),"onUpdate:dr":e[6]||(e[6]=l=>m(n)?n.value=l:null),"close-after":"",topProgress:"",progress:s(I),form:B.value,data:s(f),remove:C.value,query:{project:s(o).id},submit:s(R)},null,8,["modelValue","dr","progress","form","data","remove","query","submit"]),a(re,{modelValue:s(n),"onUpdate:modelValue":e[9]||(e[9]=l=>m(n)?n.value=l:null)},{default:v(()=>[u("div",Ne,[u("button",{onClick:e[7]||(e[7]=l=>n.value=!1),class:"cancel"},"\u3044\u3044\u3048"),u("button",{onClick:e[8]||(e[8]=l=>H()),class:"delete"},"\u306F\u3044")])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]))}});export{al as default};
